<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Elven.js - custom browser only JavaScript SDK for Elrond blockchain</title>
  <meta name="description"
    content="Authenticate, sign and send transactions and messages on the Elrond blockchain in the browser. No need for bundlers, frameworks, etc. Just attach the script source, and you are ready to go.">

  <meta property="og:type" content="website" />
  <meta property="og:title" content="Elven.js - custom browser only JavaScript SDK for Elrond blockchain" />
  <meta property="og:description"
    content="Authenticate, sign and send transactions and messages on the Elrond blockchain in the browser. No need for bundlers, frameworks, etc. Just attach the script source, and you are ready to go." />
  <meta property="og:image" content="" />
  <meta property="og:url" content="https://elvenjs.netlify.app/" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Elven.js - custom browser only JavaScript SDK for Elrond blockchain" />
  <meta name="twitter:description"
    content="Authenticate, sign and send transactions and messages on the Elrond blockchain in the browser. No need for bundlers, frameworks, etc. Just attach the script source, and you are ready to go." />
  <meta name="twitter:url" content="https://elvenjs.netlify.app/" />
  <meta name="twitter:image" content="" />
  <link href="demo-styles.css" rel="stylesheet" />
</head>

<body>
  <div class="container">
    <div class="header" id="header">
      <button class="button" id="button-tx" style="display: none;">EGLD transaction</button>
      <button class="button" id="button-tx-esdt" style="display: none;">ESDT transaction*</button>
      <button class="button" id="button-mint" style="display: none;">Mint NFT</button>
      <button class="button" id="button-login-extension" style="display: none;">Login with Extension</button>
      <button class="button" id="button-login-mobile" style="display: none;">Login
        with Maiar mobile</button>
      <button class="button" id="button-logout" style="display: none;">Logout</button>
      <a class="button right" href="https://github.com/juliancwirko/elven.js" target="_blank"
        rel="noopener noreferrer">GitHub</a>
    </div>
    <div class="esdt-info">* For the ESDT transfer you will need to get the <a
        href="https://devnet-explorer.elrond.com/tokens/BUILDO-890d14" target="_blank"
        rel="noopener noreferrer">BUILDO-890d14</a> token from the faucet: <a
        href="https://devnet-elrond-esdt-faucet.netlify.app/" target="_blank"
        rel="noopener noreferrer">https://devnet-elrond-esdt-faucet.netlify.app</a> (you can also modify the hardcoded
      token and test it with yours locally, check the sourcecode of this website for more info).</div>

    <div id="tx-hash" class="tx-hash"></div>
    <div id="qr-code-container" class="qr-code-container"></div>

    <h1>ElvenJS (demo)</h1>
    <h4>Docs and code: <a href="https://github.com/juliancwirko/elven.js">elven.js</a></h4>
    <p>Authenticate, sign and send transactions and messages on the Elrond blockchain in the browser. No need for
      bundlers, frameworks, etc. Just attach the script source, and you are ready to go. You can incorporate it into
      your preferred CMS framework like WordPress or an e-commerce system. Plus, it will also work on a standard static
      HTML website.</p>
    <p>For now, Maiar mobile app and Maiar browser extension are supported. Check GitHub for more info!</p>
    <p>The primary purpose of this tool is to have a lite script for browser usage where you can authenticate and
      sign/send transactions on the Elrond blockchain and do this without any additional build steps.</p>
    <p>The purpose is to simplify the usage for primary use cases and open the doors for many frontend tools and
      approaches.</p>
    <p>The demo here presents the full path of initialization, logging in, and sending a
      transaction.</p>
    <p>
      It is a script for browsers that incorporates ES6 modules. If you need fully functional
      JavaScript/Typescript SDK (also in Nodejs), please use <a href="https://github.com/ElrondNetwork/elrond-sdk-erdjs"
        target="_blank" rel="noopener noreferrer">erdjs</a>, an official Typescript Elrond SDK.
    </p>
    <h4>Soon there will be more docs and examples!</h4>
    <h4>Check the source code of this page to get the complete code. All is static. The main script is
      minified. But you can see the code in the <a href="https://github.com/juliancwirko/elven.js" target="_blank"
        rel="noopener noreferrer">repository</a></h4>

    <h3>Demo transactions description (devnet):</h3>
    <div>First one:</div>
    <ul>
      <li>simple EGLD transfer on the devnet chain</li>
      <li>it will go to a predefined wallet</li>
      <li>the value will be 0,001 EGLD</li>
      <li>after the transaction is finished below, you will find the transaction hash</li>
    </ul>

    <div>Second one:</div>
    <ul>
      <li>Smart Contract call on the devnet chain</li>
      <li>it will call predefined smart contract and mint NFT</li>
      <li>after the transaction is finished below, you will find the transaction hash</li>
    </ul>

    <h3>Other demos:</h3>
    <ol>
      <li><a href="https://stackblitz.com/edit/web-platform-d4rx5v?file=index.html" target="_blank"
          rel="noopener noreferrer">StackBlitz vanilla html demo</a></li>
      <li><a href="https://stackblitz.com/edit/withastro-astro-pwareu?file=src%2Fpages%2Findex.astro" target="_blank"
          rel="noopener noreferrer">StackBlitz Astro demo</a></li>
      <li><a href="https://stackblitz.com/edit/vitejs-vite-rbo6du?file=src/App.tsx" target="_blank"
          rel="noopener noreferrer">StackBlitz Solid.js demo</a></li>
    </ol>
  </div>

  <!-- From v0.3.0 you would need to use the module type and import what you need -->
  <script type="module">
    // Just for the demo
    import {
      uiLoggedInState,
      uiSpinnerState,
      updateTxHashContainer,
    } from './demo-ui-tools.js'

    // Elven.js tools
    import {
      ElvenJS,
      Transaction,
      Address,
      TransactionPayload,
      TokenPayment,
      ContractCallPayloadBuilder,
      ContractFunction,
      U32Value,
      ESDTTransferPayloadBuilder,
    } from './elven.js';

    // Options are the defaults
    const initElven = async () => {
      const isLoggedIn = await ElvenJS.init(
        {
          apiUrl: 'https://devnet-api.elrond.com',
          chainType: 'devnet',
          apiTimeout: 10000,
        }
      );

      uiLoggedInState(isLoggedIn);
    }

    initElven();

    document.getElementById('button-login-extension').addEventListener('click', async () => {
      try {
        uiSpinnerState(true, 'loginExtension')
        await ElvenJS.login('maiar-browser-extension');
        uiLoggedInState(true);
      } catch (e) {
        console.log('Login: Something went wrong, try again!', e?.message);
      } finally {
        uiSpinnerState(false, 'loginExtension');
      }
    });

    document.getElementById('button-login-mobile').addEventListener('click', async () => {
      try {
        uiSpinnerState(true, 'loginMobile')
        await ElvenJS.login('maiar-mobile', {
          qrCodeContainerId: 'qr-code-container',
          onWalletConnectLogin: () => {
            uiLoggedInState(true);
          },
          onWalletConnectLogout: () => {
            uiLoggedInState(false);
          },
        });
      } catch (e) {
        console.log('Login: Something went wrong, try again!', e?.message);
      } finally {
        uiSpinnerState(false, 'loginMobile');
      }
    });

    document.getElementById('button-logout').addEventListener('click', async () => {
      try {
        const isLoggedOut = await ElvenJS.logout();
        uiLoggedInState(!isLoggedOut);
      } catch (e) {
        console.error(e.message);
      }
    });

    // Simple EGLD transfer transaction
    const egldTransferAddress = 'erd17a4wydhhd6t3hhssvcp9g23ppn7lgkk4g2tww3eqzx4mlq95dukss0g50f';

    document.getElementById('button-tx').addEventListener('click', async () => {
      updateTxHashContainer(false);
      const demoMessage = 'Transaction demo from Elven.js!';

      const tx = new Transaction({
        nonce: ElvenJS.storage.get('nonce'),
        receiver: new Address(egldTransferAddress),
        gasLimit: 50000 + 1500 * demoMessage.length,
        chainID: 'D',
        data: new TransactionPayload(demoMessage),
        value: TokenPayment.egldFromAmount(0.001),
        sender: new Address(ElvenJS.storage.get('address')),
      });

      try {
        uiSpinnerState(true, 'egld');
        const transaction = await ElvenJS.signAndSendTransaction(tx);
        uiSpinnerState(false, 'egld');
        updateTxHashContainer(transaction.hash)
      } catch (e) {
        uiSpinnerState(false, 'egld');
        throw new Error(e?.message);
      }
    });

    // Simple ESDT transfer transaction
    const esdtTransferAddress = 'erd17a4wydhhd6t3hhssvcp9g23ppn7lgkk4g2tww3eqzx4mlq95dukss0g50f';

    document.getElementById('button-tx-esdt').addEventListener('click', async () => {
      updateTxHashContainer(false);

      // The preconfigured transaction is for the 1 'BUILDO-890d14' ESDT token on the devnet
      // You need to know its ticker and how many decimals places it has
      // In this case, the token has 18 decimal places. You can check it in the Elrond devnet explorer
      // You can use the community-based faucet to get the BUILDO-890d14 token: https://r3d4.fr/faucet
      const payment = TokenPayment.fungibleFromAmount(
        'BUILDO-890d14',
        '1',
        18
      );
      const data = new ESDTTransferPayloadBuilder().setPayment(payment).build();

      const tx = new Transaction({
        data,
        gasLimit: 50000 + 1500 * data.length() + 300000,
        receiver: new Address(esdtTransferAddress),
        sender: new Address(ElvenJS.storage.get('address')),
        chainID: 'D',
      });

      try {
        uiSpinnerState(true, 'esdt');
        const transaction = await ElvenJS.signAndSendTransaction(tx);
        uiSpinnerState(false, 'esdt');
        updateTxHashContainer(transaction.hash)
      } catch (e) {
        uiSpinnerState(false, 'esdt');
        throw new Error(e?.message);
      }
    });

    // Mint nft function
    // It mints on the smart contract from: https://dapp-demo.elven.tools/
    const nftMinterSmartContract = 'erd1qqqqqqqqqqqqqpgq5za2pty2tlfqhj20z9qmrrpjmyt6advcgtkscm7xep';
    document.getElementById('button-mint').addEventListener('click', async () => {
      updateTxHashContainer(false);
      const data = new ContractCallPayloadBuilder()
        .setFunction(new ContractFunction('mint'))
        .setArgs([new U32Value(1)])
        .build();

      const tx = new Transaction({
        data,
        gasLimit: 14000000,
        value: TokenPayment.egldFromAmount(0.01),
        chainID: 'D',
        receiver: new Address(nftMinterSmartContract),
        sender: new Address(ElvenJS.storage.get('address')),
      });

      try {
        uiSpinnerState(true, 'mint');
        const transaction = await ElvenJS.signAndSendTransaction(tx);
        uiSpinnerState(false, 'mint');
        updateTxHashContainer(transaction.hash)
      } catch (e) {
        uiSpinnerState(false, 'mint');
        throw new Error(e?.message);
      }
    });
  </script>
</body>

</html>
