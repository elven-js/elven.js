/*!
 * Portions of this code are derived from MultiversX libraries.
 * These portions are licensed under the MIT License.
 *
 * See the MultiversX repository for details: https://github.com/multiversx
 * See the attached MIT licence for elven.js: https://github.com/elven-js/elven.js/blob/main/LICENSE
 */

var hm=Object.create;var on=Object.defineProperty;var lm=Object.getOwnPropertyDescriptor;var dm=Object.getOwnPropertyNames;var fm=Object.getPrototypeOf,pm=Object.prototype.hasOwnProperty;var ph=(i=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(i,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):i)(function(i){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+i+'" is not supported')});var P=(i,e)=>()=>(i&&(e=i(i=0)),e);var oe=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),Se=(i,e)=>{for(var r in e)on(i,r,{get:e[r],enumerable:!0})},nn=(i,e,r,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of dm(e))!pm.call(i,s)&&s!==r&&on(i,s,{get:()=>e[s],enumerable:!(t=lm(e,s))||t.enumerable});return i},Me=(i,e,r)=>(nn(i,e,"default"),r&&nn(r,e,"default")),pe=(i,e,r)=>(r=i!=null?hm(fm(i)):{},nn(e||!i||!i.__esModule?on(r,"default",{value:i,enumerable:!0}):r,i)),ei=i=>nn(on({},"__esModule",{value:!0}),i);var Yt=oe((l2,Zo)=>{"use strict";var yr=typeof Reflect=="object"?Reflect:null,gh=yr&&typeof yr.apply=="function"?yr.apply:function(e,r,t){return Function.prototype.apply.call(e,r,t)},an;yr&&typeof yr.ownKeys=="function"?an=yr.ownKeys:Object.getOwnPropertySymbols?an=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:an=function(e){return Object.getOwnPropertyNames(e)};function gm(i){console&&console.warn&&console.warn(i)}var yh=Number.isNaN||function(e){return e!==e};function he(){he.init.call(this)}Zo.exports=he;Zo.exports.once=bm;he.EventEmitter=he;he.prototype._events=void 0;he.prototype._eventsCount=0;he.prototype._maxListeners=void 0;var mh=10;function cn(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(he,"defaultMaxListeners",{enumerable:!0,get:function(){return mh},set:function(i){if(typeof i!="number"||i<0||yh(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");mh=i}});he.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};he.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||yh(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function wh(i){return i._maxListeners===void 0?he.defaultMaxListeners:i._maxListeners}he.prototype.getMaxListeners=function(){return wh(this)};he.prototype.emit=function(e){for(var r=[],t=1;t<arguments.length;t++)r.push(arguments[t]);var s=e==="error",n=this._events;if(n!==void 0)s=s&&n.error===void 0;else if(!s)return!1;if(s){var o;if(r.length>0&&(o=r[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=n[e];if(c===void 0)return!1;if(typeof c=="function")gh(c,this,r);else for(var h=c.length,d=xh(c,h),t=0;t<h;++t)gh(d[t],this,r);return!0};function bh(i,e,r,t){var s,n,o;if(cn(r),n=i._events,n===void 0?(n=i._events=Object.create(null),i._eventsCount=0):(n.newListener!==void 0&&(i.emit("newListener",e,r.listener?r.listener:r),n=i._events),o=n[e]),o===void 0)o=n[e]=r,++i._eventsCount;else if(typeof o=="function"?o=n[e]=t?[r,o]:[o,r]:t?o.unshift(r):o.push(r),s=wh(i),s>0&&o.length>s&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=i,a.type=e,a.count=o.length,gm(a)}return i}he.prototype.addListener=function(e,r){return bh(this,e,r,!1)};he.prototype.on=he.prototype.addListener;he.prototype.prependListener=function(e,r){return bh(this,e,r,!0)};function mm(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Eh(i,e,r){var t={fired:!1,wrapFn:void 0,target:i,type:e,listener:r},s=mm.bind(t);return s.listener=r,t.wrapFn=s,s}he.prototype.once=function(e,r){return cn(r),this.on(e,Eh(this,e,r)),this};he.prototype.prependOnceListener=function(e,r){return cn(r),this.prependListener(e,Eh(this,e,r)),this};he.prototype.removeListener=function(e,r){var t,s,n,o,a;if(cn(r),s=this._events,s===void 0)return this;if(t=s[e],t===void 0)return this;if(t===r||t.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,t.listener||r));else if(typeof t!="function"){for(n=-1,o=t.length-1;o>=0;o--)if(t[o]===r||t[o].listener===r){a=t[o].listener,n=o;break}if(n<0)return this;n===0?t.shift():ym(t,n),t.length===1&&(s[e]=t[0]),s.removeListener!==void 0&&this.emit("removeListener",e,a||r)}return this};he.prototype.off=he.prototype.removeListener;he.prototype.removeAllListeners=function(e){var r,t,s;if(t=this._events,t===void 0)return this;if(t.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):t[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete t[e]),this;if(arguments.length===0){var n=Object.keys(t),o;for(s=0;s<n.length;++s)o=n[s],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=t[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(s=r.length-1;s>=0;s--)this.removeListener(e,r[s]);return this};function _h(i,e,r){var t=i._events;if(t===void 0)return[];var s=t[e];return s===void 0?[]:typeof s=="function"?r?[s.listener||s]:[s]:r?wm(s):xh(s,s.length)}he.prototype.listeners=function(e){return _h(this,e,!0)};he.prototype.rawListeners=function(e){return _h(this,e,!1)};he.listenerCount=function(i,e){return typeof i.listenerCount=="function"?i.listenerCount(e):vh.call(i,e)};he.prototype.listenerCount=vh;function vh(i){var e=this._events;if(e!==void 0){var r=e[i];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}he.prototype.eventNames=function(){return this._eventsCount>0?an(this._events):[]};function xh(i,e){for(var r=new Array(e),t=0;t<e;++t)r[t]=i[t];return r}function ym(i,e){for(;e+1<i.length;e++)i[e]=i[e+1];i.pop()}function wm(i){for(var e=new Array(i.length),r=0;r<e.length;++r)e[r]=i[r].listener||i[r];return e}function bm(i,e){return new Promise(function(r,t){function s(o){i.removeListener(e,n),t(o)}function n(){typeof i.removeListener=="function"&&i.removeListener("error",s),r([].slice.call(arguments))}Sh(i,e,n,{once:!0}),e!=="error"&&Em(i,s,{once:!0})})}function Em(i,e,r){typeof i.on=="function"&&Sh(i,"error",e,r)}function Sh(i,e,r,t){if(typeof i.on=="function")t.once?i.once(e,r):i.on(e,r);else if(typeof i.addEventListener=="function")i.addEventListener(e,function s(n){t.once&&i.removeEventListener(e,s),r(n)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}});var wr={};Se(wr,{__awaiter:()=>_m,__createBinding:()=>Ih,__exportStar:()=>vm,__read:()=>Sm,__values:()=>xm});function _m(i,e,r,t){return new(r||(r=Promise))(function(s,n){function o(h){try{c(t.next(h))}catch(d){n(d)}}function a(h){try{c(t.throw(h))}catch(d){n(d)}}function c(h){h.done?s(h.value):new r(function(d){d(h.value)}).then(o,a)}c((t=t.apply(i,e||[])).next())})}function vm(i,e){for(var r in i)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Ih(e,i,r)}function Ih(i,e,r,t){t===void 0&&(t=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(i,t,s)}function xm(i){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&i[e],t=0;if(r)return r.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&t>=i.length&&(i=void 0),{value:i&&i[t++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Sm(i,e){var r=typeof Symbol=="function"&&i[Symbol.iterator];if(!r)return i;var t=r.call(i),s,n=[],o;try{for(;(e===void 0||e-- >0)&&!(s=t.next()).done;)n.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(r=t.return)&&r.call(t)}finally{if(o)throw o.error}}return n}var br=P(()=>{});var Dh=oe(un=>{"use strict";Object.defineProperty(un,"__esModule",{value:!0});un.delay=void 0;function Im(i){return new Promise(e=>{setTimeout(()=>{e(!0)},i)})}un.delay=Im});var Th=oe(Er=>{"use strict";Object.defineProperty(Er,"__esModule",{value:!0});Er.ONE_THOUSAND=Er.ONE_HUNDRED=void 0;Er.ONE_HUNDRED=100;Er.ONE_THOUSAND=1e3});var Rh=oe(K=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});K.ONE_YEAR=K.FOUR_WEEKS=K.THREE_WEEKS=K.TWO_WEEKS=K.ONE_WEEK=K.THIRTY_DAYS=K.SEVEN_DAYS=K.FIVE_DAYS=K.THREE_DAYS=K.ONE_DAY=K.TWENTY_FOUR_HOURS=K.TWELVE_HOURS=K.SIX_HOURS=K.THREE_HOURS=K.ONE_HOUR=K.SIXTY_MINUTES=K.THIRTY_MINUTES=K.TEN_MINUTES=K.FIVE_MINUTES=K.ONE_MINUTE=K.SIXTY_SECONDS=K.THIRTY_SECONDS=K.TEN_SECONDS=K.FIVE_SECONDS=K.ONE_SECOND=void 0;K.ONE_SECOND=1;K.FIVE_SECONDS=5;K.TEN_SECONDS=10;K.THIRTY_SECONDS=30;K.SIXTY_SECONDS=60;K.ONE_MINUTE=K.SIXTY_SECONDS;K.FIVE_MINUTES=K.ONE_MINUTE*5;K.TEN_MINUTES=K.ONE_MINUTE*10;K.THIRTY_MINUTES=K.ONE_MINUTE*30;K.SIXTY_MINUTES=K.ONE_MINUTE*60;K.ONE_HOUR=K.SIXTY_MINUTES;K.THREE_HOURS=K.ONE_HOUR*3;K.SIX_HOURS=K.ONE_HOUR*6;K.TWELVE_HOURS=K.ONE_HOUR*12;K.TWENTY_FOUR_HOURS=K.ONE_HOUR*24;K.ONE_DAY=K.TWENTY_FOUR_HOURS;K.THREE_DAYS=K.ONE_DAY*3;K.FIVE_DAYS=K.ONE_DAY*5;K.SEVEN_DAYS=K.ONE_DAY*7;K.THIRTY_DAYS=K.ONE_DAY*30;K.ONE_WEEK=K.SEVEN_DAYS;K.TWO_WEEKS=K.ONE_WEEK*2;K.THREE_WEEKS=K.ONE_WEEK*3;K.FOUR_WEEKS=K.ONE_WEEK*4;K.ONE_YEAR=K.ONE_DAY*365});var ea=oe(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});var Ch=(br(),ei(wr));Ch.__exportStar(Th(),hn);Ch.__exportStar(Rh(),hn)});var Ah=oe(_r=>{"use strict";Object.defineProperty(_r,"__esModule",{value:!0});_r.fromMiliseconds=_r.toMiliseconds=void 0;var Nh=ea();function Dm(i){return i*Nh.ONE_THOUSAND}_r.toMiliseconds=Dm;function Tm(i){return Math.floor(i/Nh.ONE_THOUSAND)}_r.fromMiliseconds=Tm});var Ph=oe(ln=>{"use strict";Object.defineProperty(ln,"__esModule",{value:!0});var Oh=(br(),ei(wr));Oh.__exportStar(Dh(),ln);Oh.__exportStar(Ah(),ln)});var Lh=oe(ti=>{"use strict";Object.defineProperty(ti,"__esModule",{value:!0});ti.Watch=void 0;var dn=class{constructor(){this.timestamps=new Map}start(e){if(this.timestamps.has(e))throw new Error(`Watch already started for label: ${e}`);this.timestamps.set(e,{started:Date.now()})}stop(e){let r=this.get(e);if(typeof r.elapsed<"u")throw new Error(`Watch already stopped for label: ${e}`);let t=Date.now()-r.started;this.timestamps.set(e,{started:r.started,elapsed:t})}get(e){let r=this.timestamps.get(e);if(typeof r>"u")throw new Error(`No timestamp found for label: ${e}`);return r}elapsed(e){let r=this.get(e);return r.elapsed||Date.now()-r.started}};ti.Watch=dn;ti.default=dn});var Uh=oe(fn=>{"use strict";Object.defineProperty(fn,"__esModule",{value:!0});fn.IWatch=void 0;var ta=class{};fn.IWatch=ta});var Mh=oe(ra=>{"use strict";Object.defineProperty(ra,"__esModule",{value:!0});var Rm=(br(),ei(wr));Rm.__exportStar(Uh(),ra)});var xr=oe(vr=>{"use strict";Object.defineProperty(vr,"__esModule",{value:!0});var pn=(br(),ei(wr));pn.__exportStar(Ph(),vr);pn.__exportStar(Lh(),vr);pn.__exportStar(Mh(),vr);pn.__exportStar(ea(),vr)});var Qe,Fh=P(()=>{Qe=class{}});var ia=P(()=>{Fh()});var Bh,mn,sa,kh,Xt,gn,qh=P(()=>{Bh=pe(Yt()),mn=pe(xr());ia();sa=class extends Qe{constructor(e){super()}},kh=mn.FIVE_SECONDS,Xt={pulse:"heartbeat_pulse"},gn=class i extends sa{constructor(e){super(e),this.events=new Bh.EventEmitter,this.interval=kh,this.interval=e?.interval||kh}static async init(e){let r=new i(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),(0,mn.toMiliseconds)(this.interval))}pulse(){this.events.emit(Xt.pulse)}}});function zh(i={}){return{async getItem(e){try{return localStorage.getItem(e)}catch(r){return console.warn("Storage getItem error:",r),null}},async setItem(e,r){try{localStorage.setItem(e,r)}catch(t){console.warn("Storage setItem error:",t)}},async removeItem(e){try{localStorage.removeItem(e)}catch(r){console.warn("Storage removeItem error:",r)}},async clear(){try{localStorage.clear()}catch(e){console.warn("Storage clear error:",e)}},async mount(){},async unmount(){}}}var Vh=P(()=>{});function Qt(i){return new Promise((e,r)=>{i.oncomplete=i.onsuccess=()=>e(i.result),i.onabort=i.onerror=()=>r(i.error)})}function oa(i,e){let r=indexedDB.open(i);r.onupgradeneeded=()=>r.result.createObjectStore(e);let t=Qt(r);return(s,n)=>t.then(o=>n(o.transaction(e,s).objectStore(e)))}function ri(){return na||(na=oa("keyval-store","keyval")),na}function aa(i,e=ri()){return e("readonly",r=>Qt(r.get(i)))}function Kh(i,e,r=ri()){return r("readwrite",t=>(t.put(e,i),Qt(t.transaction)))}function jh(i,e=ri()){return e("readwrite",r=>(r.delete(i),Qt(r.transaction)))}function $h(i=ri()){return i("readwrite",e=>(e.clear(),Qt(e.transaction)))}function Cm(i,e){return i.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Qt(i.transaction)}function Hh(i=ri()){return i("readonly",e=>{if(e.getAllKeys)return Qt(e.getAllKeys());let r=[];return Cm(e,t=>r.push(t.key)).then(()=>r)})}var na,Gh=P(()=>{});function ut(i){if(typeof i!="string")throw new Error(`Cannot safe json parse value of type ${typeof i}`);try{return Am(i)}catch{return i}}function $e(i){return typeof i=="string"?i:Nm(i)||""}var Nm,Am,Sr=P(()=>{Nm=i=>JSON.stringify(i,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),Am=i=>{let e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=i.replace(e,'$1"$2n"$3');return JSON.parse(r,(t,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)}});function Mm(i){var e;return[i[0],ut((e=i[1])!=null?e:"")]}var Om,Pm,Lm,Um,ua,ca,yn,ha,Fm,Wh,km,Bm,wn,Jh=P(()=>{Vh();Gh();Sr();Om="idb-keyval",Pm=(i={})=>{let e=i.base&&i.base.length>0?`${i.base}:`:"",r=s=>e+s,t;return i.dbName&&i.storeName&&(t=oa(i.dbName,i.storeName)),{name:Om,options:i,async hasItem(s){return!(typeof await aa(r(s),t)>"u")},async getItem(s){return await aa(r(s),t)??null},setItem(s,n){return Kh(r(s),n,t)},removeItem(s){return jh(r(s),t)},getKeys(){return Hh(t)},clear(){return $h(t)}}},Lm="WALLET_CONNECT_V2_INDEXED_DB",Um="keyvaluestorage",ua=class{constructor(){this.indexedDb=zh({driver:Pm({dbName:Lm,storeName:Um})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){let r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,$e(r))}async removeItem(e){await this.indexedDb.removeItem(e)}},ca=typeof globalThis<"u"?globalThis:typeof window<"u"||typeof window<"u"?window:typeof self<"u"?self:{},yn={exports:{}};(function(){let i;function e(){}i=e,i.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},i.prototype.setItem=function(r,t){this[r]=String(t)},i.prototype.removeItem=function(r){delete this[r]},i.prototype.clear=function(){let r=this;Object.keys(r).forEach(function(t){r[t]=void 0,delete r[t]})},i.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},i.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof ca<"u"&&ca.localStorage?yn.exports=ca.localStorage:typeof window<"u"&&window.localStorage?yn.exports=window.localStorage:yn.exports=new e})();ha=class{constructor(){this.localStorage=yn.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Mm)}async getItem(e){let r=this.localStorage.getItem(e);if(r!==null)return ut(r)}async setItem(e,r){this.localStorage.setItem(e,$e(r))}async removeItem(e){this.localStorage.removeItem(e)}},Fm="wc_storage_version",Wh=1,km=async(i,e,r)=>{let t=Fm,s=await e.getItem(t);if(s&&s>=Wh){r(e);return}let n=await i.getKeys();if(!n.length){r(e);return}let o=[];for(;n.length;){let a=n.shift();if(!a)continue;let c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){let h=await i.getItem(a);await e.setItem(a,h),o.push(a)}}await e.setItem(t,Wh),r(e),Bm(i,o)},Bm=async(i,e)=>{e.length&&e.forEach(async r=>{await i.removeItem(r)})},wn=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};let e=new ha;this.storage=e;try{let r=new ua;km(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{let r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}}});function Yh(){return{trace:la,debug:la,info:console.log.bind(console),warn:console.warn.bind(console),error:console.error.bind(console),fatal:console.error.bind(console),child:function(){return this}}}function bn(){return Yh()}var la,Zt,Pt,da=P(()=>{la=()=>{},Zt={values:{trace:10,debug:20,info:30,warn:40,error:50,fatal:60}};bn.destination=()=>({write:la});bn.transport=()=>Yh();bn.levels=Zt;Pt=bn});function si(i){return xn(vn({},i),{level:i?.level||qm.level})}function Hm(i,e=ii){return i[e]||""}function Gm(i,e,r=ii){return i[r]=e,i}function Re(i,e=ii){let r="";return typeof i.bindings>"u"?r=Hm(i,e):r=i.bindings().context||"",r}function Wm(i,e,r=ii){let t=Re(i,r);return t.trim()?`${t}/${e}`:e}function Ie(i,e,r=ii){let t=Wm(i,e,r),s=i.child({context:t});return Gm(s,t,r)}function Jm(i){var e,r;let t=new pa((e=i.opts)==null?void 0:e.level,i.maxSizeInBytes);return{logger:Pt(xn(vn({},i.opts),{level:"trace",browser:xn(vn({},(r=i.opts)==null?void 0:r.browser),{write:s=>t.write(s)})})),chunkLoggerController:t}}function Ym(i){var e;let r=new ga((e=i.opts)==null?void 0:e.level,i.maxSizeInBytes);return{logger:Pt(xn(vn({},i.opts),{level:"trace"}),r),chunkLoggerController:r}}function Zh(i){return typeof i.loggerOverride<"u"&&typeof i.loggerOverride!="string"?{logger:i.loggerOverride,chunkLoggerController:null}:typeof window<"u"?Jm(i):Ym(i)}var qm,ii,ma,fa,En,_n,pa,ga,zm,Vm,Km,Xh,jm,$m,Qh,vn,xn,ya=P(()=>{da();da();Sr();qm={level:"info"},ii="custom_context",ma=1e3*1024,fa=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},En=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){let r=new fa(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;let e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){let e=[],r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};let r=e.value;return e=e.next,{done:!1,value:r}}}}},_n=class{constructor(e,r=ma){this.level=e??"error",this.levelValue=Zt.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new En(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===Zt.values.error?console.error(e):r===Zt.values.warn?console.warn(e):r===Zt.values.debug?console.debug(e):r===Zt.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append($e({timestamp:new Date().toISOString(),log:e}));let r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new En(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){let r=this.getLogArray();return r.push($e({extraMetadata:e})),new Blob(r,{type:"application/json"})}},pa=class{constructor(e,r=ma){this.baseChunkLogger=new _n(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){let r=URL.createObjectURL(this.logsToBlob(e)),t=document.createElement("a");t.href=r,t.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(r)}},ga=class{constructor(e,r=ma){this.baseChunkLogger=new _n(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}},zm=Object.defineProperty,Vm=Object.defineProperties,Km=Object.getOwnPropertyDescriptors,Xh=Object.getOwnPropertySymbols,jm=Object.prototype.hasOwnProperty,$m=Object.prototype.propertyIsEnumerable,Qh=(i,e,r)=>e in i?zm(i,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[e]=r,vn=(i,e)=>{for(var r in e||(e={}))jm.call(e,r)&&Qh(i,r,e[r]);if(Xh)for(var r of Xh(e))$m.call(e,r)&&Qh(i,r,e[r]);return i},xn=(i,e)=>Vm(i,Km(e))});var el,Sn,In,Dn,Tn,Rn,Cn,Nn,An,On,Pn,Ln,Un,Mn,wa=P(()=>{ia();el=pe(Yt()),Sn=class extends Qe{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}},In=class extends Qe{constructor(e,r){super(),this.core=e,this.logger=r,this.records=new Map}},Dn=class{constructor(e,r){this.logger=e,this.core=r}},Tn=class extends Qe{constructor(e,r){super(),this.relayer=e,this.logger=r}},Rn=class extends Qe{constructor(e){super()}},Cn=class{constructor(e,r,t,s){this.core=e,this.logger=r,this.name=t}},Nn=class extends Qe{constructor(e,r){super(),this.relayer=e,this.logger=r}},An=class extends Qe{constructor(e,r){super(),this.core=e,this.logger=r}},On=class{constructor(e,r,t){this.core=e,this.logger=r,this.store=t}},Pn=class{constructor(e,r){this.projectId=e,this.logger=r}},Ln=class{constructor(e,r,t){this.core=e,this.logger=r,this.telemetryEnabled=t}},Un=class{constructor(e){this.opts=e,this.protocol="wc",this.version=2}},Mn=class{constructor(e){this.client=e}}});var rl=oe(Fn=>{"use strict";Object.defineProperty(Fn,"__esModule",{value:!0});Fn.BrowserRandomSource=void 0;var tl=65536,ba=class{constructor(){this.isAvailable=!1,this.isInstantiated=!1;let e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");let r=new Uint8Array(e);for(let t=0;t<r.length;t+=tl)this._crypto.getRandomValues(r.subarray(t,t+Math.min(r.length-t,tl)));return r}};Fn.BrowserRandomSource=ba});var He=oe(Ea=>{"use strict";Object.defineProperty(Ea,"__esModule",{value:!0});function Xm(i){for(var e=0;e<i.length;e++)i[e]=0;return i}Ea.wipe=Xm});var il=oe(()=>{});var sl=oe(kn=>{"use strict";Object.defineProperty(kn,"__esModule",{value:!0});kn.NodeRandomSource=void 0;var Qm=He(),_a=class{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof ph<"u"){let e=il();e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let r=this._crypto.randomBytes(e);if(r.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");let t=new Uint8Array(e);for(let s=0;s<t.length;s++)t[s]=r[s];return(0,Qm.wipe)(r),t}};kn.NodeRandomSource=_a});var nl=oe(Bn=>{"use strict";Object.defineProperty(Bn,"__esModule",{value:!0});Bn.SystemRandomSource=void 0;var Zm=rl(),ey=sl(),va=class{constructor(){if(this.isAvailable=!1,this.name="",this._source=new Zm.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new ey.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}};Bn.SystemRandomSource=va});var ol=oe(ze=>{"use strict";Object.defineProperty(ze,"__esModule",{value:!0});function ty(i,e){var r=i>>>16&65535,t=i&65535,s=e>>>16&65535,n=e&65535;return t*n+(r*n+t*s<<16>>>0)|0}ze.mul=Math.imul||ty;function ry(i,e){return i+e|0}ze.add=ry;function iy(i,e){return i-e|0}ze.sub=iy;function sy(i,e){return i<<e|i>>>32-e}ze.rotl=sy;function ny(i,e){return i<<32-e|i>>>e}ze.rotr=ny;function oy(i){return typeof i=="number"&&isFinite(i)&&Math.floor(i)===i}ze.isInteger=Number.isInteger||oy;ze.MAX_SAFE_INTEGER=9007199254740991;ze.isSafeInteger=function(i){return ze.isInteger(i)&&i>=-ze.MAX_SAFE_INTEGER&&i<=ze.MAX_SAFE_INTEGER}});var Ir=oe(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});var al=ol();function ay(i,e){return e===void 0&&(e=0),(i[e+0]<<8|i[e+1])<<16>>16}ne.readInt16BE=ay;function cy(i,e){return e===void 0&&(e=0),(i[e+0]<<8|i[e+1])>>>0}ne.readUint16BE=cy;function uy(i,e){return e===void 0&&(e=0),(i[e+1]<<8|i[e])<<16>>16}ne.readInt16LE=uy;function hy(i,e){return e===void 0&&(e=0),(i[e+1]<<8|i[e])>>>0}ne.readUint16LE=hy;function cl(i,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=i>>>8,e[r+1]=i>>>0,e}ne.writeUint16BE=cl;ne.writeInt16BE=cl;function ul(i,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=i>>>0,e[r+1]=i>>>8,e}ne.writeUint16LE=ul;ne.writeInt16LE=ul;function xa(i,e){return e===void 0&&(e=0),i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3]}ne.readInt32BE=xa;function Sa(i,e){return e===void 0&&(e=0),(i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3])>>>0}ne.readUint32BE=Sa;function Ia(i,e){return e===void 0&&(e=0),i[e+3]<<24|i[e+2]<<16|i[e+1]<<8|i[e]}ne.readInt32LE=Ia;function Da(i,e){return e===void 0&&(e=0),(i[e+3]<<24|i[e+2]<<16|i[e+1]<<8|i[e])>>>0}ne.readUint32LE=Da;function qn(i,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=i>>>24,e[r+1]=i>>>16,e[r+2]=i>>>8,e[r+3]=i>>>0,e}ne.writeUint32BE=qn;ne.writeInt32BE=qn;function zn(i,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=i>>>0,e[r+1]=i>>>8,e[r+2]=i>>>16,e[r+3]=i>>>24,e}ne.writeUint32LE=zn;ne.writeInt32LE=zn;function ly(i,e){e===void 0&&(e=0);var r=xa(i,e),t=xa(i,e+4);return r*4294967296+t-(t>>31)*4294967296}ne.readInt64BE=ly;function dy(i,e){e===void 0&&(e=0);var r=Sa(i,e),t=Sa(i,e+4);return r*4294967296+t}ne.readUint64BE=dy;function fy(i,e){e===void 0&&(e=0);var r=Ia(i,e),t=Ia(i,e+4);return t*4294967296+r-(r>>31)*4294967296}ne.readInt64LE=fy;function py(i,e){e===void 0&&(e=0);var r=Da(i,e),t=Da(i,e+4);return t*4294967296+r}ne.readUint64LE=py;function hl(i,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),qn(i/4294967296>>>0,e,r),qn(i>>>0,e,r+4),e}ne.writeUint64BE=hl;ne.writeInt64BE=hl;function ll(i,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),zn(i>>>0,e,r),zn(i/4294967296>>>0,e,r+4),e}ne.writeUint64LE=ll;ne.writeInt64LE=ll;function gy(i,e,r){if(r===void 0&&(r=0),i%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(i/8>e.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var t=0,s=1,n=i/8+r-1;n>=r;n--)t+=e[n]*s,s*=256;return t}ne.readUintBE=gy;function my(i,e,r){if(r===void 0&&(r=0),i%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(i/8>e.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var t=0,s=1,n=r;n<r+i/8;n++)t+=e[n]*s,s*=256;return t}ne.readUintLE=my;function yy(i,e,r,t){if(r===void 0&&(r=new Uint8Array(i/8)),t===void 0&&(t=0),i%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!al.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var s=1,n=i/8+t-1;n>=t;n--)r[n]=e/s&255,s*=256;return r}ne.writeUintBE=yy;function wy(i,e,r,t){if(r===void 0&&(r=new Uint8Array(i/8)),t===void 0&&(t=0),i%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!al.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var s=1,n=t;n<t+i/8;n++)r[n]=e/s&255,s*=256;return r}ne.writeUintLE=wy;function by(i,e){e===void 0&&(e=0);var r=new DataView(i.buffer,i.byteOffset,i.byteLength);return r.getFloat32(e)}ne.readFloat32BE=by;function Ey(i,e){e===void 0&&(e=0);var r=new DataView(i.buffer,i.byteOffset,i.byteLength);return r.getFloat32(e,!0)}ne.readFloat32LE=Ey;function _y(i,e){e===void 0&&(e=0);var r=new DataView(i.buffer,i.byteOffset,i.byteLength);return r.getFloat64(e)}ne.readFloat64BE=_y;function vy(i,e){e===void 0&&(e=0);var r=new DataView(i.buffer,i.byteOffset,i.byteLength);return r.getFloat64(e,!0)}ne.readFloat64LE=vy;function xy(i,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return t.setFloat32(r,i),e}ne.writeFloat32BE=xy;function Sy(i,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return t.setFloat32(r,i,!0),e}ne.writeFloat32LE=Sy;function Iy(i,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return t.setFloat64(r,i),e}ne.writeFloat64BE=Iy;function Dy(i,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return t.setFloat64(r,i,!0),e}ne.writeFloat64LE=Dy});var ni=oe(Ce=>{"use strict";Object.defineProperty(Ce,"__esModule",{value:!0});Ce.randomStringForEntropy=Ce.randomString=Ce.randomUint32=Ce.randomBytes=Ce.defaultRandomSource=void 0;var Ty=nl(),Ry=Ir(),dl=He();Ce.defaultRandomSource=new Ty.SystemRandomSource;function Ta(i,e=Ce.defaultRandomSource){return e.randomBytes(i)}Ce.randomBytes=Ta;function Cy(i=Ce.defaultRandomSource){let e=Ta(4,i),r=(0,Ry.readUint32LE)(e);return(0,dl.wipe)(e),r}Ce.randomUint32=Cy;var fl="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function pl(i,e=fl,r=Ce.defaultRandomSource){if(e.length<2)throw new Error("randomString charset is too short");if(e.length>256)throw new Error("randomString charset is too long");let t="",s=e.length,n=256-256%s;for(;i>0;){let o=Ta(Math.ceil(i*256/n),r);for(let a=0;a<o.length&&i>0;a++){let c=o[a];c<n&&(t+=e.charAt(c%s),i--)}(0,dl.wipe)(o)}return t}Ce.randomString=pl;function Ny(i,e=fl,r=Ce.defaultRandomSource){let t=Math.ceil(i/(Math.log(e.length)/Math.LN2));return pl(t,e,r)}Ce.randomStringForEntropy=Ny});var yl=oe(_t=>{"use strict";Object.defineProperty(_t,"__esModule",{value:!0});var Tr=Ir(),Dr=He();_t.DIGEST_LENGTH=64;_t.BLOCK_SIZE=128;var ml=function(){function i(){this.digestLength=_t.DIGEST_LENGTH,this.blockSize=_t.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return i.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},i.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},i.prototype.clean=function(){Dr.wipe(this._buffer),Dr.wipe(this._tempHi),Dr.wipe(this._tempLo),this.reset()},i.prototype.update=function(e,r){if(r===void 0&&(r=e.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var t=0;if(this._bytesHashed+=r,this._bufferLength>0){for(;this._bufferLength<_t.BLOCK_SIZE&&r>0;)this._buffer[this._bufferLength++]=e[t++],r--;this._bufferLength===this.blockSize&&(Ra(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(r>=this.blockSize&&(t=Ra(this._tempHi,this._tempLo,this._stateHi,this._stateLo,e,t,r),r%=this.blockSize);r>0;)this._buffer[this._bufferLength++]=e[t++],r--;return this},i.prototype.finish=function(e){if(!this._finished){var r=this._bytesHashed,t=this._bufferLength,s=r/536870912|0,n=r<<3,o=r%128<112?128:256;this._buffer[t]=128;for(var a=t+1;a<o-8;a++)this._buffer[a]=0;Tr.writeUint32BE(s,this._buffer,o-8),Tr.writeUint32BE(n,this._buffer,o-4),Ra(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,o),this._finished=!0}for(var a=0;a<this.digestLength/8;a++)Tr.writeUint32BE(this._stateHi[a],e,a*8),Tr.writeUint32BE(this._stateLo[a],e,a*8+4);return this},i.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},i.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},i.prototype.restoreState=function(e){return this._stateHi.set(e.stateHi),this._stateLo.set(e.stateLo),this._bufferLength=e.bufferLength,e.buffer&&this._buffer.set(e.buffer),this._bytesHashed=e.bytesHashed,this._finished=!1,this},i.prototype.cleanSavedState=function(e){Dr.wipe(e.stateHi),Dr.wipe(e.stateLo),e.buffer&&Dr.wipe(e.buffer),e.bufferLength=0,e.bytesHashed=0},i}();_t.SHA512=ml;var gl=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function Ra(i,e,r,t,s,n,o){for(var a=r[0],c=r[1],h=r[2],d=r[3],l=r[4],p=r[5],f=r[6],g=r[7],w=t[0],b=t[1],v=t[2],x=t[3],I=t[4],S=t[5],T=t[6],L=t[7],y,m,k,$,O,C,R,N;o>=128;){for(var G=0;G<16;G++){var H=8*G+n;i[G]=Tr.readUint32BE(s,H),e[G]=Tr.readUint32BE(s,H+4)}for(var G=0;G<80;G++){var q=a,j=c,re=h,Y=d,Z=l,V=p,J=f,X=g,u=w,E=b,_=v,D=x,A=I,U=S,F=T,M=L;if(y=g,m=L,O=m&65535,C=m>>>16,R=y&65535,N=y>>>16,y=(l>>>14|I<<18)^(l>>>18|I<<14)^(I>>>9|l<<23),m=(I>>>14|l<<18)^(I>>>18|l<<14)^(l>>>9|I<<23),O+=m&65535,C+=m>>>16,R+=y&65535,N+=y>>>16,y=l&p^~l&f,m=I&S^~I&T,O+=m&65535,C+=m>>>16,R+=y&65535,N+=y>>>16,y=gl[G*2],m=gl[G*2+1],O+=m&65535,C+=m>>>16,R+=y&65535,N+=y>>>16,y=i[G%16],m=e[G%16],O+=m&65535,C+=m>>>16,R+=y&65535,N+=y>>>16,C+=O>>>16,R+=C>>>16,N+=R>>>16,k=R&65535|N<<16,$=O&65535|C<<16,y=k,m=$,O=m&65535,C=m>>>16,R=y&65535,N=y>>>16,y=(a>>>28|w<<4)^(w>>>2|a<<30)^(w>>>7|a<<25),m=(w>>>28|a<<4)^(a>>>2|w<<30)^(a>>>7|w<<25),O+=m&65535,C+=m>>>16,R+=y&65535,N+=y>>>16,y=a&c^a&h^c&h,m=w&b^w&v^b&v,O+=m&65535,C+=m>>>16,R+=y&65535,N+=y>>>16,C+=O>>>16,R+=C>>>16,N+=R>>>16,X=R&65535|N<<16,M=O&65535|C<<16,y=Y,m=D,O=m&65535,C=m>>>16,R=y&65535,N=y>>>16,y=k,m=$,O+=m&65535,C+=m>>>16,R+=y&65535,N+=y>>>16,C+=O>>>16,R+=C>>>16,N+=R>>>16,Y=R&65535|N<<16,D=O&65535|C<<16,c=q,h=j,d=re,l=Y,p=Z,f=V,g=J,a=X,b=u,v=E,x=_,I=D,S=A,T=U,L=F,w=M,G%16===15)for(var H=0;H<16;H++)y=i[H],m=e[H],O=m&65535,C=m>>>16,R=y&65535,N=y>>>16,y=i[(H+9)%16],m=e[(H+9)%16],O+=m&65535,C+=m>>>16,R+=y&65535,N+=y>>>16,k=i[(H+1)%16],$=e[(H+1)%16],y=(k>>>1|$<<31)^(k>>>8|$<<24)^k>>>7,m=($>>>1|k<<31)^($>>>8|k<<24)^($>>>7|k<<25),O+=m&65535,C+=m>>>16,R+=y&65535,N+=y>>>16,k=i[(H+14)%16],$=e[(H+14)%16],y=(k>>>19|$<<13)^($>>>29|k<<3)^k>>>6,m=($>>>19|k<<13)^(k>>>29|$<<3)^($>>>6|k<<26),O+=m&65535,C+=m>>>16,R+=y&65535,N+=y>>>16,C+=O>>>16,R+=C>>>16,N+=R>>>16,i[H]=R&65535|N<<16,e[H]=O&65535|C<<16}y=a,m=w,O=m&65535,C=m>>>16,R=y&65535,N=y>>>16,y=r[0],m=t[0],O+=m&65535,C+=m>>>16,R+=y&65535,N+=y>>>16,C+=O>>>16,R+=C>>>16,N+=R>>>16,r[0]=a=R&65535|N<<16,t[0]=w=O&65535|C<<16,y=c,m=b,O=m&65535,C=m>>>16,R=y&65535,N=y>>>16,y=r[1],m=t[1],O+=m&65535,C+=m>>>16,R+=y&65535,N+=y>>>16,C+=O>>>16,R+=C>>>16,N+=R>>>16,r[1]=c=R&65535|N<<16,t[1]=b=O&65535|C<<16,y=h,m=v,O=m&65535,C=m>>>16,R=y&65535,N=y>>>16,y=r[2],m=t[2],O+=m&65535,C+=m>>>16,R+=y&65535,N+=y>>>16,C+=O>>>16,R+=C>>>16,N+=R>>>16,r[2]=h=R&65535|N<<16,t[2]=v=O&65535|C<<16,y=d,m=x,O=m&65535,C=m>>>16,R=y&65535,N=y>>>16,y=r[3],m=t[3],O+=m&65535,C+=m>>>16,R+=y&65535,N+=y>>>16,C+=O>>>16,R+=C>>>16,N+=R>>>16,r[3]=d=R&65535|N<<16,t[3]=x=O&65535|C<<16,y=l,m=I,O=m&65535,C=m>>>16,R=y&65535,N=y>>>16,y=r[4],m=t[4],O+=m&65535,C+=m>>>16,R+=y&65535,N+=y>>>16,C+=O>>>16,R+=C>>>16,N+=R>>>16,r[4]=l=R&65535|N<<16,t[4]=I=O&65535|C<<16,y=p,m=S,O=m&65535,C=m>>>16,R=y&65535,N=y>>>16,y=r[5],m=t[5],O+=m&65535,C+=m>>>16,R+=y&65535,N+=y>>>16,C+=O>>>16,R+=C>>>16,N+=R>>>16,r[5]=p=R&65535|N<<16,t[5]=S=O&65535|C<<16,y=f,m=T,O=m&65535,C=m>>>16,R=y&65535,N=y>>>16,y=r[6],m=t[6],O+=m&65535,C+=m>>>16,R+=y&65535,N+=y>>>16,C+=O>>>16,R+=C>>>16,N+=R>>>16,r[6]=f=R&65535|N<<16,t[6]=T=O&65535|C<<16,y=g,m=L,O=m&65535,C=m>>>16,R=y&65535,N=y>>>16,y=r[7],m=t[7],O+=m&65535,C+=m>>>16,R+=y&65535,N+=y>>>16,C+=O>>>16,R+=C>>>16,N+=R>>>16,r[7]=g=R&65535|N<<16,t[7]=L=O&65535|C<<16,n+=128,o-=128}return n}function Ay(i){var e=new ml;e.update(i);var r=e.digest();return e.clean(),r}_t.hash=Ay});var Al=oe(ue=>{"use strict";Object.defineProperty(ue,"__esModule",{value:!0});ue.convertSecretKeyToX25519=ue.convertPublicKeyToX25519=ue.verify=ue.sign=ue.extractPublicKeyFromSecretKey=ue.generateKeyPair=ue.generateKeyPairFromSeed=ue.SEED_LENGTH=ue.SECRET_KEY_LENGTH=ue.PUBLIC_KEY_LENGTH=ue.SIGNATURE_LENGTH=void 0;var Oy=ni(),oi=yl(),vl=He();ue.SIGNATURE_LENGTH=64;ue.PUBLIC_KEY_LENGTH=32;ue.SECRET_KEY_LENGTH=64;ue.SEED_LENGTH=32;function te(i){let e=new Float64Array(16);if(i)for(let r=0;r<i.length;r++)e[r]=i[r];return e}var Py=new Uint8Array(32);Py[0]=9;var Aa=te(),Rr=te([1]),Ly=te([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),Uy=te([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),wl=te([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),bl=te([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),My=te([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function Lt(i,e){for(let r=0;r<16;r++)i[r]=e[r]|0}function Ca(i){let e=1;for(let r=0;r<16;r++){let t=i[r]+e+65535;e=Math.floor(t/65536),i[r]=t-e*65536}i[0]+=e-1+37*(e-1)}function xl(i,e,r){let t=~(r-1);for(let s=0;s<16;s++){let n=t&(i[s]^e[s]);i[s]^=n,e[s]^=n}}function ai(i,e){let r=te(),t=te();for(let s=0;s<16;s++)t[s]=e[s];Ca(t),Ca(t),Ca(t);for(let s=0;s<2;s++){r[0]=t[0]-65517;for(let o=1;o<15;o++)r[o]=t[o]-65535-(r[o-1]>>16&1),r[o-1]&=65535;r[15]=t[15]-32767-(r[14]>>16&1);let n=r[15]>>16&1;r[14]&=65535,xl(t,r,1-n)}for(let s=0;s<16;s++)i[2*s]=t[s]&255,i[2*s+1]=t[s]>>8}function Sl(i,e){let r=0;for(let t=0;t<32;t++)r|=i[t]^e[t];return(1&r-1>>>8)-1}function El(i,e){let r=new Uint8Array(32),t=new Uint8Array(32);return ai(r,i),ai(t,e),Sl(r,t)}function Il(i){let e=new Uint8Array(32);return ai(e,i),e[0]&1}function Fy(i,e){for(let r=0;r<16;r++)i[r]=e[2*r]+(e[2*r+1]<<8);i[15]&=32767}function er(i,e,r){for(let t=0;t<16;t++)i[t]=e[t]+r[t]}function rr(i,e,r){for(let t=0;t<16;t++)i[t]=e[t]-r[t]}function le(i,e,r){let t,s,n=0,o=0,a=0,c=0,h=0,d=0,l=0,p=0,f=0,g=0,w=0,b=0,v=0,x=0,I=0,S=0,T=0,L=0,y=0,m=0,k=0,$=0,O=0,C=0,R=0,N=0,G=0,H=0,q=0,j=0,re=0,Y=r[0],Z=r[1],V=r[2],J=r[3],X=r[4],u=r[5],E=r[6],_=r[7],D=r[8],A=r[9],U=r[10],F=r[11],M=r[12],Q=r[13],z=r[14],ee=r[15];t=e[0],n+=t*Y,o+=t*Z,a+=t*V,c+=t*J,h+=t*X,d+=t*u,l+=t*E,p+=t*_,f+=t*D,g+=t*A,w+=t*U,b+=t*F,v+=t*M,x+=t*Q,I+=t*z,S+=t*ee,t=e[1],o+=t*Y,a+=t*Z,c+=t*V,h+=t*J,d+=t*X,l+=t*u,p+=t*E,f+=t*_,g+=t*D,w+=t*A,b+=t*U,v+=t*F,x+=t*M,I+=t*Q,S+=t*z,T+=t*ee,t=e[2],a+=t*Y,c+=t*Z,h+=t*V,d+=t*J,l+=t*X,p+=t*u,f+=t*E,g+=t*_,w+=t*D,b+=t*A,v+=t*U,x+=t*F,I+=t*M,S+=t*Q,T+=t*z,L+=t*ee,t=e[3],c+=t*Y,h+=t*Z,d+=t*V,l+=t*J,p+=t*X,f+=t*u,g+=t*E,w+=t*_,b+=t*D,v+=t*A,x+=t*U,I+=t*F,S+=t*M,T+=t*Q,L+=t*z,y+=t*ee,t=e[4],h+=t*Y,d+=t*Z,l+=t*V,p+=t*J,f+=t*X,g+=t*u,w+=t*E,b+=t*_,v+=t*D,x+=t*A,I+=t*U,S+=t*F,T+=t*M,L+=t*Q,y+=t*z,m+=t*ee,t=e[5],d+=t*Y,l+=t*Z,p+=t*V,f+=t*J,g+=t*X,w+=t*u,b+=t*E,v+=t*_,x+=t*D,I+=t*A,S+=t*U,T+=t*F,L+=t*M,y+=t*Q,m+=t*z,k+=t*ee,t=e[6],l+=t*Y,p+=t*Z,f+=t*V,g+=t*J,w+=t*X,b+=t*u,v+=t*E,x+=t*_,I+=t*D,S+=t*A,T+=t*U,L+=t*F,y+=t*M,m+=t*Q,k+=t*z,$+=t*ee,t=e[7],p+=t*Y,f+=t*Z,g+=t*V,w+=t*J,b+=t*X,v+=t*u,x+=t*E,I+=t*_,S+=t*D,T+=t*A,L+=t*U,y+=t*F,m+=t*M,k+=t*Q,$+=t*z,O+=t*ee,t=e[8],f+=t*Y,g+=t*Z,w+=t*V,b+=t*J,v+=t*X,x+=t*u,I+=t*E,S+=t*_,T+=t*D,L+=t*A,y+=t*U,m+=t*F,k+=t*M,$+=t*Q,O+=t*z,C+=t*ee,t=e[9],g+=t*Y,w+=t*Z,b+=t*V,v+=t*J,x+=t*X,I+=t*u,S+=t*E,T+=t*_,L+=t*D,y+=t*A,m+=t*U,k+=t*F,$+=t*M,O+=t*Q,C+=t*z,R+=t*ee,t=e[10],w+=t*Y,b+=t*Z,v+=t*V,x+=t*J,I+=t*X,S+=t*u,T+=t*E,L+=t*_,y+=t*D,m+=t*A,k+=t*U,$+=t*F,O+=t*M,C+=t*Q,R+=t*z,N+=t*ee,t=e[11],b+=t*Y,v+=t*Z,x+=t*V,I+=t*J,S+=t*X,T+=t*u,L+=t*E,y+=t*_,m+=t*D,k+=t*A,$+=t*U,O+=t*F,C+=t*M,R+=t*Q,N+=t*z,G+=t*ee,t=e[12],v+=t*Y,x+=t*Z,I+=t*V,S+=t*J,T+=t*X,L+=t*u,y+=t*E,m+=t*_,k+=t*D,$+=t*A,O+=t*U,C+=t*F,R+=t*M,N+=t*Q,G+=t*z,H+=t*ee,t=e[13],x+=t*Y,I+=t*Z,S+=t*V,T+=t*J,L+=t*X,y+=t*u,m+=t*E,k+=t*_,$+=t*D,O+=t*A,C+=t*U,R+=t*F,N+=t*M,G+=t*Q,H+=t*z,q+=t*ee,t=e[14],I+=t*Y,S+=t*Z,T+=t*V,L+=t*J,y+=t*X,m+=t*u,k+=t*E,$+=t*_,O+=t*D,C+=t*A,R+=t*U,N+=t*F,G+=t*M,H+=t*Q,q+=t*z,j+=t*ee,t=e[15],S+=t*Y,T+=t*Z,L+=t*V,y+=t*J,m+=t*X,k+=t*u,$+=t*E,O+=t*_,C+=t*D,R+=t*A,N+=t*U,G+=t*F,H+=t*M,q+=t*Q,j+=t*z,re+=t*ee,n+=38*T,o+=38*L,a+=38*y,c+=38*m,h+=38*k,d+=38*$,l+=38*O,p+=38*C,f+=38*R,g+=38*N,w+=38*G,b+=38*H,v+=38*q,x+=38*j,I+=38*re,s=1,t=n+s+65535,s=Math.floor(t/65536),n=t-s*65536,t=o+s+65535,s=Math.floor(t/65536),o=t-s*65536,t=a+s+65535,s=Math.floor(t/65536),a=t-s*65536,t=c+s+65535,s=Math.floor(t/65536),c=t-s*65536,t=h+s+65535,s=Math.floor(t/65536),h=t-s*65536,t=d+s+65535,s=Math.floor(t/65536),d=t-s*65536,t=l+s+65535,s=Math.floor(t/65536),l=t-s*65536,t=p+s+65535,s=Math.floor(t/65536),p=t-s*65536,t=f+s+65535,s=Math.floor(t/65536),f=t-s*65536,t=g+s+65535,s=Math.floor(t/65536),g=t-s*65536,t=w+s+65535,s=Math.floor(t/65536),w=t-s*65536,t=b+s+65535,s=Math.floor(t/65536),b=t-s*65536,t=v+s+65535,s=Math.floor(t/65536),v=t-s*65536,t=x+s+65535,s=Math.floor(t/65536),x=t-s*65536,t=I+s+65535,s=Math.floor(t/65536),I=t-s*65536,t=S+s+65535,s=Math.floor(t/65536),S=t-s*65536,n+=s-1+37*(s-1),s=1,t=n+s+65535,s=Math.floor(t/65536),n=t-s*65536,t=o+s+65535,s=Math.floor(t/65536),o=t-s*65536,t=a+s+65535,s=Math.floor(t/65536),a=t-s*65536,t=c+s+65535,s=Math.floor(t/65536),c=t-s*65536,t=h+s+65535,s=Math.floor(t/65536),h=t-s*65536,t=d+s+65535,s=Math.floor(t/65536),d=t-s*65536,t=l+s+65535,s=Math.floor(t/65536),l=t-s*65536,t=p+s+65535,s=Math.floor(t/65536),p=t-s*65536,t=f+s+65535,s=Math.floor(t/65536),f=t-s*65536,t=g+s+65535,s=Math.floor(t/65536),g=t-s*65536,t=w+s+65535,s=Math.floor(t/65536),w=t-s*65536,t=b+s+65535,s=Math.floor(t/65536),b=t-s*65536,t=v+s+65535,s=Math.floor(t/65536),v=t-s*65536,t=x+s+65535,s=Math.floor(t/65536),x=t-s*65536,t=I+s+65535,s=Math.floor(t/65536),I=t-s*65536,t=S+s+65535,s=Math.floor(t/65536),S=t-s*65536,n+=s-1+37*(s-1),i[0]=n,i[1]=o,i[2]=a,i[3]=c,i[4]=h,i[5]=d,i[6]=l,i[7]=p,i[8]=f,i[9]=g,i[10]=w,i[11]=b,i[12]=v,i[13]=x,i[14]=I,i[15]=S}function tr(i,e){le(i,e,e)}function Dl(i,e){let r=te(),t;for(t=0;t<16;t++)r[t]=e[t];for(t=253;t>=0;t--)tr(r,r),t!==2&&t!==4&&le(r,r,e);for(t=0;t<16;t++)i[t]=r[t]}function ky(i,e){let r=te(),t;for(t=0;t<16;t++)r[t]=e[t];for(t=250;t>=0;t--)tr(r,r),t!==1&&le(r,r,e);for(t=0;t<16;t++)i[t]=r[t]}function Oa(i,e){let r=te(),t=te(),s=te(),n=te(),o=te(),a=te(),c=te(),h=te(),d=te();rr(r,i[1],i[0]),rr(d,e[1],e[0]),le(r,r,d),er(t,i[0],i[1]),er(d,e[0],e[1]),le(t,t,d),le(s,i[3],e[3]),le(s,s,Uy),le(n,i[2],e[2]),er(n,n,n),rr(o,t,r),rr(a,n,s),er(c,n,s),er(h,t,r),le(i[0],o,a),le(i[1],h,c),le(i[2],c,a),le(i[3],o,h)}function _l(i,e,r){for(let t=0;t<4;t++)xl(i[t],e[t],r)}function La(i,e){let r=te(),t=te(),s=te();Dl(s,e[2]),le(r,e[0],s),le(t,e[1],s),ai(i,t),i[31]^=Il(r)<<7}function Tl(i,e,r){Lt(i[0],Aa),Lt(i[1],Rr),Lt(i[2],Rr),Lt(i[3],Aa);for(let t=255;t>=0;--t){let s=r[t/8|0]>>(t&7)&1;_l(i,e,s),Oa(e,i),Oa(i,i),_l(i,e,s)}}function Ua(i,e){let r=[te(),te(),te(),te()];Lt(r[0],wl),Lt(r[1],bl),Lt(r[2],Rr),le(r[3],wl,bl),Tl(i,r,e)}function Rl(i){if(i.length!==ue.SEED_LENGTH)throw new Error(`ed25519: seed must be ${ue.SEED_LENGTH} bytes`);let e=(0,oi.hash)(i);e[0]&=248,e[31]&=127,e[31]|=64;let r=new Uint8Array(32),t=[te(),te(),te(),te()];Ua(t,e),La(r,t);let s=new Uint8Array(64);return s.set(i),s.set(r,32),{publicKey:r,secretKey:s}}ue.generateKeyPairFromSeed=Rl;function By(i){let e=(0,Oy.randomBytes)(32,i),r=Rl(e);return(0,vl.wipe)(e),r}ue.generateKeyPair=By;function qy(i){if(i.length!==ue.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${ue.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(i.subarray(32))}ue.extractPublicKeyFromSecretKey=qy;var Na=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function Cl(i,e){let r,t,s,n;for(t=63;t>=32;--t){for(r=0,s=t-32,n=t-12;s<n;++s)e[s]+=r-16*e[t]*Na[s-(t-32)],r=Math.floor((e[s]+128)/256),e[s]-=r*256;e[s]+=r,e[t]=0}for(r=0,s=0;s<32;s++)e[s]+=r-(e[31]>>4)*Na[s],r=e[s]>>8,e[s]&=255;for(s=0;s<32;s++)e[s]-=r*Na[s];for(t=0;t<32;t++)e[t+1]+=e[t]>>8,i[t]=e[t]&255}function Pa(i){let e=new Float64Array(64);for(let r=0;r<64;r++)e[r]=i[r];for(let r=0;r<64;r++)i[r]=0;Cl(i,e)}function zy(i,e){let r=new Float64Array(64),t=[te(),te(),te(),te()],s=(0,oi.hash)(i.subarray(0,32));s[0]&=248,s[31]&=127,s[31]|=64;let n=new Uint8Array(64);n.set(s.subarray(32),32);let o=new oi.SHA512;o.update(n.subarray(32)),o.update(e);let a=o.digest();o.clean(),Pa(a),Ua(t,a),La(n,t),o.reset(),o.update(n.subarray(0,32)),o.update(i.subarray(32)),o.update(e);let c=o.digest();Pa(c);for(let h=0;h<32;h++)r[h]=a[h];for(let h=0;h<32;h++)for(let d=0;d<32;d++)r[h+d]+=c[h]*s[d];return Cl(n.subarray(32),r),n}ue.sign=zy;function Nl(i,e){let r=te(),t=te(),s=te(),n=te(),o=te(),a=te(),c=te();return Lt(i[2],Rr),Fy(i[1],e),tr(s,i[1]),le(n,s,Ly),rr(s,s,i[2]),er(n,i[2],n),tr(o,n),tr(a,o),le(c,a,o),le(r,c,s),le(r,r,n),ky(r,r),le(r,r,s),le(r,r,n),le(r,r,n),le(i[0],r,n),tr(t,i[0]),le(t,t,n),El(t,s)&&le(i[0],i[0],My),tr(t,i[0]),le(t,t,n),El(t,s)?-1:(Il(i[0])===e[31]>>7&&rr(i[0],Aa,i[0]),le(i[3],i[0],i[1]),0)}function Vy(i,e,r){let t=new Uint8Array(32),s=[te(),te(),te(),te()],n=[te(),te(),te(),te()];if(r.length!==ue.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${ue.SIGNATURE_LENGTH} bytes`);if(Nl(n,i))return!1;let o=new oi.SHA512;o.update(r.subarray(0,32)),o.update(i),o.update(e);let a=o.digest();return Pa(a),Tl(s,n,a),Ua(n,r.subarray(32)),Oa(s,n),La(t,s),!Sl(r,t)}ue.verify=Vy;function Ky(i){let e=[te(),te(),te(),te()];if(Nl(e,i))throw new Error("Ed25519: invalid public key");let r=te(),t=te(),s=e[1];er(r,Rr,s),rr(t,Rr,s),Dl(t,t),le(r,r,t);let n=new Uint8Array(32);return ai(n,r),n}ue.convertPublicKeyToX25519=Ky;function jy(i){let e=(0,oi.hash)(i.subarray(0,32));e[0]&=248,e[31]&=127,e[31]|=64;let r=new Uint8Array(e.subarray(0,32));return(0,vl.wipe)(e),r}ue.convertSecretKeyToX25519=jy});var Ol,Pl,ci,ui,Ma,Fa,Ll,Ul,Ml,ka,Fl,kl,Vn=P(()=>{Ol="EdDSA",Pl="JWT",ci=".",ui="base64url",Ma="utf8",Fa="utf8",Ll=":",Ul="did",Ml="key",ka="base58btc",Fl="z",kl="K36"});function hi(i=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(i):new Uint8Array(i)}var Kn=P(()=>{});function ir(i,e){e||(e=i.reduce((s,n)=>s+n.length,0));let r=hi(e),t=0;for(let s of i)r.set(s,t),t+=s.length;return r}var Ba=P(()=>{Kn()});function $y(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),t=0;t<r.length;t++)r[t]=255;for(var s=0;s<i.length;s++){var n=i.charAt(s),o=n.charCodeAt(0);if(r[o]!==255)throw new TypeError(n+" is ambiguous");r[o]=s}var a=i.length,c=i.charAt(0),h=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function l(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var w=0,b=0,v=0,x=g.length;v!==x&&g[v]===0;)v++,w++;for(var I=(x-v)*d+1>>>0,S=new Uint8Array(I);v!==x;){for(var T=g[v],L=0,y=I-1;(T!==0||L<b)&&y!==-1;y--,L++)T+=256*S[y]>>>0,S[y]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");b=L,v++}for(var m=I-b;m!==I&&S[m]===0;)m++;for(var k=c.repeat(w);m<I;++m)k+=i.charAt(S[m]);return k}function p(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var w=0;if(g[w]!==" "){for(var b=0,v=0;g[w]===c;)b++,w++;for(var x=(g.length-w)*h+1>>>0,I=new Uint8Array(x);g[w];){var S=r[g.charCodeAt(w)];if(S===255)return;for(var T=0,L=x-1;(S!==0||T<v)&&L!==-1;L--,T++)S+=a*I[L]>>>0,I[L]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");v=T,w++}if(g[w]!==" "){for(var y=x-v;y!==x&&I[y]===0;)y++;for(var m=new Uint8Array(b+(x-y)),k=b;y!==x;)m[k++]=I[y++];return m}}}function f(g){var w=p(g);if(w)return w;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:p,decode:f}}var Hy,Gy,Bl,ql=P(()=>{Hy=$y,Gy=Hy,Bl=Gy});var s3,zl,vt,Vl,Kl,Ut=P(()=>{s3=new Uint8Array(0),zl=(i,e)=>{if(i===e)return!0;if(i.byteLength!==e.byteLength)return!1;for(let r=0;r<i.byteLength;r++)if(i[r]!==e[r])return!1;return!0},vt=i=>{if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")},Vl=i=>new TextEncoder().encode(i),Kl=i=>new TextDecoder().decode(i)});var qa,za,Va,$l,Ka,Cr,Mt,Wy,Jy,ye,Ze=P(()=>{ql();Ut();qa=class{constructor(e,r,t){this.name=e,this.prefix=r,this.baseEncode=t}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},za=class{constructor(e,r,t){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=t}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return $l(this,e)}},Va=class{constructor(e){this.decoders=e}or(e){return $l(this,e)}decode(e){let r=e[0],t=this.decoders[r];if(t)return t.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},$l=(i,e)=>new Va({...i.decoders||{[i.prefix]:i},...e.decoders||{[e.prefix]:e}}),Ka=class{constructor(e,r,t,s){this.name=e,this.prefix=r,this.baseEncode=t,this.baseDecode=s,this.encoder=new qa(e,r,t),this.decoder=new za(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Cr=({name:i,prefix:e,encode:r,decode:t})=>new Ka(i,e,r,t),Mt=({prefix:i,name:e,alphabet:r})=>{let{encode:t,decode:s}=Bl(r,e);return Cr({prefix:i,name:e,encode:t,decode:n=>vt(s(n))})},Wy=(i,e,r,t)=>{let s={};for(let d=0;d<e.length;++d)s[e[d]]=d;let n=i.length;for(;i[n-1]==="=";)--n;let o=new Uint8Array(n*r/8|0),a=0,c=0,h=0;for(let d=0;d<n;++d){let l=s[i[d]];if(l===void 0)throw new SyntaxError(`Non-${t} character`);c=c<<r|l,a+=r,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Jy=(i,e,r)=>{let t=e[e.length-1]==="=",s=(1<<r)-1,n="",o=0,a=0;for(let c=0;c<i.length;++c)for(a=a<<8|i[c],o+=8;o>r;)o-=r,n+=e[s&a>>o];if(o&&(n+=e[s&a<<r-o]),t)for(;n.length*r&7;)n+="=";return n},ye=({name:i,prefix:e,bitsPerChar:r,alphabet:t})=>Cr({prefix:e,name:i,encode(s){return Jy(s,t,r)},decode(s){return Wy(s,t,r,i)}})});var ja={};Se(ja,{identity:()=>Yy});var Yy,Hl=P(()=>{Ze();Ut();Yy=Cr({prefix:"\0",name:"identity",encode:i=>Kl(i),decode:i=>Vl(i)})});var $a={};Se($a,{base2:()=>Xy});var Xy,Gl=P(()=>{Ze();Xy=ye({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1})});var Ha={};Se(Ha,{base8:()=>Qy});var Qy,Wl=P(()=>{Ze();Qy=ye({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3})});var Ga={};Se(Ga,{base10:()=>Zy});var Zy,Jl=P(()=>{Ze();Zy=Mt({prefix:"9",name:"base10",alphabet:"0123456789"})});var Wa={};Se(Wa,{base16:()=>ew,base16upper:()=>tw});var ew,tw,Yl=P(()=>{Ze();ew=ye({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),tw=ye({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4})});var Ja={};Se(Ja,{base32:()=>Nr,base32hex:()=>nw,base32hexpad:()=>aw,base32hexpadupper:()=>cw,base32hexupper:()=>ow,base32pad:()=>iw,base32padupper:()=>sw,base32upper:()=>rw,base32z:()=>uw});var Nr,rw,iw,sw,nw,ow,aw,cw,uw,Ya=P(()=>{Ze();Nr=ye({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),rw=ye({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),iw=ye({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),sw=ye({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),nw=ye({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ow=ye({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),aw=ye({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),cw=ye({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),uw=ye({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})});var Xa={};Se(Xa,{base36:()=>hw,base36upper:()=>lw});var hw,lw,Xl=P(()=>{Ze();hw=Mt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),lw=Mt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})});var Qa={};Se(Qa,{base58btc:()=>ht,base58flickr:()=>dw});var ht,dw,Za=P(()=>{Ze();ht=Mt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),dw=Mt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})});var ec={};Se(ec,{base64:()=>fw,base64pad:()=>pw,base64url:()=>gw,base64urlpad:()=>mw});var fw,pw,gw,mw,Ql=P(()=>{Ze();fw=ye({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),pw=ye({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),gw=ye({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),mw=ye({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})});var tc={};Se(tc,{base256emoji:()=>_w});function bw(i){return i.reduce((e,r)=>(e+=yw[r],e),"")}function Ew(i){let e=[];for(let r of i){let t=ww[r.codePointAt(0)];if(t===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(t)}return new Uint8Array(e)}var Zl,yw,ww,_w,ed=P(()=>{Ze();Zl=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),yw=Zl.reduce((i,e,r)=>(i[r]=e,i),[]),ww=Zl.reduce((i,e,r)=>(i[e.codePointAt(0)]=r,i),[]);_w=Cr({prefix:"\u{1F680}",name:"base256emoji",encode:bw,decode:Ew})});function id(i,e,r){e=e||[],r=r||0;for(var t=r;i>=Iw;)e[r++]=i&255|td,i/=128;for(;i&Sw;)e[r++]=i&255|td,i>>>=7;return e[r]=i|0,id.bytes=r-t+1,e}function rc(i,t){var r=0,t=t||0,s=0,n=t,o,a=i.length;do{if(n>=a)throw rc.bytes=0,new RangeError("Could not decode varint");o=i[n++],r+=s<28?(o&rd)<<s:(o&rd)*Math.pow(2,s),s+=7}while(o>=Tw);return rc.bytes=n-t,r}var vw,td,xw,Sw,Iw,Dw,Tw,rd,Rw,Cw,Nw,Aw,Ow,Pw,Lw,Uw,Mw,Fw,kw,Bw,li,sd=P(()=>{vw=id,td=128,xw=127,Sw=~xw,Iw=Math.pow(2,31);Dw=rc,Tw=128,rd=127;Rw=Math.pow(2,7),Cw=Math.pow(2,14),Nw=Math.pow(2,21),Aw=Math.pow(2,28),Ow=Math.pow(2,35),Pw=Math.pow(2,42),Lw=Math.pow(2,49),Uw=Math.pow(2,56),Mw=Math.pow(2,63),Fw=function(i){return i<Rw?1:i<Cw?2:i<Nw?3:i<Aw?4:i<Ow?5:i<Pw?6:i<Lw?7:i<Uw?8:i<Mw?9:10},kw={encode:vw,decode:Dw,encodingLength:Fw},Bw=kw,li=Bw});var di,Ar,Or,$n=P(()=>{sd();di=(i,e=0)=>[li.decode(i,e),li.decode.bytes],Ar=(i,e,r=0)=>(li.encode(i,e,r),e),Or=i=>li.encodingLength(i)});var sr,nd,od,Pr,pi=P(()=>{Ut();$n();sr=(i,e)=>{let r=e.byteLength,t=Or(i),s=t+Or(r),n=new Uint8Array(s+r);return Ar(i,n,0),Ar(r,n,t),n.set(e,s),new Pr(i,r,e,n)},nd=i=>{let e=vt(i),[r,t]=di(e),[s,n]=di(e.subarray(t)),o=e.subarray(t+n);if(o.byteLength!==s)throw new Error("Incorrect length");return new Pr(r,s,o,e)},od=(i,e)=>i===e?!0:i.code===e.code&&i.size===e.size&&zl(i.bytes,e.bytes),Pr=class{constructor(e,r,t,s){this.code=e,this.size=r,this.digest=t,this.bytes=s}}});var sc,ic,nc=P(()=>{pi();sc=({name:i,code:e,encode:r})=>new ic(i,e,r),ic=class{constructor(e,r,t){this.name=e,this.code=r,this.encode=t}digest(e){if(e instanceof Uint8Array){let r=this.encode(e);return r instanceof Uint8Array?sr(this.code,r):r.then(t=>sr(this.code,t))}else throw Error("Unknown type, must be binary type")}}});var oc={};Se(oc,{sha256:()=>qw,sha512:()=>zw});var cd,qw,zw,ud=P(()=>{nc();cd=i=>async e=>new Uint8Array(await crypto.subtle.digest(i,e)),qw=sc({name:"sha2-256",code:18,encode:cd("SHA-256")}),zw=sc({name:"sha2-512",code:19,encode:cd("SHA-512")})});var ac={};Se(ac,{identity:()=>jw});var hd,Vw,ld,Kw,jw,dd=P(()=>{Ut();pi();hd=0,Vw="identity",ld=vt,Kw=i=>sr(hd,ld(i)),jw={code:hd,name:Vw,encode:ld,digest:Kw}});var fd=P(()=>{Ut()});var I3,D3,pd=P(()=>{I3=new TextEncoder,D3=new TextDecoder});var Wn,Gw,Ww,Jw,gi,Yw,gd,md,Hn,Gn,Xw,Qw,Zw,yd=P(()=>{$n();pi();Za();Ya();Ut();Wn=class i{constructor(e,r,t,s){this.code=r,this.version=e,this.multihash=t,this.bytes=s,this.byteOffset=s.byteOffset,this.byteLength=s.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:Gn,byteLength:Gn,code:Hn,version:Hn,multihash:Hn,bytes:Hn,_baseCache:Gn,asCID:Gn})}toV0(){switch(this.version){case 0:return this;default:{let{code:e,multihash:r}=this;if(e!==gi)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==Yw)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return i.createV0(r)}}}toV1(){switch(this.version){case 0:{let{code:e,digest:r}=this.multihash,t=sr(e,r);return i.createV1(this.code,t)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&od(this.multihash,e.multihash)}toString(e){let{bytes:r,version:t,_baseCache:s}=this;switch(t){case 0:return Ww(r,s,e||ht.encoder);default:return Jw(r,s,e||Nr.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return Qw(/^0\.0/,Zw),!!(e&&(e[md]||e.asCID===e))}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof i)return e;if(e!=null&&e.asCID===e){let{version:r,code:t,multihash:s,bytes:n}=e;return new i(r,t,s,n||gd(r,t,s.bytes))}else if(e!=null&&e[md]===!0){let{version:r,multihash:t,code:s}=e,n=nd(t);return i.create(r,s,n)}else return null}static create(e,r,t){if(typeof r!="number")throw new Error("String codecs are no longer supported");switch(e){case 0:{if(r!==gi)throw new Error(`Version 0 CID must use dag-pb (code: ${gi}) block encoding`);return new i(e,r,t,t.bytes)}case 1:{let s=gd(e,r,t.bytes);return new i(e,r,t,s)}default:throw new Error("Invalid version")}}static createV0(e){return i.create(0,gi,e)}static createV1(e,r){return i.create(1,e,r)}static decode(e){let[r,t]=i.decodeFirst(e);if(t.length)throw new Error("Incorrect length");return r}static decodeFirst(e){let r=i.inspectBytes(e),t=r.size-r.multihashSize,s=vt(e.subarray(t,t+r.multihashSize));if(s.byteLength!==r.multihashSize)throw new Error("Incorrect length");let n=s.subarray(r.multihashSize-r.digestSize),o=new Pr(r.multihashCode,r.digestSize,n,s);return[r.version===0?i.createV0(o):i.createV1(r.codec,o),e.subarray(r.size)]}static inspectBytes(e){let r=0,t=()=>{let[l,p]=di(e.subarray(r));return r+=p,l},s=t(),n=gi;if(s===18?(s=0,r=0):s===1&&(n=t()),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);let o=r,a=t(),c=t(),h=r+c,d=h-o;return{version:s,codec:n,multihashCode:a,digestSize:c,multihashSize:d,size:h}}static parse(e,r){let[t,s]=Gw(e,r),n=i.decode(s);return n._baseCache.set(t,e),n}},Gw=(i,e)=>{switch(i[0]){case"Q":{let r=e||ht;return[ht.prefix,r.decode(`${ht.prefix}${i}`)]}case ht.prefix:{let r=e||ht;return[ht.prefix,r.decode(i)]}case Nr.prefix:{let r=e||Nr;return[Nr.prefix,r.decode(i)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[i[0],e.decode(i)]}}},Ww=(i,e,r)=>{let{prefix:t}=r;if(t!==ht.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let s=e.get(t);if(s==null){let n=r.encode(i).slice(1);return e.set(t,n),n}else return s},Jw=(i,e,r)=>{let{prefix:t}=r,s=e.get(t);if(s==null){let n=r.encode(i);return e.set(t,n),n}else return s},gi=112,Yw=18,gd=(i,e,r)=>{let t=Or(i),s=t+Or(e),n=new Uint8Array(s+r.byteLength);return Ar(i,n,0),Ar(e,n,t),n.set(r,s),n},md=Symbol.for("@ipld/js-cid/CID"),Hn={writable:!1,configurable:!1,enumerable:!0},Gn={writable:!1,enumerable:!1,configurable:!1},Xw="0.0.0-dev",Qw=(i,e)=>{if(i.test(Xw))console.warn(e);else throw new Error(e)},Zw=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`});var wd=P(()=>{yd();$n();Ut();nc();pi()});var cc,L3,bd=P(()=>{Hl();Gl();Wl();Jl();Yl();Ya();Xl();Za();Ql();ed();ud();dd();fd();pd();wd();cc={...ja,...$a,...Ha,...Ga,...Wa,...Ja,...Xa,...Qa,...ec,...tc},L3={...oc,...ac}});function _d(i,e,r,t){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:r},decoder:{decode:t}}}var Ed,uc,eb,Jn,hc=P(()=>{bd();Kn();Ed=_d("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),uc=_d("ascii","a",i=>{let e="a";for(let r=0;r<i.length;r++)e+=String.fromCharCode(i[r]);return e},i=>{i=i.substring(1);let e=hi(i.length);for(let r=0;r<i.length;r++)e[r]=i.charCodeAt(r);return e}),eb={utf8:Ed,"utf-8":Ed,hex:cc.base16,latin1:uc,ascii:uc,binary:uc,...cc},Jn=eb});function we(i,e="utf8"){let r=Jn[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i.buffer,i.byteOffset,i.byteLength).toString("utf8"):r.encoder.encode(i).substring(1)}var lc=P(()=>{hc()});function _e(i,e="utf8"){let r=Jn[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i,"utf8"):r.decoder.decode(`${r.prefix}${i}`)}var dc=P(()=>{hc()});function vd(i){return ut(we(_e(i,ui),Ma))}function Yn(i){return we(_e($e(i),Ma),ui)}function Xn(i){let e=_e(kl,ka),r=Fl+we(ir([e,i]),ka);return[Ul,Ml,r].join(Ll)}function tb(i){return we(i,ui)}function rb(i){return _e(i,ui)}function xd(i){return _e([Yn(i.header),Yn(i.payload)].join(ci),Fa)}function Sd(i){return[Yn(i.header),Yn(i.payload),tb(i.signature)].join(ci)}function Lr(i){let e=i.split(ci),r=vd(e[0]),t=vd(e[1]),s=rb(e[2]),n=_e(e.slice(0,2).join(ci),Fa);return{header:r,payload:t,signature:s,data:n}}var fc=P(()=>{Ba();lc();dc();Sr();Vn()});function pc(i=(0,Id.randomBytes)(32)){return mi.generateKeyPairFromSeed(i)}async function Td(i,e,r,t,s=(0,Dd.fromMiliseconds)(Date.now())){let n={alg:Ol,typ:Pl},o=Xn(t.publicKey),a=s+r,c={iss:o,sub:i,aud:e,iat:s,exp:a},h=xd({header:n,payload:c}),d=mi.sign(t.secretKey,h);return Sd({header:n,payload:c,signature:d})}var mi,Id,Dd,Rd=P(()=>{mi=pe(Al()),Id=pe(ni()),Dd=pe(xr());Vn();fc()});var Cd=P(()=>{});var Qn=P(()=>{Rd();Vn();Cd();fc()});function Ld(i){return i?Pd(i):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new ub:typeof navigator<"u"?Pd(navigator.userAgent):gb()}function fb(i){return i!==""&&db.reduce(function(e,r){var t=r[0],s=r[1];if(e)return e;var n=s.exec(i);return!!n&&[t,n]},!1)}function Pd(i){var e=fb(i);if(!e)return null;var r=e[0],t=e[1];if(r==="searchbot")return new cb;var s=t[1]&&t[1].split(".").join("_").split("_").slice(0,3);s?s.length<Ad&&(s=Nd(Nd([],s,!0),mb(Ad-s.length),!0)):s=[];var n=s.join("."),o=pb(i),a=lb.exec(i);return a&&a[1]?new ab(r,n,o,a[1]):new nb(r,n,o)}function pb(i){for(var e=0,r=Od.length;e<r;e++){var t=Od[e],s=t[0],n=t[1],o=n.exec(i);if(o)return s}return null}function gb(){var i=typeof process<"u"&&process.version;return i?new ob(process.version.slice(1)):null}function mb(i){for(var e=[],r=0;r<i;r++)e.push("0");return e}var Nd,nb,ob,ab,cb,ub,hb,lb,Ad,db,Od,Ud=P(()=>{Nd=function(i,e,r){if(r||arguments.length===2)for(var t=0,s=e.length,n;t<s;t++)(n||!(t in e))&&(n||(n=Array.prototype.slice.call(e,0,t)),n[t]=e[t]);return i.concat(n||Array.prototype.slice.call(e))},nb=function(){function i(e,r,t){this.name=e,this.version=r,this.os=t,this.type="browser"}return i}(),ob=function(){function i(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return i}(),ab=function(){function i(e,r,t,s){this.name=e,this.version=r,this.os=t,this.bot=s,this.type="bot-device"}return i}(),cb=function(){function i(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return i}(),ub=function(){function i(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return i}(),hb=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,lb=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Ad=3,db=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",hb]],Od=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]]});var Zn=oe(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.getLocalStorage=fe.getLocalStorageOrThrow=fe.getCrypto=fe.getCryptoOrThrow=fe.getLocation=fe.getLocationOrThrow=fe.getNavigator=fe.getNavigatorOrThrow=fe.getDocument=fe.getDocumentOrThrow=fe.getFromWindowOrThrow=fe.getFromWindow=void 0;function nr(i){let e;return typeof window<"u"&&typeof window[i]<"u"&&(e=window[i]),e}fe.getFromWindow=nr;function Ur(i){let e=nr(i);if(!e)throw new Error(`${i} is not defined in Window`);return e}fe.getFromWindowOrThrow=Ur;function yb(){return Ur("document")}fe.getDocumentOrThrow=yb;function wb(){return nr("document")}fe.getDocument=wb;function bb(){return Ur("navigator")}fe.getNavigatorOrThrow=bb;function Eb(){return nr("navigator")}fe.getNavigator=Eb;function _b(){return Ur("location")}fe.getLocationOrThrow=_b;function vb(){return nr("location")}fe.getLocation=vb;function xb(){return Ur("crypto")}fe.getCryptoOrThrow=xb;function Sb(){return nr("crypto")}fe.getCrypto=Sb;function Ib(){return Ur("localStorage")}fe.getLocalStorageOrThrow=Ib;function Db(){return nr("localStorage")}fe.getLocalStorage=Db});var Fd=oe(eo=>{"use strict";Object.defineProperty(eo,"__esModule",{value:!0});eo.getWindowMetadata=void 0;var Md=Zn();function Tb(){let i,e;try{i=Md.getDocumentOrThrow(),e=Md.getLocationOrThrow()}catch{return null}function r(){let l=i.getElementsByTagName("link"),p=[];for(let f=0;f<l.length;f++){let g=l[f],w=g.getAttribute("rel");if(w&&w.toLowerCase().indexOf("icon")>-1){let b=g.getAttribute("href");if(b)if(b.toLowerCase().indexOf("https:")===-1&&b.toLowerCase().indexOf("http:")===-1&&b.indexOf("//")!==0){let v=e.protocol+"//"+e.host;if(b.indexOf("/")===0)v+=b;else{let x=e.pathname.split("/");x.pop();let I=x.join("/");v+=I+"/"+b}p.push(v)}else if(b.indexOf("//")===0){let v=e.protocol+b;p.push(v)}else p.push(b)}}return p}function t(...l){let p=i.getElementsByTagName("meta");for(let f=0;f<p.length;f++){let g=p[f],w=["itemprop","property","name"].map(b=>g.getAttribute(b)).filter(b=>b?l.includes(b):!1);if(w.length&&w){let b=g.getAttribute("content");if(b)return b}}return""}function s(){let l=t("name","og:site_name","og:title","twitter:title");return l||(l=i.title),l}function n(){return t("description","og:description","twitter:description","keywords")}let o=s(),a=n(),c=e.origin,h=r();return{description:a,url:c,icons:h,name:o}}eo.getWindowMetadata=Tb});function gc(i){let e=new URLSearchParams(i),r={};for(let[t,s]of e.entries())r[t]=s;return r}function mc(i){let e=new URLSearchParams;for(let r in i)i[r]!=null&&e.append(r,i[r]);return e.toString()}var kd=P(()=>{});var Bd=oe((aS,to)=>{(function(){"use strict";var i="input is invalid type",e="finalize already called",r=typeof window=="object",t=r?window:{};t.JS_SHA3_NO_WINDOW&&(r=!1);var s=!r&&typeof self=="object",n=!t.JS_SHA3_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;n?t=window:s&&(t=self);var o=!t.JS_SHA3_NO_COMMON_JS&&typeof to=="object"&&to.exports,a=typeof define=="function"&&define.amd,c=!t.JS_SHA3_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",h="0123456789abcdef".split(""),d=[31,7936,2031616,520093696],l=[4,1024,262144,67108864],p=[1,256,65536,16777216],f=[6,1536,393216,100663296],g=[0,8,16,24],w=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],b=[224,256,384,512],v=[128,256],x=["hex","buffer","arrayBuffer","array","digest"],I={128:168,256:136};(t.JS_SHA3_NO_NODE_JS||!Array.isArray)&&(Array.isArray=function(u){return Object.prototype.toString.call(u)==="[object Array]"}),c&&(t.JS_SHA3_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)&&(ArrayBuffer.isView=function(u){return typeof u=="object"&&u.buffer&&u.buffer.constructor===ArrayBuffer});for(var S=function(u,E,_){return function(D){return new V(u,E,u).update(D)[_]()}},T=function(u,E,_){return function(D,A){return new V(u,E,A).update(D)[_]()}},L=function(u,E,_){return function(D,A,U,F){return N["cshake"+u].update(D,A,U,F)[_]()}},y=function(u,E,_){return function(D,A,U,F){return N["kmac"+u].update(D,A,U,F)[_]()}},m=function(u,E,_,D){for(var A=0;A<x.length;++A){var U=x[A];u[U]=E(_,D,U)}return u},k=function(u,E){var _=S(u,E,"hex");return _.create=function(){return new V(u,E,u)},_.update=function(D){return _.create().update(D)},m(_,S,u,E)},$=function(u,E){var _=T(u,E,"hex");return _.create=function(D){return new V(u,E,D)},_.update=function(D,A){return _.create(A).update(D)},m(_,T,u,E)},O=function(u,E){var _=I[u],D=L(u,E,"hex");return D.create=function(A,U,F){return!U&&!F?N["shake"+u].create(A):new V(u,E,A).bytepad([U,F],_)},D.update=function(A,U,F,M){return D.create(U,F,M).update(A)},m(D,L,u,E)},C=function(u,E){var _=I[u],D=y(u,E,"hex");return D.create=function(A,U,F){return new J(u,E,U).bytepad(["KMAC",F],_).bytepad([A],_)},D.update=function(A,U,F,M){return D.create(A,F,M).update(U)},m(D,y,u,E)},R=[{name:"keccak",padding:p,bits:b,createMethod:k},{name:"sha3",padding:f,bits:b,createMethod:k},{name:"shake",padding:d,bits:v,createMethod:$},{name:"cshake",padding:l,bits:v,createMethod:O},{name:"kmac",padding:l,bits:v,createMethod:C}],N={},G=[],H=0;H<R.length;++H)for(var q=R[H],j=q.bits,re=0;re<j.length;++re){var Y=q.name+"_"+j[re];if(G.push(Y),N[Y]=q.createMethod(j[re],q.padding),q.name!=="sha3"){var Z=q.name+j[re];G.push(Z),N[Z]=N[Y]}}function V(u,E,_){this.blocks=[],this.s=[],this.padding=E,this.outputBits=_,this.reset=!0,this.finalized=!1,this.block=0,this.start=0,this.blockCount=1600-(u<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=_>>5,this.extraBytes=(_&31)>>3;for(var D=0;D<50;++D)this.s[D]=0}V.prototype.update=function(u){if(this.finalized)throw new Error(e);var E,_=typeof u;if(_!=="string"){if(_==="object"){if(u===null)throw new Error(i);if(c&&u.constructor===ArrayBuffer)u=new Uint8Array(u);else if(!Array.isArray(u)&&(!c||!ArrayBuffer.isView(u)))throw new Error(i)}else throw new Error(i);E=!0}for(var D=this.blocks,A=this.byteCount,U=u.length,F=this.blockCount,M=0,Q=this.s,z,ee;M<U;){if(this.reset)for(this.reset=!1,D[0]=this.block,z=1;z<F+1;++z)D[z]=0;if(E)for(z=this.start;M<U&&z<A;++M)D[z>>2]|=u[M]<<g[z++&3];else for(z=this.start;M<U&&z<A;++M)ee=u.charCodeAt(M),ee<128?D[z>>2]|=ee<<g[z++&3]:ee<2048?(D[z>>2]|=(192|ee>>6)<<g[z++&3],D[z>>2]|=(128|ee&63)<<g[z++&3]):ee<55296||ee>=57344?(D[z>>2]|=(224|ee>>12)<<g[z++&3],D[z>>2]|=(128|ee>>6&63)<<g[z++&3],D[z>>2]|=(128|ee&63)<<g[z++&3]):(ee=65536+((ee&1023)<<10|u.charCodeAt(++M)&1023),D[z>>2]|=(240|ee>>18)<<g[z++&3],D[z>>2]|=(128|ee>>12&63)<<g[z++&3],D[z>>2]|=(128|ee>>6&63)<<g[z++&3],D[z>>2]|=(128|ee&63)<<g[z++&3]);if(this.lastByteIndex=z,z>=A){for(this.start=z-A,this.block=D[F],z=0;z<F;++z)Q[z]^=D[z];X(Q),this.reset=!0}else this.start=z}return this},V.prototype.encode=function(u,E){var _=u&255,D=1,A=[_];for(u=u>>8,_=u&255;_>0;)A.unshift(_),u=u>>8,_=u&255,++D;return E?A.push(D):A.unshift(D),this.update(A),A.length},V.prototype.encodeString=function(u){var E,_=typeof u;if(_!=="string"){if(_==="object"){if(u===null)throw new Error(i);if(c&&u.constructor===ArrayBuffer)u=new Uint8Array(u);else if(!Array.isArray(u)&&(!c||!ArrayBuffer.isView(u)))throw new Error(i)}else throw new Error(i);E=!0}var D=0,A=u.length;if(E)D=A;else for(var U=0;U<u.length;++U){var F=u.charCodeAt(U);F<128?D+=1:F<2048?D+=2:F<55296||F>=57344?D+=3:(F=65536+((F&1023)<<10|u.charCodeAt(++U)&1023),D+=4)}return D+=this.encode(D*8),this.update(u),D},V.prototype.bytepad=function(u,E){for(var _=this.encode(E),D=0;D<u.length;++D)_+=this.encodeString(u[D]);var A=E-_%E,U=[];return U.length=A,this.update(U),this},V.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var u=this.blocks,E=this.lastByteIndex,_=this.blockCount,D=this.s;if(u[E>>2]|=this.padding[E&3],this.lastByteIndex===this.byteCount)for(u[0]=u[_],E=1;E<_+1;++E)u[E]=0;for(u[_-1]|=2147483648,E=0;E<_;++E)D[E]^=u[E];X(D)}},V.prototype.toString=V.prototype.hex=function(){this.finalize();for(var u=this.blockCount,E=this.s,_=this.outputBlocks,D=this.extraBytes,A=0,U=0,F="",M;U<_;){for(A=0;A<u&&U<_;++A,++U)M=E[A],F+=h[M>>4&15]+h[M&15]+h[M>>12&15]+h[M>>8&15]+h[M>>20&15]+h[M>>16&15]+h[M>>28&15]+h[M>>24&15];U%u===0&&(X(E),A=0)}return D&&(M=E[A],F+=h[M>>4&15]+h[M&15],D>1&&(F+=h[M>>12&15]+h[M>>8&15]),D>2&&(F+=h[M>>20&15]+h[M>>16&15])),F},V.prototype.arrayBuffer=function(){this.finalize();var u=this.blockCount,E=this.s,_=this.outputBlocks,D=this.extraBytes,A=0,U=0,F=this.outputBits>>3,M;D?M=new ArrayBuffer(_+1<<2):M=new ArrayBuffer(F);for(var Q=new Uint32Array(M);U<_;){for(A=0;A<u&&U<_;++A,++U)Q[U]=E[A];U%u===0&&X(E)}return D&&(Q[A]=E[A],M=M.slice(0,F)),M},V.prototype.buffer=V.prototype.arrayBuffer,V.prototype.digest=V.prototype.array=function(){this.finalize();for(var u=this.blockCount,E=this.s,_=this.outputBlocks,D=this.extraBytes,A=0,U=0,F=[],M,Q;U<_;){for(A=0;A<u&&U<_;++A,++U)M=U<<2,Q=E[A],F[M]=Q&255,F[M+1]=Q>>8&255,F[M+2]=Q>>16&255,F[M+3]=Q>>24&255;U%u===0&&X(E)}return D&&(M=U<<2,Q=E[A],F[M]=Q&255,D>1&&(F[M+1]=Q>>8&255),D>2&&(F[M+2]=Q>>16&255)),F};function J(u,E,_){V.call(this,u,E,_)}J.prototype=new V,J.prototype.finalize=function(){return this.encode(this.outputBits,!0),V.prototype.finalize.call(this)};var X=function(u){var E,_,D,A,U,F,M,Q,z,ee,ns,os,as,cs,us,hs,ls,ds,fs,ps,gs,ms,ys,ws,bs,Es,_s,vs,xs,Ss,Is,Ds,Ts,Rs,Cs,Ns,As,Os,Ps,Ls,Us,Ms,Fs,ks,Bs,qs,zs,Vs,Ks,js,$s,Hs,Gs,Ws,Js,Ys,Xs,Qs,Zs,en,tn,rn,sn;for(D=0;D<48;D+=2)A=u[0]^u[10]^u[20]^u[30]^u[40],U=u[1]^u[11]^u[21]^u[31]^u[41],F=u[2]^u[12]^u[22]^u[32]^u[42],M=u[3]^u[13]^u[23]^u[33]^u[43],Q=u[4]^u[14]^u[24]^u[34]^u[44],z=u[5]^u[15]^u[25]^u[35]^u[45],ee=u[6]^u[16]^u[26]^u[36]^u[46],ns=u[7]^u[17]^u[27]^u[37]^u[47],os=u[8]^u[18]^u[28]^u[38]^u[48],as=u[9]^u[19]^u[29]^u[39]^u[49],E=os^(F<<1|M>>>31),_=as^(M<<1|F>>>31),u[0]^=E,u[1]^=_,u[10]^=E,u[11]^=_,u[20]^=E,u[21]^=_,u[30]^=E,u[31]^=_,u[40]^=E,u[41]^=_,E=A^(Q<<1|z>>>31),_=U^(z<<1|Q>>>31),u[2]^=E,u[3]^=_,u[12]^=E,u[13]^=_,u[22]^=E,u[23]^=_,u[32]^=E,u[33]^=_,u[42]^=E,u[43]^=_,E=F^(ee<<1|ns>>>31),_=M^(ns<<1|ee>>>31),u[4]^=E,u[5]^=_,u[14]^=E,u[15]^=_,u[24]^=E,u[25]^=_,u[34]^=E,u[35]^=_,u[44]^=E,u[45]^=_,E=Q^(os<<1|as>>>31),_=z^(as<<1|os>>>31),u[6]^=E,u[7]^=_,u[16]^=E,u[17]^=_,u[26]^=E,u[27]^=_,u[36]^=E,u[37]^=_,u[46]^=E,u[47]^=_,E=ee^(A<<1|U>>>31),_=ns^(U<<1|A>>>31),u[8]^=E,u[9]^=_,u[18]^=E,u[19]^=_,u[28]^=E,u[29]^=_,u[38]^=E,u[39]^=_,u[48]^=E,u[49]^=_,cs=u[0],us=u[1],qs=u[11]<<4|u[10]>>>28,zs=u[10]<<4|u[11]>>>28,vs=u[20]<<3|u[21]>>>29,xs=u[21]<<3|u[20]>>>29,en=u[31]<<9|u[30]>>>23,tn=u[30]<<9|u[31]>>>23,Ms=u[40]<<18|u[41]>>>14,Fs=u[41]<<18|u[40]>>>14,Rs=u[2]<<1|u[3]>>>31,Cs=u[3]<<1|u[2]>>>31,hs=u[13]<<12|u[12]>>>20,ls=u[12]<<12|u[13]>>>20,Vs=u[22]<<10|u[23]>>>22,Ks=u[23]<<10|u[22]>>>22,Ss=u[33]<<13|u[32]>>>19,Is=u[32]<<13|u[33]>>>19,rn=u[42]<<2|u[43]>>>30,sn=u[43]<<2|u[42]>>>30,Ws=u[5]<<30|u[4]>>>2,Js=u[4]<<30|u[5]>>>2,Ns=u[14]<<6|u[15]>>>26,As=u[15]<<6|u[14]>>>26,ds=u[25]<<11|u[24]>>>21,fs=u[24]<<11|u[25]>>>21,js=u[34]<<15|u[35]>>>17,$s=u[35]<<15|u[34]>>>17,Ds=u[45]<<29|u[44]>>>3,Ts=u[44]<<29|u[45]>>>3,ws=u[6]<<28|u[7]>>>4,bs=u[7]<<28|u[6]>>>4,Ys=u[17]<<23|u[16]>>>9,Xs=u[16]<<23|u[17]>>>9,Os=u[26]<<25|u[27]>>>7,Ps=u[27]<<25|u[26]>>>7,ps=u[36]<<21|u[37]>>>11,gs=u[37]<<21|u[36]>>>11,Hs=u[47]<<24|u[46]>>>8,Gs=u[46]<<24|u[47]>>>8,ks=u[8]<<27|u[9]>>>5,Bs=u[9]<<27|u[8]>>>5,Es=u[18]<<20|u[19]>>>12,_s=u[19]<<20|u[18]>>>12,Qs=u[29]<<7|u[28]>>>25,Zs=u[28]<<7|u[29]>>>25,Ls=u[38]<<8|u[39]>>>24,Us=u[39]<<8|u[38]>>>24,ms=u[48]<<14|u[49]>>>18,ys=u[49]<<14|u[48]>>>18,u[0]=cs^~hs&ds,u[1]=us^~ls&fs,u[10]=ws^~Es&vs,u[11]=bs^~_s&xs,u[20]=Rs^~Ns&Os,u[21]=Cs^~As&Ps,u[30]=ks^~qs&Vs,u[31]=Bs^~zs&Ks,u[40]=Ws^~Ys&Qs,u[41]=Js^~Xs&Zs,u[2]=hs^~ds&ps,u[3]=ls^~fs&gs,u[12]=Es^~vs&Ss,u[13]=_s^~xs&Is,u[22]=Ns^~Os&Ls,u[23]=As^~Ps&Us,u[32]=qs^~Vs&js,u[33]=zs^~Ks&$s,u[42]=Ys^~Qs&en,u[43]=Xs^~Zs&tn,u[4]=ds^~ps&ms,u[5]=fs^~gs&ys,u[14]=vs^~Ss&Ds,u[15]=xs^~Is&Ts,u[24]=Os^~Ls&Ms,u[25]=Ps^~Us&Fs,u[34]=Vs^~js&Hs,u[35]=Ks^~$s&Gs,u[44]=Qs^~en&rn,u[45]=Zs^~tn&sn,u[6]=ps^~ms&cs,u[7]=gs^~ys&us,u[16]=Ss^~Ds&ws,u[17]=Is^~Ts&bs,u[26]=Ls^~Ms&Rs,u[27]=Us^~Fs&Cs,u[36]=js^~Hs&ks,u[37]=$s^~Gs&Bs,u[46]=en^~rn&Ws,u[47]=tn^~sn&Js,u[8]=ms^~cs&hs,u[9]=ys^~us&ls,u[18]=Ds^~ws&Es,u[19]=Ts^~bs&_s,u[28]=Ms^~Rs&Ns,u[29]=Fs^~Cs&As,u[38]=Hs^~ks&qs,u[39]=Gs^~Bs&zs,u[48]=rn^~Ws&Ys,u[49]=sn^~Js&Xs,u[0]^=w[D],u[1]^=w[D+1]};if(o)to.exports=N;else{for(H=0;H<G.length;++H)t[G[H]]=N[G[H]];a&&define(function(){return N})}})()});var qd,zd=P(()=>{qd="logger/5.7.0"});function Cb(){try{let i=[];if(["NFD","NFC","NFKD","NFKC"].forEach(e=>{try{if("test".normalize(e)!=="test")throw new Error("bad normalize")}catch{i.push(e)}}),i.length)throw new Error("missing "+i.join(", "));if("\xE9".normalize("NFD")!=="e\u0301")throw new Error("broken implementation")}catch(i){return i.message}return null}var Vd,Kd,ro,jd,yc,$d,wc,et,Hd,Fe,Mr=P(()=>{"use strict";zd();Vd=!1,Kd=!1,ro={debug:1,default:2,info:2,warning:3,error:4,off:5},jd=ro.default,yc=null;$d=Cb();(function(i){i.DEBUG="DEBUG",i.INFO="INFO",i.WARNING="WARNING",i.ERROR="ERROR",i.OFF="OFF"})(wc||(wc={}));(function(i){i.UNKNOWN_ERROR="UNKNOWN_ERROR",i.NOT_IMPLEMENTED="NOT_IMPLEMENTED",i.UNSUPPORTED_OPERATION="UNSUPPORTED_OPERATION",i.NETWORK_ERROR="NETWORK_ERROR",i.SERVER_ERROR="SERVER_ERROR",i.TIMEOUT="TIMEOUT",i.BUFFER_OVERRUN="BUFFER_OVERRUN",i.NUMERIC_FAULT="NUMERIC_FAULT",i.MISSING_NEW="MISSING_NEW",i.INVALID_ARGUMENT="INVALID_ARGUMENT",i.MISSING_ARGUMENT="MISSING_ARGUMENT",i.UNEXPECTED_ARGUMENT="UNEXPECTED_ARGUMENT",i.CALL_EXCEPTION="CALL_EXCEPTION",i.INSUFFICIENT_FUNDS="INSUFFICIENT_FUNDS",i.NONCE_EXPIRED="NONCE_EXPIRED",i.REPLACEMENT_UNDERPRICED="REPLACEMENT_UNDERPRICED",i.UNPREDICTABLE_GAS_LIMIT="UNPREDICTABLE_GAS_LIMIT",i.TRANSACTION_REPLACED="TRANSACTION_REPLACED",i.ACTION_REJECTED="ACTION_REJECTED"})(et||(et={}));Hd="0123456789abcdef",Fe=class i{constructor(e){Object.defineProperty(this,"version",{enumerable:!0,value:e,writable:!1})}_log(e,r){let t=e.toLowerCase();ro[t]==null&&this.throwArgumentError("invalid log level name","logLevel",e),!(jd>ro[t])&&console.log.apply(console,r)}debug(...e){this._log(i.levels.DEBUG,e)}info(...e){this._log(i.levels.INFO,e)}warn(...e){this._log(i.levels.WARNING,e)}makeError(e,r,t){if(Kd)return this.makeError("censored error",r,{});r||(r=i.errors.UNKNOWN_ERROR),t||(t={});let s=[];Object.keys(t).forEach(c=>{let h=t[c];try{if(h instanceof Uint8Array){let d="";for(let l=0;l<h.length;l++)d+=Hd[h[l]>>4],d+=Hd[h[l]&15];s.push(c+"=Uint8Array(0x"+d+")")}else s.push(c+"="+JSON.stringify(h))}catch{s.push(c+"="+JSON.stringify(t[c].toString()))}}),s.push(`code=${r}`),s.push(`version=${this.version}`);let n=e,o="";switch(r){case et.NUMERIC_FAULT:{o="NUMERIC_FAULT";let c=e;switch(c){case"overflow":case"underflow":case"division-by-zero":o+="-"+c;break;case"negative-power":case"negative-width":o+="-unsupported";break;case"unbound-bitwise-result":o+="-unbound-result";break}break}case et.CALL_EXCEPTION:case et.INSUFFICIENT_FUNDS:case et.MISSING_NEW:case et.NONCE_EXPIRED:case et.REPLACEMENT_UNDERPRICED:case et.TRANSACTION_REPLACED:case et.UNPREDICTABLE_GAS_LIMIT:o=r;break}o&&(e+=" [ See: https://links.ethers.org/v5-errors-"+o+" ]"),s.length&&(e+=" ("+s.join(", ")+")");let a=new Error(e);return a.reason=n,a.code=r,Object.keys(t).forEach(function(c){a[c]=t[c]}),a}throwError(e,r,t){throw this.makeError(e,r,t)}throwArgumentError(e,r,t){return this.throwError(e,i.errors.INVALID_ARGUMENT,{argument:r,value:t})}assert(e,r,t,s){e||this.throwError(r,t,s)}assertArgument(e,r,t,s){e||this.throwArgumentError(r,t,s)}checkNormalize(e){e==null&&(e="platform missing String.prototype.normalize"),$d&&this.throwError("platform missing String.prototype.normalize",i.errors.UNSUPPORTED_OPERATION,{operation:"String.prototype.normalize",form:$d})}checkSafeUint53(e,r){typeof e=="number"&&(r==null&&(r="value not safe"),(e<0||e>=9007199254740991)&&this.throwError(r,i.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"out-of-safe-range",value:e}),e%1&&this.throwError(r,i.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"non-integer",value:e}))}checkArgumentCount(e,r,t){t?t=": "+t:t="",e<r&&this.throwError("missing argument"+t,i.errors.MISSING_ARGUMENT,{count:e,expectedCount:r}),e>r&&this.throwError("too many arguments"+t,i.errors.UNEXPECTED_ARGUMENT,{count:e,expectedCount:r})}checkNew(e,r){(e===Object||e==null)&&this.throwError("missing new",i.errors.MISSING_NEW,{name:r.name})}checkAbstract(e,r){e===r?this.throwError("cannot instantiate abstract class "+JSON.stringify(r.name)+" directly; use a sub-class",i.errors.UNSUPPORTED_OPERATION,{name:e.name,operation:"new"}):(e===Object||e==null)&&this.throwError("missing new",i.errors.MISSING_NEW,{name:r.name})}static globalLogger(){return yc||(yc=new i(qd)),yc}static setCensorship(e,r){if(!e&&r&&this.globalLogger().throwError("cannot permanently disable censorship",i.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"}),Vd){if(!e)return;this.globalLogger().throwError("error censorship permanent",i.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"})}Kd=!!e,Vd=!!r}static setLogLevel(e){let r=ro[e.toLowerCase()];if(r==null){i.globalLogger().warn("invalid log level - "+e);return}jd=r}static from(e){return new i(e)}};Fe.errors=et;Fe.levels=wc});var Gd,Wd=P(()=>{Gd="bytes/5.7.0"});function Yd(i){return!!i.toHexString}function yi(i){return i.slice||(i.slice=function(){let e=Array.prototype.slice.call(arguments);return yi(new Uint8Array(Array.prototype.slice.apply(i,e)))}),i}function Jd(i){return typeof i=="number"&&i==i&&i%1===0}function Xd(i){if(i==null)return!1;if(i.constructor===Uint8Array)return!0;if(typeof i=="string"||!Jd(i.length)||i.length<0)return!1;for(let e=0;e<i.length;e++){let r=i[e];if(!Jd(r)||r<0||r>=256)return!1}return!0}function ke(i,e){if(e||(e={}),typeof i=="number"){or.checkSafeUint53(i,"invalid arrayify value");let r=[];for(;i;)r.unshift(i&255),i=parseInt(String(i/256));return r.length===0&&r.push(0),yi(new Uint8Array(r))}if(e.allowMissingPrefix&&typeof i=="string"&&i.substring(0,2)!=="0x"&&(i="0x"+i),Yd(i)&&(i=i.toHexString()),wi(i)){let r=i.substring(2);r.length%2&&(e.hexPad==="left"?r="0"+r:e.hexPad==="right"?r+="0":or.throwArgumentError("hex data is odd-length","value",i));let t=[];for(let s=0;s<r.length;s+=2)t.push(parseInt(r.substring(s,s+2),16));return yi(new Uint8Array(t))}return Xd(i)?yi(new Uint8Array(i)):or.throwArgumentError("invalid arrayify value","value",i)}function Ec(i){let e=i.map(s=>ke(s)),r=e.reduce((s,n)=>s+n.length,0),t=new Uint8Array(r);return e.reduce((s,n)=>(t.set(n,s),s+n.length),0),yi(t)}function wi(i,e){return!(typeof i!="string"||!i.match(/^0x[0-9A-Fa-f]*$/)||e&&i.length!==2+2*e)}function bi(i,e){if(e||(e={}),typeof i=="number"){or.checkSafeUint53(i,"invalid hexlify value");let r="";for(;i;)r=bc[i&15]+r,i=Math.floor(i/16);return r.length?(r.length%2&&(r="0"+r),"0x"+r):"0x00"}if(typeof i=="bigint")return i=i.toString(16),i.length%2?"0x0"+i:"0x"+i;if(e.allowMissingPrefix&&typeof i=="string"&&i.substring(0,2)!=="0x"&&(i="0x"+i),Yd(i))return i.toHexString();if(wi(i))return i.length%2&&(e.hexPad==="left"?i="0x0"+i.substring(2):e.hexPad==="right"?i+="0":or.throwArgumentError("hex data is odd-length","value",i)),i.toLowerCase();if(Xd(i)){let r="0x";for(let t=0;t<i.length;t++){let s=i[t];r+=bc[(s&240)>>4]+bc[s&15]}return r}return or.throwArgumentError("invalid hexlify value","value",i)}function io(i,e,r){return typeof i!="string"?i=bi(i):(!wi(i)||i.length%2)&&or.throwArgumentError("invalid hexData","value",i),e=2+2*e,r!=null?"0x"+i.substring(e,2+2*r):"0x"+i.substring(e)}var or,bc,ar=P(()=>{"use strict";Mr();Wd();or=new Fe(Gd);bc="0123456789abcdef"});function Fr(i){return"0x"+Qd.default.keccak_256(ke(i))}var Qd,so=P(()=>{"use strict";Qd=pe(Bd());ar()});var _c,Zd,ef=P(()=>{_c=class{constructor(e){this.value=BigInt(e)}toString(e=10){return this.value.toString(e)}toNumber(){return Number(this.value)}},Zd=_c});var tf,rf=P(()=>{tf="bignumber/5.7.0"});function vc(i){return new Nb(i,36).toString(16)}var Nb,vS,sf=P(()=>{"use strict";ef();Mr();rf();Nb=Zd.BN,vS=new Fe(tf)});var nf=P(()=>{sf()});var of,af=P(()=>{of="strings/5.7.0"});function Ob(i,e,r,t,s){return cf.throwArgumentError(`invalid codepoint at offset ${e}; ${i}`,"bytes",r)}function uf(i,e,r,t,s){if(i===cr.BAD_PREFIX||i===cr.UNEXPECTED_CONTINUE){let n=0;for(let o=e+1;o<r.length&&r[o]>>6===2;o++)n++;return n}return i===cr.OVERRUN?r.length-e-1:0}function Pb(i,e,r,t,s){return i===cr.OVERLONG?(t.push(s),0):(t.push(65533),uf(i,e,r,t,s))}function _i(i,e=Ei.current){e!=Ei.current&&(cf.checkNormalize(),i=i.normalize(e));let r=[];for(let t=0;t<i.length;t++){let s=i.charCodeAt(t);if(s<128)r.push(s);else if(s<2048)r.push(s>>6|192),r.push(s&63|128);else if((s&64512)==55296){t++;let n=i.charCodeAt(t);if(t>=i.length||(n&64512)!==56320)throw new Error("invalid utf-8 string");let o=65536+((s&1023)<<10)+(n&1023);r.push(o>>18|240),r.push(o>>12&63|128),r.push(o>>6&63|128),r.push(o&63|128)}else r.push(s>>12|224),r.push(s>>6&63|128),r.push(s&63|128)}return ke(r)}var cf,Ei,cr,Lb,hf=P(()=>{"use strict";ar();Mr();af();cf=new Fe(of);(function(i){i.current="",i.NFC="NFC",i.NFD="NFD",i.NFKC="NFKC",i.NFKD="NFKD"})(Ei||(Ei={}));(function(i){i.UNEXPECTED_CONTINUE="unexpected continuation byte",i.BAD_PREFIX="bad codepoint prefix",i.OVERRUN="string overrun",i.MISSING_CONTINUE="missing continuation byte",i.OUT_OF_RANGE="out of UTF-8 range",i.UTF16_SURROGATE="UTF-16 surrogate",i.OVERLONG="overlong representation"})(cr||(cr={}));Lb=Object.freeze({error:Ob,ignore:uf,replace:Pb})});var lf=P(()=>{"use strict";hf()});function no(i){return typeof i=="string"&&(i=_i(i)),Fr(Ec([_i(df),_i(String(i.length)),i]))}var df,ff=P(()=>{ar();so();lf();df=`Ethereum Signed Message:
`});var pf,gf=P(()=>{pf="address/5.7.0"});function mf(i){wi(i,20)||vi.throwArgumentError("invalid address","address",i),i=i.toLowerCase();let e=i.substring(2).split(""),r=new Uint8Array(40);for(let s=0;s<40;s++)r[s]=e[s].charCodeAt(0);let t=ke(Fr(r));for(let s=0;s<40;s+=2)t[s>>1]>>4>=8&&(e[s]=e[s].toUpperCase()),(t[s>>1]&15)>=8&&(e[s+1]=e[s+1].toUpperCase());return"0x"+e.join("")}function kb(i){return Math.log10?Math.log10(i):Math.log(i)/Math.LN10}function Bb(i){i=i.toUpperCase(),i=i.substring(4)+i.substring(0,2)+"00";let e=i.split("").map(t=>xc[t]).join("");for(;e.length>=yf;){let t=e.substring(0,yf);e=parseInt(t,10)%97+e.substring(t.length)}let r=String(98-parseInt(e,10)%97);for(;r.length<2;)r="0"+r;return r}function wf(i){let e=null;if(typeof i!="string"&&vi.throwArgumentError("invalid address","address",i),i.match(/^(0x)?[0-9a-fA-F]{40}$/))i.substring(0,2)!=="0x"&&(i="0x"+i),e=mf(i),i.match(/([A-F].*[a-f])|([a-f].*[A-F])/)&&e!==i&&vi.throwArgumentError("bad address checksum","address",i);else if(i.match(/^XE[0-9]{2}[0-9A-Za-z]{30,31}$/)){for(i.substring(2,4)!==Bb(i)&&vi.throwArgumentError("bad icap checksum","address",i),e=vc(i.substring(4));e.length<40;)e="0"+e;e=mf("0x"+e)}else vi.throwArgumentError("invalid address","address",i);return e}var vi,Fb,xc,yf,bf=P(()=>{"use strict";ar();nf();so();Mr();gf();vi=new Fe(pf);Fb=9007199254740991;xc={};for(let i=0;i<10;i++)xc[String(i)]=String(i);for(let i=0;i<26;i++)xc[String.fromCharCode(65+i)]=String(10+i);yf=Math.floor(kb(Fb))});var Ef=P(()=>{"use strict";ff()});var Tc,Ft,Be,Df,Tf,Rf,Ge,_f,ge,lo,Cf,Sc,co,qb,Ic,Si,hr,W,vf,We,kt,oo,Nf,Rc,Ii,Di,uo,Cc,xi,xf,fo,zb,Dc,Af,po,ho,Vb,Of,Sf,ao,Kb,Pf,Lf,Uf,Ti,ur,jb,If,$b,Nc=P(()=>{Tc=2n**256n,Ft=Tc-0x1000003d1n,Be=Tc-0x14551231950b75fc4402da1732fc9bebfn,Df=0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798n,Tf=0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8n,Rf={p:Ft,n:Be,a:0n,b:7n,Gx:Df,Gy:Tf},Ge=32,_f=i=>W(W(i*i)*i+Rf.b),ge=(i="")=>{throw new Error(i)},lo=i=>typeof i=="bigint",Cf=i=>typeof i=="string",Sc=i=>lo(i)&&0n<i&&i<Ft,co=i=>lo(i)&&0n<i&&i<Be,qb=i=>i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array",Ic=(i,e)=>!qb(i)||typeof e=="number"&&e>0&&i.length!==e?ge("Uint8Array expected"):i,Si=i=>new Uint8Array(i),hr=(i,e)=>Ic(Cf(i)?Ii(i):Si(Ic(i)),e),W=(i,e=Ft)=>{let r=i%e;return r>=0n?r:e+r},vf=i=>i instanceof We?i:ge("Point expected"),We=class i{constructor(e,r,t){this.px=e,this.py=r,this.pz=t}static fromAffine(e){return e.x===0n&&e.y===0n?i.ZERO:new i(e.x,e.y,1n)}static fromHex(e){e=hr(e);let r,t=e[0],s=e.subarray(1),n=uo(s,0,Ge),o=e.length;if(o===33&&[2,3].includes(t)){Sc(n)||ge("Point hex invalid: x not FE");let a=zb(_f(n)),c=(a&1n)===1n;(t&1)===1!==c&&(a=W(-a)),r=new i(n,a,1n)}return o===65&&t===4&&(r=new i(n,uo(s,Ge,2*Ge),1n)),r?r.ok():ge("Point is not on curve")}static fromPrivateKey(e){return kt.mul(Dc(e))}get x(){return this.aff().x}get y(){return this.aff().y}equals(e){let{px:r,py:t,pz:s}=this,{px:n,py:o,pz:a}=vf(e),c=W(r*a),h=W(n*s),d=W(t*a),l=W(o*s);return c===h&&d===l}negate(){return new i(this.px,W(-this.py),this.pz)}double(){return this.add(this)}add(e){let{px:r,py:t,pz:s}=this,{px:n,py:o,pz:a}=vf(e),{a:c,b:h}=Rf,d=0n,l=0n,p=0n,f=W(h*3n),g=W(r*n),w=W(t*o),b=W(s*a),v=W(r+t),x=W(n+o);v=W(v*x),x=W(g+w),v=W(v-x),x=W(r+s);let I=W(n+a);return x=W(x*I),I=W(g+b),x=W(x-I),I=W(t+s),d=W(o+a),I=W(I*d),d=W(w+b),I=W(I-d),p=W(c*x),d=W(f*b),p=W(d+p),d=W(w-p),p=W(w+p),l=W(d*p),w=W(g+g),w=W(w+g),b=W(c*b),x=W(f*x),w=W(w+b),b=W(g-b),b=W(c*b),x=W(x+b),g=W(w*x),l=W(l+g),g=W(I*x),d=W(v*d),d=W(d-g),g=W(v*w),p=W(I*p),p=W(p+g),new i(d,l,p)}mul(e,r=!0){if(!r&&e===0n)return oo;if(co(e)||ge("invalid scalar"),this.equals(kt))return $b(e).p;let t=oo,s=kt;for(let n=this;e>0n;n=n.double(),e>>=1n)e&1n?t=t.add(n):r&&(s=s.add(n));return t}mulAddQUns(e,r,t){return this.mul(r,!1).add(e.mul(t,!1)).ok()}toAffine(){let{px:e,py:r,pz:t}=this;if(this.equals(oo))return{x:0n,y:0n};if(t===1n)return{x:e,y:r};let s=fo(t);return W(t*s)!==1n&&ge("invalid inverse"),{x:W(e*s),y:W(r*s)}}assertValidity(){let{x:e,y:r}=this.aff();return(!Sc(e)||!Sc(r))&&ge("Point invalid: x or y"),W(r*r)===_f(e)?this:ge("Point invalid: not on curve")}multiply(e){return this.mul(e)}aff(){return this.toAffine()}ok(){return this.assertValidity()}toHex(e=!0){let{x:r,y:t}=this.aff();return(e?(t&1n)===0n?"02":"03":"04")+xi(r)+(e?"":xi(t))}toRawBytes(e=!0){return Ii(this.toHex(e))}};We.BASE=new We(Df,Tf,1n);We.ZERO=new We(0n,1n,0n);({BASE:kt,ZERO:oo}=We),Nf=(i,e)=>i.toString(16).padStart(e,"0"),Rc=i=>Array.from(i).map(e=>Nf(e,2)).join(""),Ii=i=>{let e=i.length;(!Cf(i)||e%2)&&ge("hex invalid 1");let r=Si(e/2);for(let t=0;t<r.length;t++){let s=t*2,n=i.slice(s,s+2),o=Number.parseInt(n,16);(Number.isNaN(o)||o<0)&&ge("hex invalid 2"),r[t]=o}return r},Di=i=>BigInt("0x"+(Rc(i)||"0")),uo=(i,e,r)=>Di(i.slice(e,r)),Cc=i=>lo(i)&&i>=0n&&i<Tc?Ii(Nf(i,2*Ge)):ge("bigint expected"),xi=i=>Rc(Cc(i)),xf=(...i)=>{let e=Si(i.reduce((t,s)=>t+Ic(s).length,0)),r=0;return i.forEach(t=>{e.set(t,r),r+=t.length}),e},fo=(i,e=Ft)=>{(i===0n||e<=0n)&&ge("no inverse n="+i+" mod="+e);let r=W(i,e),t=e,s=0n,n=1n,o=1n,a=0n;for(;r!==0n;){let c=t/r,h=t%r,d=s-o*c,l=n-a*c;t=r,r=h,s=o,n=a,o=d,a=l}return t===1n?W(s,e):ge("no inverse")},zb=i=>{let e=1n;for(let r=i,t=(Ft+1n)/4n;t>0n;t>>=1n)t&1n&&(e=e*r%Ft),r=r*r%Ft;return W(e*e)===i?e:ge("sqrt invalid")},Dc=i=>(lo(i)||(i=Di(hr(i,Ge))),co(i)?i:ge("private key out of range")),Af=i=>i>Be>>1n,po=(i,e=!0)=>We.fromPrivateKey(i).toRawBytes(e),ho=class i{constructor(e,r,t){this.r=e,this.s=r,this.recovery=t,this.assertValidity()}static fromCompact(e){return e=hr(e,64),new i(uo(e,0,Ge),uo(e,Ge,2*Ge))}assertValidity(){return co(this.r)&&co(this.s)?this:ge()}addRecoveryBit(e){return new i(this.r,this.s,e)}hasHighS(){return Af(this.s)}normalizeS(){return this.hasHighS()?new i(this.r,W(this.s,Be),this.recovery):this}recoverPublicKey(e){let{r,s:t,recovery:s}=this;[0,1,2,3].includes(s)||ge("recovery id invalid");let n=Of(hr(e,Ge)),o=s===2||s===3?r+Be:r;o>=Ft&&ge("q.x invalid");let a=s&1?"03":"02",c=We.fromHex(a+xi(o)),h=fo(o,Be),d=W(-n*h,Be),l=W(t*h,Be);return kt.mulAddQUns(c,d,l)}toCompactRawBytes(){return Ii(this.toCompactHex())}toCompactHex(){return xi(this.r)+xi(this.s)}},Vb=i=>{let e=i.length*8-256,r=Di(i);return e>0?r>>BigInt(e):r},Of=i=>W(Vb(i),Be),Sf=()=>typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0,Kb={lowS:!0},Pf=(i,e,r,t=Kb)=>{let{lowS:s}=t;s==null&&(s=!0),"strict"in t&&ge("verify() legacy options not supported");let n,o,a,c=i&&typeof i=="object"&&"r"in i;!c&&hr(i).length!==2*Ge&&ge("signature must be 64 bytes");try{n=c?new ho(i.r,i.s).assertValidity():ho.fromCompact(i),o=Of(hr(e)),a=r instanceof We?r.ok():We.fromHex(r)}catch{return!1}if(!n)return!1;let{r:h,s:d}=n;if(s&&Af(d))return!1;let l;try{let f=fo(d,Be),g=W(o*f,Be),w=W(h*f,Be);l=kt.mulAddQUns(a,g,w).aff()}catch{return!1}return l?W(l.x,Be)===h:!1},Lf=i=>{i=hr(i);let e=Ge+8;(i.length<e||i.length>1024)&&ge("expected proper params");let r=W(Di(i),Be-1n)+1n;return Cc(r)},Uf={hexToBytes:Ii,bytesToHex:Rc,concatBytes:xf,bytesToNumberBE:Di,numberToBytesBE:Cc,mod:W,invert:fo,hmacSha256Async:async(i,...e)=>{let r=Sf(),t=r&&r.subtle;if(!t)return ge("etc.hmacSha256Async not set");let s=await t.importKey("raw",i,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return Si(await t.sign("HMAC",s,xf(...e)))},hmacSha256Sync:ao,hashToPrivateKey:Lf,randomBytes:(i=32)=>{let e=Sf();return(!e||!e.getRandomValues)&&ge("crypto.getRandomValues must be defined"),e.getRandomValues(Si(i))}},Ti={normPrivateKeyToScalar:Dc,isValidPrivateKey:i=>{try{return!!Dc(i)}catch{return!1}},randomPrivateKey:()=>Lf(Uf.randomBytes(Ge+16)),precompute(i=8,e=kt){return e.multiply(3n),e}};Object.defineProperties(Uf,{hmacSha256Sync:{configurable:!1,get(){return ao},set(i){ao||(ao=i)}}});ur=8,jb=()=>{let i=[],e=256/ur+1,r=kt,t=r;for(let s=0;s<e;s++){t=r,i.push(t);for(let n=1;n<2**(ur-1);n++)t=t.add(r),i.push(t);r=t.double()}return i},$b=i=>{let e=If||(If=jb()),r=(d,l)=>{let p=l.negate();return d?p:l},t=oo,s=kt,n=1+256/ur,o=2**(ur-1),a=BigInt(2**ur-1),c=2**ur,h=BigInt(ur);for(let d=0;d<n;d++){let l=d*o,p=Number(i&a);i>>=h,p>o&&(p-=c,i+=1n);let f=l,g=l+Math.abs(p)-1,w=d%2!==0,b=p<0;p===0?s=s.add(r(w,e[f])):t=t.add(r(b,e[g]))}return{p:t,f:s}}});function Mf(i,e=!1){let r=po(ke(i),e);return bi(r)}function Ff(i,e,r){let t=new Uint8Array(64);t.set(ke(e.r),0),t.set(ke(e.s),32);let s=Ti.recoverPublicKey(ke(i),t,r,!1);return bi(s)}var kf=P(()=>{Nc();ar()});var Bf,qf=P(()=>{Bf="transactions/5.7.0"});function Gb(i){let e=Mf(i);return wf(io(Fr(io(e,1)),12))}function Vf(i,e){return Gb(Ff(ke(i),e))}var lI,zf,Kf=P(()=>{"use strict";bf();ar();so();kf();Mr();qf();lI=new Fe(Bf);(function(i){i[i.legacy=0]="legacy",i[i.eip2930=1]="eip2930",i[i.eip1559=2]="eip1559"})(zf||(zf={}))});var $f=oe(go=>{"use strict";Object.defineProperty(go,"__esModule",{value:!0});var Ne=Ir(),Ac=He(),Wb=20;function Jb(i,e,r){for(var t=1634760805,s=857760878,n=2036477234,o=1797285236,a=r[3]<<24|r[2]<<16|r[1]<<8|r[0],c=r[7]<<24|r[6]<<16|r[5]<<8|r[4],h=r[11]<<24|r[10]<<16|r[9]<<8|r[8],d=r[15]<<24|r[14]<<16|r[13]<<8|r[12],l=r[19]<<24|r[18]<<16|r[17]<<8|r[16],p=r[23]<<24|r[22]<<16|r[21]<<8|r[20],f=r[27]<<24|r[26]<<16|r[25]<<8|r[24],g=r[31]<<24|r[30]<<16|r[29]<<8|r[28],w=e[3]<<24|e[2]<<16|e[1]<<8|e[0],b=e[7]<<24|e[6]<<16|e[5]<<8|e[4],v=e[11]<<24|e[10]<<16|e[9]<<8|e[8],x=e[15]<<24|e[14]<<16|e[13]<<8|e[12],I=t,S=s,T=n,L=o,y=a,m=c,k=h,$=d,O=l,C=p,R=f,N=g,G=w,H=b,q=v,j=x,re=0;re<Wb;re+=2)I=I+y|0,G^=I,G=G>>>16|G<<16,O=O+G|0,y^=O,y=y>>>20|y<<12,S=S+m|0,H^=S,H=H>>>16|H<<16,C=C+H|0,m^=C,m=m>>>20|m<<12,T=T+k|0,q^=T,q=q>>>16|q<<16,R=R+q|0,k^=R,k=k>>>20|k<<12,L=L+$|0,j^=L,j=j>>>16|j<<16,N=N+j|0,$^=N,$=$>>>20|$<<12,T=T+k|0,q^=T,q=q>>>24|q<<8,R=R+q|0,k^=R,k=k>>>25|k<<7,L=L+$|0,j^=L,j=j>>>24|j<<8,N=N+j|0,$^=N,$=$>>>25|$<<7,S=S+m|0,H^=S,H=H>>>24|H<<8,C=C+H|0,m^=C,m=m>>>25|m<<7,I=I+y|0,G^=I,G=G>>>24|G<<8,O=O+G|0,y^=O,y=y>>>25|y<<7,I=I+m|0,j^=I,j=j>>>16|j<<16,R=R+j|0,m^=R,m=m>>>20|m<<12,S=S+k|0,G^=S,G=G>>>16|G<<16,N=N+G|0,k^=N,k=k>>>20|k<<12,T=T+$|0,H^=T,H=H>>>16|H<<16,O=O+H|0,$^=O,$=$>>>20|$<<12,L=L+y|0,q^=L,q=q>>>16|q<<16,C=C+q|0,y^=C,y=y>>>20|y<<12,T=T+$|0,H^=T,H=H>>>24|H<<8,O=O+H|0,$^=O,$=$>>>25|$<<7,L=L+y|0,q^=L,q=q>>>24|q<<8,C=C+q|0,y^=C,y=y>>>25|y<<7,S=S+k|0,G^=S,G=G>>>24|G<<8,N=N+G|0,k^=N,k=k>>>25|k<<7,I=I+m|0,j^=I,j=j>>>24|j<<8,R=R+j|0,m^=R,m=m>>>25|m<<7;Ne.writeUint32LE(I+t|0,i,0),Ne.writeUint32LE(S+s|0,i,4),Ne.writeUint32LE(T+n|0,i,8),Ne.writeUint32LE(L+o|0,i,12),Ne.writeUint32LE(y+a|0,i,16),Ne.writeUint32LE(m+c|0,i,20),Ne.writeUint32LE(k+h|0,i,24),Ne.writeUint32LE($+d|0,i,28),Ne.writeUint32LE(O+l|0,i,32),Ne.writeUint32LE(C+p|0,i,36),Ne.writeUint32LE(R+f|0,i,40),Ne.writeUint32LE(N+g|0,i,44),Ne.writeUint32LE(G+w|0,i,48),Ne.writeUint32LE(H+b|0,i,52),Ne.writeUint32LE(q+v|0,i,56),Ne.writeUint32LE(j+x|0,i,60)}function jf(i,e,r,t,s){if(s===void 0&&(s=0),i.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(t.length<r.length)throw new Error("ChaCha: destination is shorter than source");var n,o;if(s===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");n=new Uint8Array(16),o=n.length-e.length,n.set(e,o)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");n=e,o=s}for(var a=new Uint8Array(64),c=0;c<r.length;c+=64){Jb(a,n,i);for(var h=c;h<c+64&&h<r.length;h++)t[h]=r[h]^a[h-c];Xb(n,0,o)}return Ac.wipe(a),s===0&&Ac.wipe(n),t}go.streamXOR=jf;function Yb(i,e,r,t){return t===void 0&&(t=0),Ac.wipe(r),jf(i,e,r,r,t)}go.stream=Yb;function Xb(i,e,r){for(var t=1;r--;)t=t+(i[e]&255)|0,i[e]=t&255,t>>>=8,e++;if(t>0)throw new Error("ChaCha: counter overflow")}});var mo=oe(kr=>{"use strict";Object.defineProperty(kr,"__esModule",{value:!0});function Qb(i,e,r){return~(i-1)&e|i-1&r}kr.select=Qb;function Zb(i,e){return(i|0)-(e|0)-1>>>31&1}kr.lessOrEqual=Zb;function Hf(i,e){if(i.length!==e.length)return 0;for(var r=0,t=0;t<i.length;t++)r|=i[t]^e[t];return 1&r-1>>>8}kr.compare=Hf;function e1(i,e){return i.length===0||e.length===0?!1:Hf(i,e)!==0}kr.equal=e1});var Wf=oe(xt=>{"use strict";Object.defineProperty(xt,"__esModule",{value:!0});var t1=mo(),yo=He();xt.DIGEST_LENGTH=16;var Gf=function(){function i(e){this.digestLength=xt.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var r=e[0]|e[1]<<8;this._r[0]=r&8191;var t=e[2]|e[3]<<8;this._r[1]=(r>>>13|t<<3)&8191;var s=e[4]|e[5]<<8;this._r[2]=(t>>>10|s<<6)&7939;var n=e[6]|e[7]<<8;this._r[3]=(s>>>7|n<<9)&8191;var o=e[8]|e[9]<<8;this._r[4]=(n>>>4|o<<12)&255,this._r[5]=o>>>1&8190;var a=e[10]|e[11]<<8;this._r[6]=(o>>>14|a<<2)&8191;var c=e[12]|e[13]<<8;this._r[7]=(a>>>11|c<<5)&8065;var h=e[14]|e[15]<<8;this._r[8]=(c>>>8|h<<8)&8191,this._r[9]=h>>>5&127,this._pad[0]=e[16]|e[17]<<8,this._pad[1]=e[18]|e[19]<<8,this._pad[2]=e[20]|e[21]<<8,this._pad[3]=e[22]|e[23]<<8,this._pad[4]=e[24]|e[25]<<8,this._pad[5]=e[26]|e[27]<<8,this._pad[6]=e[28]|e[29]<<8,this._pad[7]=e[30]|e[31]<<8}return i.prototype._blocks=function(e,r,t){for(var s=this._fin?0:2048,n=this._h[0],o=this._h[1],a=this._h[2],c=this._h[3],h=this._h[4],d=this._h[5],l=this._h[6],p=this._h[7],f=this._h[8],g=this._h[9],w=this._r[0],b=this._r[1],v=this._r[2],x=this._r[3],I=this._r[4],S=this._r[5],T=this._r[6],L=this._r[7],y=this._r[8],m=this._r[9];t>=16;){var k=e[r+0]|e[r+1]<<8;n+=k&8191;var $=e[r+2]|e[r+3]<<8;o+=(k>>>13|$<<3)&8191;var O=e[r+4]|e[r+5]<<8;a+=($>>>10|O<<6)&8191;var C=e[r+6]|e[r+7]<<8;c+=(O>>>7|C<<9)&8191;var R=e[r+8]|e[r+9]<<8;h+=(C>>>4|R<<12)&8191,d+=R>>>1&8191;var N=e[r+10]|e[r+11]<<8;l+=(R>>>14|N<<2)&8191;var G=e[r+12]|e[r+13]<<8;p+=(N>>>11|G<<5)&8191;var H=e[r+14]|e[r+15]<<8;f+=(G>>>8|H<<8)&8191,g+=H>>>5|s;var q=0,j=q;j+=n*w,j+=o*(5*m),j+=a*(5*y),j+=c*(5*L),j+=h*(5*T),q=j>>>13,j&=8191,j+=d*(5*S),j+=l*(5*I),j+=p*(5*x),j+=f*(5*v),j+=g*(5*b),q+=j>>>13,j&=8191;var re=q;re+=n*b,re+=o*w,re+=a*(5*m),re+=c*(5*y),re+=h*(5*L),q=re>>>13,re&=8191,re+=d*(5*T),re+=l*(5*S),re+=p*(5*I),re+=f*(5*x),re+=g*(5*v),q+=re>>>13,re&=8191;var Y=q;Y+=n*v,Y+=o*b,Y+=a*w,Y+=c*(5*m),Y+=h*(5*y),q=Y>>>13,Y&=8191,Y+=d*(5*L),Y+=l*(5*T),Y+=p*(5*S),Y+=f*(5*I),Y+=g*(5*x),q+=Y>>>13,Y&=8191;var Z=q;Z+=n*x,Z+=o*v,Z+=a*b,Z+=c*w,Z+=h*(5*m),q=Z>>>13,Z&=8191,Z+=d*(5*y),Z+=l*(5*L),Z+=p*(5*T),Z+=f*(5*S),Z+=g*(5*I),q+=Z>>>13,Z&=8191;var V=q;V+=n*I,V+=o*x,V+=a*v,V+=c*b,V+=h*w,q=V>>>13,V&=8191,V+=d*(5*m),V+=l*(5*y),V+=p*(5*L),V+=f*(5*T),V+=g*(5*S),q+=V>>>13,V&=8191;var J=q;J+=n*S,J+=o*I,J+=a*x,J+=c*v,J+=h*b,q=J>>>13,J&=8191,J+=d*w,J+=l*(5*m),J+=p*(5*y),J+=f*(5*L),J+=g*(5*T),q+=J>>>13,J&=8191;var X=q;X+=n*T,X+=o*S,X+=a*I,X+=c*x,X+=h*v,q=X>>>13,X&=8191,X+=d*b,X+=l*w,X+=p*(5*m),X+=f*(5*y),X+=g*(5*L),q+=X>>>13,X&=8191;var u=q;u+=n*L,u+=o*T,u+=a*S,u+=c*I,u+=h*x,q=u>>>13,u&=8191,u+=d*v,u+=l*b,u+=p*w,u+=f*(5*m),u+=g*(5*y),q+=u>>>13,u&=8191;var E=q;E+=n*y,E+=o*L,E+=a*T,E+=c*S,E+=h*I,q=E>>>13,E&=8191,E+=d*x,E+=l*v,E+=p*b,E+=f*w,E+=g*(5*m),q+=E>>>13,E&=8191;var _=q;_+=n*m,_+=o*y,_+=a*L,_+=c*T,_+=h*S,q=_>>>13,_&=8191,_+=d*I,_+=l*x,_+=p*v,_+=f*b,_+=g*w,q+=_>>>13,_&=8191,q=(q<<2)+q|0,q=q+j|0,j=q&8191,q=q>>>13,re+=q,n=j,o=re,a=Y,c=Z,h=V,d=J,l=X,p=u,f=E,g=_,r+=16,t-=16}this._h[0]=n,this._h[1]=o,this._h[2]=a,this._h[3]=c,this._h[4]=h,this._h[5]=d,this._h[6]=l,this._h[7]=p,this._h[8]=f,this._h[9]=g},i.prototype.finish=function(e,r){r===void 0&&(r=0);var t=new Uint16Array(10),s,n,o,a;if(this._leftover){for(a=this._leftover,this._buffer[a++]=1;a<16;a++)this._buffer[a]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(s=this._h[1]>>>13,this._h[1]&=8191,a=2;a<10;a++)this._h[a]+=s,s=this._h[a]>>>13,this._h[a]&=8191;for(this._h[0]+=s*5,s=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=s,s=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=s,t[0]=this._h[0]+5,s=t[0]>>>13,t[0]&=8191,a=1;a<10;a++)t[a]=this._h[a]+s,s=t[a]>>>13,t[a]&=8191;for(t[9]-=8192,n=(s^1)-1,a=0;a<10;a++)t[a]&=n;for(n=~n,a=0;a<10;a++)this._h[a]=this._h[a]&n|t[a];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,o=this._h[0]+this._pad[0],this._h[0]=o&65535,a=1;a<8;a++)o=(this._h[a]+this._pad[a]|0)+(o>>>16)|0,this._h[a]=o&65535;return e[r+0]=this._h[0]>>>0,e[r+1]=this._h[0]>>>8,e[r+2]=this._h[1]>>>0,e[r+3]=this._h[1]>>>8,e[r+4]=this._h[2]>>>0,e[r+5]=this._h[2]>>>8,e[r+6]=this._h[3]>>>0,e[r+7]=this._h[3]>>>8,e[r+8]=this._h[4]>>>0,e[r+9]=this._h[4]>>>8,e[r+10]=this._h[5]>>>0,e[r+11]=this._h[5]>>>8,e[r+12]=this._h[6]>>>0,e[r+13]=this._h[6]>>>8,e[r+14]=this._h[7]>>>0,e[r+15]=this._h[7]>>>8,this._finished=!0,this},i.prototype.update=function(e){var r=0,t=e.length,s;if(this._leftover){s=16-this._leftover,s>t&&(s=t);for(var n=0;n<s;n++)this._buffer[this._leftover+n]=e[r+n];if(t-=s,r+=s,this._leftover+=s,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(t>=16&&(s=t-t%16,this._blocks(e,r,s),r+=s,t-=s),t){for(var n=0;n<t;n++)this._buffer[this._leftover+n]=e[r+n];this._leftover+=t}return this},i.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var e=new Uint8Array(16);return this.finish(e),e},i.prototype.clean=function(){return yo.wipe(this._buffer),yo.wipe(this._r),yo.wipe(this._h),yo.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},i}();xt.Poly1305=Gf;function r1(i,e){var r=new Gf(i);r.update(e);var t=r.digest();return r.clean(),t}xt.oneTimeAuth=r1;function i1(i,e){return i.length!==xt.DIGEST_LENGTH||e.length!==xt.DIGEST_LENGTH?!1:t1.equal(i,e)}xt.equal=i1});var Xf=oe(St=>{"use strict";Object.defineProperty(St,"__esModule",{value:!0});var wo=$f(),s1=Wf(),Ri=He(),Jf=Ir(),n1=mo();St.KEY_LENGTH=32;St.NONCE_LENGTH=12;St.TAG_LENGTH=16;var Yf=new Uint8Array(16),o1=function(){function i(e){if(this.nonceLength=St.NONCE_LENGTH,this.tagLength=St.TAG_LENGTH,e.length!==St.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(e)}return i.prototype.seal=function(e,r,t,s){if(e.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var n=new Uint8Array(16);n.set(e,n.length-e.length);var o=new Uint8Array(32);wo.stream(this._key,n,o,4);var a=r.length+this.tagLength,c;if(s){if(s.length!==a)throw new Error("ChaCha20Poly1305: incorrect destination length");c=s}else c=new Uint8Array(a);return wo.streamXOR(this._key,n,r,c,4),this._authenticate(c.subarray(c.length-this.tagLength,c.length),o,c.subarray(0,c.length-this.tagLength),t),Ri.wipe(n),c},i.prototype.open=function(e,r,t,s){if(e.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(r.length<this.tagLength)return null;var n=new Uint8Array(16);n.set(e,n.length-e.length);var o=new Uint8Array(32);wo.stream(this._key,n,o,4);var a=new Uint8Array(this.tagLength);if(this._authenticate(a,o,r.subarray(0,r.length-this.tagLength),t),!n1.equal(a,r.subarray(r.length-this.tagLength,r.length)))return null;var c=r.length-this.tagLength,h;if(s){if(s.length!==c)throw new Error("ChaCha20Poly1305: incorrect destination length");h=s}else h=new Uint8Array(c);return wo.streamXOR(this._key,n,r.subarray(0,r.length-this.tagLength),h,4),Ri.wipe(n),h},i.prototype.clean=function(){return Ri.wipe(this._key),this},i.prototype._authenticate=function(e,r,t,s){var n=new s1.Poly1305(r);s&&(n.update(s),s.length%16>0&&n.update(Yf.subarray(s.length%16))),n.update(t),t.length%16>0&&n.update(Yf.subarray(t.length%16));var o=new Uint8Array(8);s&&Jf.writeUint64LE(s.length,o),n.update(o),Jf.writeUint64LE(t.length,o),n.update(o);for(var a=n.digest(),c=0;c<a.length;c++)e[c]=a[c];n.clean(),Ri.wipe(a),Ri.wipe(o)},i}();St.ChaCha20Poly1305=o1});var Qf=oe(Oc=>{"use strict";Object.defineProperty(Oc,"__esModule",{value:!0});function a1(i){return typeof i.saveState<"u"&&typeof i.restoreState<"u"&&typeof i.cleanSavedState<"u"}Oc.isSerializableHash=a1});var ep=oe(Ci=>{"use strict";Object.defineProperty(Ci,"__esModule",{value:!0});var lt=Qf(),c1=mo(),u1=He(),Zf=function(){function i(e,r){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var t=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(t).clean():t.set(r);for(var s=0;s<t.length;s++)t[s]^=54;this._inner.update(t);for(var s=0;s<t.length;s++)t[s]^=106;this._outer.update(t),lt.isSerializableHash(this._inner)&&lt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),u1.wipe(t)}return i.prototype.reset=function(){if(!lt.isSerializableHash(this._inner)||!lt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},i.prototype.clean=function(){lt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),lt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},i.prototype.update=function(e){return this._inner.update(e),this},i.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},i.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},i.prototype.saveState=function(){if(!lt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},i.prototype.restoreState=function(e){if(!lt.isSerializableHash(this._inner)||!lt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},i.prototype.cleanSavedState=function(e){if(!lt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},i}();Ci.HMAC=Zf;function h1(i,e,r){var t=new Zf(i,e);t.update(r);var s=t.digest();return t.clean(),s}Ci.hmac=h1;Ci.equal=c1.equal});var ip=oe(Pc=>{"use strict";Object.defineProperty(Pc,"__esModule",{value:!0});var tp=ep(),rp=He(),l1=function(){function i(e,r,t,s){t===void 0&&(t=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=s;var n=tp.hmac(this._hash,t,r);this._hmac=new tp.HMAC(e,n),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return i.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},i.prototype.expand=function(e){for(var r=new Uint8Array(e),t=0;t<r.length;t++)this._bufpos===this._buffer.length&&this._fillBuffer(),r[t]=this._buffer[this._bufpos++];return r},i.prototype.clean=function(){this._hmac.clean(),rp.wipe(this._buffer),rp.wipe(this._counter),this._bufpos=0},i}();Pc.HKDF=l1});var np=oe(Bt=>{"use strict";Object.defineProperty(Bt,"__esModule",{value:!0});var Eo=Ir(),bo=He();Bt.DIGEST_LENGTH=32;Bt.BLOCK_SIZE=64;var sp=function(){function i(){this.digestLength=Bt.DIGEST_LENGTH,this.blockSize=Bt.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return i.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},i.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},i.prototype.clean=function(){bo.wipe(this._buffer),bo.wipe(this._temp),this.reset()},i.prototype.update=function(e,r){if(r===void 0&&(r=e.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var t=0;if(this._bytesHashed+=r,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&r>0;)this._buffer[this._bufferLength++]=e[t++],r--;this._bufferLength===this.blockSize&&(Lc(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(r>=this.blockSize&&(t=Lc(this._temp,this._state,e,t,r),r%=this.blockSize);r>0;)this._buffer[this._bufferLength++]=e[t++],r--;return this},i.prototype.finish=function(e){if(!this._finished){var r=this._bytesHashed,t=this._bufferLength,s=r/536870912|0,n=r<<3,o=r%64<56?64:128;this._buffer[t]=128;for(var a=t+1;a<o-8;a++)this._buffer[a]=0;Eo.writeUint32BE(s,this._buffer,o-8),Eo.writeUint32BE(n,this._buffer,o-4),Lc(this._temp,this._state,this._buffer,0,o),this._finished=!0}for(var a=0;a<this.digestLength/4;a++)Eo.writeUint32BE(this._state[a],e,a*4);return this},i.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},i.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},i.prototype.restoreState=function(e){return this._state.set(e.state),this._bufferLength=e.bufferLength,e.buffer&&this._buffer.set(e.buffer),this._bytesHashed=e.bytesHashed,this._finished=!1,this},i.prototype.cleanSavedState=function(e){bo.wipe(e.state),e.buffer&&bo.wipe(e.buffer),e.bufferLength=0,e.bytesHashed=0},i}();Bt.SHA256=sp;var d1=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function Lc(i,e,r,t,s){for(;s>=64;){for(var n=e[0],o=e[1],a=e[2],c=e[3],h=e[4],d=e[5],l=e[6],p=e[7],f=0;f<16;f++){var g=t+f*4;i[f]=Eo.readUint32BE(r,g)}for(var f=16;f<64;f++){var w=i[f-2],b=(w>>>17|w<<15)^(w>>>19|w<<13)^w>>>10;w=i[f-15];var v=(w>>>7|w<<25)^(w>>>18|w<<14)^w>>>3;i[f]=(b+i[f-7]|0)+(v+i[f-16]|0)}for(var f=0;f<64;f++){var b=(((h>>>6|h<<26)^(h>>>11|h<<21)^(h>>>25|h<<7))+(h&d^~h&l)|0)+(p+(d1[f]+i[f]|0)|0)|0,v=((n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10))+(n&o^n&a^o&a)|0;p=l,l=d,d=h,h=c+b|0,c=a,a=o,o=n,n=b+v|0}e[0]+=n,e[1]+=o,e[2]+=a,e[3]+=c,e[4]+=h,e[5]+=d,e[6]+=l,e[7]+=p,t+=64,s-=64}return t}function f1(i){var e=new sp;e.update(i);var r=e.digest();return e.clean(),r}Bt.hash=f1});var up=oe(be=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});be.sharedKey=be.generateKeyPair=be.generateKeyPairFromSeed=be.scalarMultBase=be.scalarMult=be.SHARED_KEY_LENGTH=be.SECRET_KEY_LENGTH=be.PUBLIC_KEY_LENGTH=void 0;var p1=ni(),g1=He();be.PUBLIC_KEY_LENGTH=32;be.SECRET_KEY_LENGTH=32;be.SHARED_KEY_LENGTH=32;function dt(i){let e=new Float64Array(16);if(i)for(let r=0;r<i.length;r++)e[r]=i[r];return e}var op=new Uint8Array(32);op[0]=9;var m1=dt([56129,1]);function Uc(i){let e=1;for(let r=0;r<16;r++){let t=i[r]+e+65535;e=Math.floor(t/65536),i[r]=t-e*65536}i[0]+=e-1+37*(e-1)}function Ni(i,e,r){let t=~(r-1);for(let s=0;s<16;s++){let n=t&(i[s]^e[s]);i[s]^=n,e[s]^=n}}function y1(i,e){let r=dt(),t=dt();for(let s=0;s<16;s++)t[s]=e[s];Uc(t),Uc(t),Uc(t);for(let s=0;s<2;s++){r[0]=t[0]-65517;for(let o=1;o<15;o++)r[o]=t[o]-65535-(r[o-1]>>16&1),r[o-1]&=65535;r[15]=t[15]-32767-(r[14]>>16&1);let n=r[15]>>16&1;r[14]&=65535,Ni(t,r,1-n)}for(let s=0;s<16;s++)i[2*s]=t[s]&255,i[2*s+1]=t[s]>>8}function w1(i,e){for(let r=0;r<16;r++)i[r]=e[2*r]+(e[2*r+1]<<8);i[15]&=32767}function _o(i,e,r){for(let t=0;t<16;t++)i[t]=e[t]+r[t]}function vo(i,e,r){for(let t=0;t<16;t++)i[t]=e[t]-r[t]}function It(i,e,r){let t,s,n=0,o=0,a=0,c=0,h=0,d=0,l=0,p=0,f=0,g=0,w=0,b=0,v=0,x=0,I=0,S=0,T=0,L=0,y=0,m=0,k=0,$=0,O=0,C=0,R=0,N=0,G=0,H=0,q=0,j=0,re=0,Y=r[0],Z=r[1],V=r[2],J=r[3],X=r[4],u=r[5],E=r[6],_=r[7],D=r[8],A=r[9],U=r[10],F=r[11],M=r[12],Q=r[13],z=r[14],ee=r[15];t=e[0],n+=t*Y,o+=t*Z,a+=t*V,c+=t*J,h+=t*X,d+=t*u,l+=t*E,p+=t*_,f+=t*D,g+=t*A,w+=t*U,b+=t*F,v+=t*M,x+=t*Q,I+=t*z,S+=t*ee,t=e[1],o+=t*Y,a+=t*Z,c+=t*V,h+=t*J,d+=t*X,l+=t*u,p+=t*E,f+=t*_,g+=t*D,w+=t*A,b+=t*U,v+=t*F,x+=t*M,I+=t*Q,S+=t*z,T+=t*ee,t=e[2],a+=t*Y,c+=t*Z,h+=t*V,d+=t*J,l+=t*X,p+=t*u,f+=t*E,g+=t*_,w+=t*D,b+=t*A,v+=t*U,x+=t*F,I+=t*M,S+=t*Q,T+=t*z,L+=t*ee,t=e[3],c+=t*Y,h+=t*Z,d+=t*V,l+=t*J,p+=t*X,f+=t*u,g+=t*E,w+=t*_,b+=t*D,v+=t*A,x+=t*U,I+=t*F,S+=t*M,T+=t*Q,L+=t*z,y+=t*ee,t=e[4],h+=t*Y,d+=t*Z,l+=t*V,p+=t*J,f+=t*X,g+=t*u,w+=t*E,b+=t*_,v+=t*D,x+=t*A,I+=t*U,S+=t*F,T+=t*M,L+=t*Q,y+=t*z,m+=t*ee,t=e[5],d+=t*Y,l+=t*Z,p+=t*V,f+=t*J,g+=t*X,w+=t*u,b+=t*E,v+=t*_,x+=t*D,I+=t*A,S+=t*U,T+=t*F,L+=t*M,y+=t*Q,m+=t*z,k+=t*ee,t=e[6],l+=t*Y,p+=t*Z,f+=t*V,g+=t*J,w+=t*X,b+=t*u,v+=t*E,x+=t*_,I+=t*D,S+=t*A,T+=t*U,L+=t*F,y+=t*M,m+=t*Q,k+=t*z,$+=t*ee,t=e[7],p+=t*Y,f+=t*Z,g+=t*V,w+=t*J,b+=t*X,v+=t*u,x+=t*E,I+=t*_,S+=t*D,T+=t*A,L+=t*U,y+=t*F,m+=t*M,k+=t*Q,$+=t*z,O+=t*ee,t=e[8],f+=t*Y,g+=t*Z,w+=t*V,b+=t*J,v+=t*X,x+=t*u,I+=t*E,S+=t*_,T+=t*D,L+=t*A,y+=t*U,m+=t*F,k+=t*M,$+=t*Q,O+=t*z,C+=t*ee,t=e[9],g+=t*Y,w+=t*Z,b+=t*V,v+=t*J,x+=t*X,I+=t*u,S+=t*E,T+=t*_,L+=t*D,y+=t*A,m+=t*U,k+=t*F,$+=t*M,O+=t*Q,C+=t*z,R+=t*ee,t=e[10],w+=t*Y,b+=t*Z,v+=t*V,x+=t*J,I+=t*X,S+=t*u,T+=t*E,L+=t*_,y+=t*D,m+=t*A,k+=t*U,$+=t*F,O+=t*M,C+=t*Q,R+=t*z,N+=t*ee,t=e[11],b+=t*Y,v+=t*Z,x+=t*V,I+=t*J,S+=t*X,T+=t*u,L+=t*E,y+=t*_,m+=t*D,k+=t*A,$+=t*U,O+=t*F,C+=t*M,R+=t*Q,N+=t*z,G+=t*ee,t=e[12],v+=t*Y,x+=t*Z,I+=t*V,S+=t*J,T+=t*X,L+=t*u,y+=t*E,m+=t*_,k+=t*D,$+=t*A,O+=t*U,C+=t*F,R+=t*M,N+=t*Q,G+=t*z,H+=t*ee,t=e[13],x+=t*Y,I+=t*Z,S+=t*V,T+=t*J,L+=t*X,y+=t*u,m+=t*E,k+=t*_,$+=t*D,O+=t*A,C+=t*U,R+=t*F,N+=t*M,G+=t*Q,H+=t*z,q+=t*ee,t=e[14],I+=t*Y,S+=t*Z,T+=t*V,L+=t*J,y+=t*X,m+=t*u,k+=t*E,$+=t*_,O+=t*D,C+=t*A,R+=t*U,N+=t*F,G+=t*M,H+=t*Q,q+=t*z,j+=t*ee,t=e[15],S+=t*Y,T+=t*Z,L+=t*V,y+=t*J,m+=t*X,k+=t*u,$+=t*E,O+=t*_,C+=t*D,R+=t*A,N+=t*U,G+=t*F,H+=t*M,q+=t*Q,j+=t*z,re+=t*ee,n+=38*T,o+=38*L,a+=38*y,c+=38*m,h+=38*k,d+=38*$,l+=38*O,p+=38*C,f+=38*R,g+=38*N,w+=38*G,b+=38*H,v+=38*q,x+=38*j,I+=38*re,s=1,t=n+s+65535,s=Math.floor(t/65536),n=t-s*65536,t=o+s+65535,s=Math.floor(t/65536),o=t-s*65536,t=a+s+65535,s=Math.floor(t/65536),a=t-s*65536,t=c+s+65535,s=Math.floor(t/65536),c=t-s*65536,t=h+s+65535,s=Math.floor(t/65536),h=t-s*65536,t=d+s+65535,s=Math.floor(t/65536),d=t-s*65536,t=l+s+65535,s=Math.floor(t/65536),l=t-s*65536,t=p+s+65535,s=Math.floor(t/65536),p=t-s*65536,t=f+s+65535,s=Math.floor(t/65536),f=t-s*65536,t=g+s+65535,s=Math.floor(t/65536),g=t-s*65536,t=w+s+65535,s=Math.floor(t/65536),w=t-s*65536,t=b+s+65535,s=Math.floor(t/65536),b=t-s*65536,t=v+s+65535,s=Math.floor(t/65536),v=t-s*65536,t=x+s+65535,s=Math.floor(t/65536),x=t-s*65536,t=I+s+65535,s=Math.floor(t/65536),I=t-s*65536,t=S+s+65535,s=Math.floor(t/65536),S=t-s*65536,n+=s-1+37*(s-1),s=1,t=n+s+65535,s=Math.floor(t/65536),n=t-s*65536,t=o+s+65535,s=Math.floor(t/65536),o=t-s*65536,t=a+s+65535,s=Math.floor(t/65536),a=t-s*65536,t=c+s+65535,s=Math.floor(t/65536),c=t-s*65536,t=h+s+65535,s=Math.floor(t/65536),h=t-s*65536,t=d+s+65535,s=Math.floor(t/65536),d=t-s*65536,t=l+s+65535,s=Math.floor(t/65536),l=t-s*65536,t=p+s+65535,s=Math.floor(t/65536),p=t-s*65536,t=f+s+65535,s=Math.floor(t/65536),f=t-s*65536,t=g+s+65535,s=Math.floor(t/65536),g=t-s*65536,t=w+s+65535,s=Math.floor(t/65536),w=t-s*65536,t=b+s+65535,s=Math.floor(t/65536),b=t-s*65536,t=v+s+65535,s=Math.floor(t/65536),v=t-s*65536,t=x+s+65535,s=Math.floor(t/65536),x=t-s*65536,t=I+s+65535,s=Math.floor(t/65536),I=t-s*65536,t=S+s+65535,s=Math.floor(t/65536),S=t-s*65536,n+=s-1+37*(s-1),i[0]=n,i[1]=o,i[2]=a,i[3]=c,i[4]=h,i[5]=d,i[6]=l,i[7]=p,i[8]=f,i[9]=g,i[10]=w,i[11]=b,i[12]=v,i[13]=x,i[14]=I,i[15]=S}function Ai(i,e){It(i,e,e)}function b1(i,e){let r=dt();for(let t=0;t<16;t++)r[t]=e[t];for(let t=253;t>=0;t--)Ai(r,r),t!==2&&t!==4&&It(r,r,e);for(let t=0;t<16;t++)i[t]=r[t]}function Mc(i,e){let r=new Uint8Array(32),t=new Float64Array(80),s=dt(),n=dt(),o=dt(),a=dt(),c=dt(),h=dt();for(let f=0;f<31;f++)r[f]=i[f];r[31]=i[31]&127|64,r[0]&=248,w1(t,e);for(let f=0;f<16;f++)n[f]=t[f];s[0]=a[0]=1;for(let f=254;f>=0;--f){let g=r[f>>>3]>>>(f&7)&1;Ni(s,n,g),Ni(o,a,g),_o(c,s,o),vo(s,s,o),_o(o,n,a),vo(n,n,a),Ai(a,c),Ai(h,s),It(s,o,s),It(o,n,c),_o(c,s,o),vo(s,s,o),Ai(n,s),vo(o,a,h),It(s,o,m1),_o(s,s,a),It(o,o,s),It(s,a,h),It(a,n,t),Ai(n,c),Ni(s,n,g),Ni(o,a,g)}for(let f=0;f<16;f++)t[f+16]=s[f],t[f+32]=o[f],t[f+48]=n[f],t[f+64]=a[f];let d=t.subarray(32),l=t.subarray(16);b1(d,d),It(l,l,d);let p=new Uint8Array(32);return y1(p,l),p}be.scalarMult=Mc;function ap(i){return Mc(i,op)}be.scalarMultBase=ap;function cp(i){if(i.length!==be.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${be.SECRET_KEY_LENGTH} bytes`);let e=new Uint8Array(i);return{publicKey:ap(e),secretKey:e}}be.generateKeyPairFromSeed=cp;function E1(i){let e=(0,p1.randomBytes)(32,i),r=cp(e);return(0,g1.wipe)(e),r}be.generateKeyPair=E1;function _1(i,e,r=!1){if(i.length!==be.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(e.length!==be.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");let t=Mc(i,e);if(r){let s=0;for(let n=0;n<t.length;n++)s|=t[n];if(s===0)throw new Error("X25519: invalid shared key")}return t}be.sharedKey=_1});var hp=P(()=>{});var lp=P(()=>{});var dp=P(()=>{Kn()});var Fc=P(()=>{hp();Ba();lp();dc();lc();dp()});var kc,fp,pp=P(()=>{Nc();kc=class{constructor(e){if(e!=="secp256k1")throw new Error("Only secp256k1 is supported")}keyFromPrivate(e){let r=typeof e=="string"?Ti.hexToBytes(e.replace("0x","")):e;return{getPublic:(t=!1)=>{let s=po(r);return{encode:n=>s}}}}keyFromPublic(e){let r=typeof e=="string"?Ti.hexToBytes(e.replace("0x","")):e;return{verify:async(t,s)=>Pf(s,t,r)}}},fp=kc});var gp,mp=P(()=>{gp={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}}});function Ui(i){let[e,r]=i.split(v1);return{namespace:e,reference:r}}function Np(i,e){return i.includes(":")?[i]:e.chains||[]}function Mi(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function fr(){return!(0,Tt.getDocument)()&&!!(0,Tt.getNavigator)()&&navigator.product===D1}function qr(){return!Mi()&&!!(0,Tt.getNavigator)()&&!!(0,Tt.getDocument)()}function Fi(){return fr()?qe.reactNative:Mi()?qe.node:qr()?qe.browser:qe.unknown}function Ap(){var i;try{return fr()&&typeof window<"u"&&typeof window?.Application<"u"?(i=window.Application)==null?void 0:i.applicationId:void 0}catch{return}}function R1(i,e){let r=gc(i);return r=bp(bp({},r),e),i=mc(r),i}function zr(){return(0,Rp.getWindowMetadata)()||{name:"",description:"",url:"",icons:[""]}}function C1(){if(Fi()===qe.reactNative&&typeof window<"u"&&typeof window?.Platform<"u"){let{OS:r,Version:t}=window.Platform;return[r,t].join("-")}let i=Ld();if(i===null)return"unknown";let e=i.os?i.os.replace(" ","").toLowerCase():"unknown";return i.type==="browser"?[e,i.name,i.version].join("-"):[e,i.version].join("-")}function N1(){var i;let e=Fi();return e===qe.browser?[e,((i=(0,Tt.getLocation)())==null?void 0:i.host)||"unknown"].join(":"):e}function zc(i,e,r){let t=C1(),s=N1();return[[i,e].join("-"),[T1,r].join("-"),t,s].join("/")}function Op({protocol:i,version:e,relayUrl:r,sdkVersion:t,auth:s,projectId:n,useOnCloseEvent:o,bundleId:a}){let c=r.split("?"),h=zc(i,e,t),d={auth:s,ua:h,projectId:n,useOnCloseEvent:o||void 0,origin:a||void 0},l=R1(c[1]||"",d);return c[0]+"?"+l}function lr(i,e){return i.filter(r=>e.includes(r)).length===i.length}function Vc(i){return Object.fromEntries(i.entries())}function Kc(i){return new Map(Object.entries(i))}function Rt(i=Dt.FIVE_MINUTES,e){let r=(0,Dt.toMiliseconds)(i||Dt.FIVE_MINUTES),t,s,n;return{resolve:o=>{n&&t&&(clearTimeout(n),t(o))},reject:o=>{n&&s&&(clearTimeout(n),s(o))},done:()=>new Promise((o,a)=>{n=setTimeout(()=>{a(new Error(e))},r),t=o,s=a})}}function pr(i,e,r){return new Promise(async(t,s)=>{let n=setTimeout(()=>s(new Error(r)),e);try{let o=await i;t(o)}catch(o){s(o)}clearTimeout(n)})}function Pp(i,e){if(typeof e=="string"&&e.startsWith(`${i}:`))return e;if(i.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(i.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${i}`)}function Lp(i){return Pp("topic",i)}function Up(i){return Pp("id",i)}function Io(i){let[e,r]=i.split(":"),t={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")t.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))t.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return t}function ve(i,e){return(0,Dt.fromMiliseconds)((e||Date.now())+(0,Dt.toMiliseconds)(i))}function ft(i){return Date.now()>=(0,Dt.toMiliseconds)(i)}function se(i,e){return`${i}${e?`:${e}`:""}`}function A1(i=[],e=[]){return[...new Set([...i,...e])]}async function Mp({id:i,topic:e,wcDeepLink:r}){var t;try{if(!r)return;let s=typeof r=="string"?JSON.parse(r):r,n=s?.href;if(typeof n!="string")return;let o=O1(n,i,e),a=Fi();if(a===qe.browser){if(!((t=(0,Tt.getDocument)())!=null&&t.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}o.startsWith("https://")||o.startsWith("http://")?window.open(o,"_blank","noreferrer noopener"):window.open(o,P1()?"_blank":"_self","noreferrer noopener")}else a===qe.reactNative&&typeof window?.Linking<"u"&&await window.Linking.openURL(o)}catch(s){console.error(s)}}function O1(i,e,r){let t=`requestId=${e}&sessionTopic=${r}`;i.endsWith("/")&&(i=i.slice(0,-1));let s=`${i}`;if(i.startsWith("https://t.me")){let n=i.includes("?")?"&startapp=":"?startapp=";s=`${s}${n}${L1(t,!0)}`}else s=`${s}/wc?${t}`;return s}async function Fp(i,e){let r="";try{if(qr()&&(r=localStorage.getItem(e),r))return r;r=await i.getItem(e)}catch(t){console.error(t)}return r}function jc(i,e){if(!i.includes(e))return null;let r=i.split(/([&,?,=])/),t=r.indexOf(e);return r[t+2]}function $c(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,i=>{let e=Math.random()*16|0;return(i==="x"?e:e&3|8).toString(16)})}function ki(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function P1(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function L1(i,e=!1){let r=Buffer.from(i).toString("base64");return e?r.replace(/[=]/g,""):r}function kp(i){return Buffer.from(i,"base64").toString("utf-8")}async function M1(i,e,r,t,s,n){switch(r.t){case"eip191":return F1(i,e,r.s);case"eip1271":return await k1(i,e,r.s,t,s,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}function F1(i,e,r){return Vf(no(e),r).toLowerCase()===i.toLowerCase()}async function k1(i,e,r,t,s,n){let o=Ui(t);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${t}`);try{let a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",h="0000000000000000000000000000000000000000000000000000000000000041",d=r.substring(2),l=no(e).substring(2),p=a+l+c+h+d,f=await fetch(`${n||U1}/?chainId=${t}&projectId=${s}`,{method:"POST",body:JSON.stringify({id:B1(),jsonrpc:"2.0",method:"eth_call",params:[{to:i,data:p},"latest"]})}),{result:g}=await f.json();return g?g.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function B1(){return Date.now()+Math.floor(Math.random()*1e3)}async function Gc(i){let{cacao:e,projectId:r}=i,{s:t,p:s}=e,n=Wc(s,s.iss),o=Bi(s.iss);return await M1(o,n,t,Do(s.iss),r)}function J1(i){return Buffer.from(JSON.stringify(i)).toString("base64")}function Y1(i){return JSON.parse(Buffer.from(i,"base64").toString("utf-8"))}function dr(i){if(!i)throw new Error("No recap provided, value is undefined");if(!i.att)throw new Error("No `att` property found");let e=Object.keys(i.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{let t=i.att[r];if(Array.isArray(t))throw new Error(`Resource must be an object: ${r}`);if(typeof t!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(t).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(t).forEach(s=>{let n=t[s];if(!Array.isArray(n))throw new Error(`Ability limits ${s} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);n.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${s}) must be an array of objects, found: ${o}`)})})})}function X1(i,e,r,t={}){return r?.sort((s,n)=>s.localeCompare(n)),{att:{[i]:Q1(e,r,t)}}}function Q1(i,e,r={}){e=e?.sort((s,n)=>s.localeCompare(n));let t=e.map(s=>({[`${i}/${s}`]:[r]}));return Object.assign({},...t)}function Bp(i){return dr(i),`urn:recap:${J1(i).replace(/=/g,"")}`}function Pi(i){let e=Y1(i.replace("urn:recap:",""));return dr(e),e}function qp(i,e,r){let t=X1(i,e,r);return Bp(t)}function Z1(i){return i&&i.includes("urn:recap:")}function zp(i,e){let r=Pi(i),t=Pi(e),s=eE(r,t);return Bp(s)}function eE(i,e){dr(i),dr(e);let r=Object.keys(i.att).concat(Object.keys(e.att)).sort((s,n)=>s.localeCompare(n)),t={att:{}};return r.forEach(s=>{var n,o;Object.keys(((n=i.att)==null?void 0:n[s])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[s])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,h;t.att[s]=H1($1({},t.att[s]),{[a]:((c=i.att[s])==null?void 0:c[a])||((h=e.att[s])==null?void 0:h[a])})})}),t}function tE(i="",e){dr(e);let r="I further authorize the stated URI to perform the following actions on my behalf: ";if(i.includes(r))return i;let t=[],s=0;Object.keys(e.att).forEach(a=>{let c=Object.keys(e.att[a]).map(l=>({ability:l.split("/")[0],action:l.split("/")[1]}));c.sort((l,p)=>l.action.localeCompare(p.action));let h={};c.forEach(l=>{h[l.ability]||(h[l.ability]=[]),h[l.ability].push(l.action)});let d=Object.keys(h).map(l=>(s++,`(${s}) '${l}': '${h[l].join("', '")}' for '${a}'.`));t.push(d.join(", ").replace(".,","."))});let n=t.join(" "),o=`${r}${n}`;return`${i?i+" ":""}${o}`}function Jc(i){var e;let r=Pi(i);dr(r);let t=(e=r.att)==null?void 0:e.eip155;return t?Object.keys(t).map(s=>s.split("/")[1]):[]}function Yc(i){let e=Pi(i);dr(e);let r=[];return Object.values(e.att).forEach(t=>{Object.values(t).forEach(s=>{var n;(n=s?.[0])!=null&&n.chains&&r.push(s[0].chains)})}),[...new Set(r.flat())]}function qi(i){if(!i)return;let e=i?.[i.length-1];return Z1(e)?e:void 0}function jp(){let i=So.generateKeyPair();return{privateKey:we(i.secretKey,Ae),publicKey:we(i.publicKey,Ae)}}function To(){let i=(0,Li.randomBytes)(Xc);return we(i,Ae)}function $p(i,e){let r=So.sharedKey(_e(i,Ae),_e(e,Ae),!0),t=new Cp.HKDF(Br.SHA256,r).expand(Xc);return we(t,Ae)}function jr(i){let e=(0,Br.hash)(_e(i,Ae));return we(e,Ae)}function rt(i){let e=(0,Br.hash)(_e(i,zi));return we(e,Ae)}function Hp(i){return _e(`${i}`,Vp)}function qt(i){return Number(we(i,Vp))}function Gp(i){let e=Hp(typeof i.type<"u"?i.type:Kp);if(qt(e)===tt&&typeof i.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");let r=typeof i.senderPublicKey<"u"?_e(i.senderPublicKey,Ae):void 0,t=typeof i.iv<"u"?_e(i.iv,Ae):(0,Li.randomBytes)(Oi),s=new qc.ChaCha20Poly1305(_e(i.symKey,Ae)).seal(t,_e(i.message,zi));return Xp({type:e,sealed:s,iv:t,senderPublicKey:r,encoding:i.encoding})}function Wp(i,e){let r=Hp(Kr),t=(0,Li.randomBytes)(Oi),s=_e(i,zi);return Xp({type:r,sealed:s,iv:t,encoding:e})}function Jp(i){let e=new qc.ChaCha20Poly1305(_e(i.symKey,Ae)),{sealed:r,iv:t}=$r({encoded:i.encoded,encoding:i?.encoding}),s=e.open(t,r);if(s===null)throw new Error("Failed to decrypt");return we(s,zi)}function Yp(i,e){let{sealed:r}=$r({encoded:i,encoding:e});return we(r,zi)}function Xp(i){let{encoding:e=pt}=i;if(qt(i.type)===Kr)return we(ir([i.type,i.sealed]),e);if(qt(i.type)===tt){if(typeof i.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return we(ir([i.type,i.senderPublicKey,i.iv,i.sealed]),e)}return we(ir([i.type,i.iv,i.sealed]),e)}function $r(i){let{encoded:e,encoding:r=pt}=i,t=_e(e,r),s=t.slice(rE,vp),n=vp;if(qt(s)===tt){let h=n+Xc,d=h+Oi,l=t.slice(n,h),p=t.slice(h,d),f=t.slice(d);return{type:s,sealed:f,iv:p,senderPublicKey:l}}if(qt(s)===Kr){let h=t.slice(n),d=(0,Li.randomBytes)(Oi);return{type:s,sealed:h,iv:d}}let o=n+Oi,a=t.slice(n,o),c=t.slice(o);return{type:s,sealed:c,iv:a}}function Qp(i,e){let r=$r({encoded:i,encoding:e?.encoding});return Qc({type:qt(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?we(r.senderPublicKey,Ae):void 0,receiverPublicKey:e?.receiverPublicKey})}function Qc(i){let e=i?.type||Kp;if(e===tt){if(typeof i?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof i?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:i?.senderPublicKey,receiverPublicKey:i?.receiverPublicKey}}function Zc(i){return i.type===tt&&typeof i.senderPublicKey=="string"&&typeof i.receiverPublicKey=="string"}function eu(i){return i.type===Kr}function iE(i){return new fp("p256").keyFromPublic({x:Buffer.from(i.x,"base64").toString("hex"),y:Buffer.from(i.y,"base64").toString("hex")},"hex")}function sE(i){let e=i.replace(/-/g,"+").replace(/_/g,"/"),r=e.length%4;return r>0&&(e+="=".repeat(4-r)),e}function nE(i){return Buffer.from(sE(i),"base64")}function Zp(i,e){let[r,t,s]=i.split("."),n=nE(s);if(n.length!==64)throw new Error("Invalid signature length");let o=n.slice(0,32).toString("hex"),a=n.slice(32,64).toString("hex"),c=`${r}.${t}`,h=new Br.SHA256().update(Buffer.from(c)).digest(),d=iE(e),l=Buffer.from(h).toString("hex");if(!d.verify(l,{r:o,s:a}))throw new Error("Invalid signature");return Lr(i).payload}function Ro(i){return i?.relay||{protocol:oE}}function Hr(i){let e=gp[i];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${i}`);return e}function fE(i,e="-"){let r={},t="relay"+e;return Object.keys(i).forEach(s=>{if(s.startsWith(t)){let n=s.replace(t,""),o=i[s];r[n]=o}}),r}function tu(i){if(!i.includes("wc:")){let c=kp(i);c!=null&&c.includes("wc:")&&(i=c)}i=i.includes("wc://")?i.replace("wc://",""):i,i=i.includes("wc:")?i.replace("wc:",""):i;let e=i.indexOf(":"),r=i.indexOf("?")!==-1?i.indexOf("?"):void 0,t=i.substring(0,e),s=i.substring(e+1,r).split("@"),n=typeof r<"u"?i.substring(r):"",o=gc(n),a=typeof o.methods=="string"?o.methods.split(","):void 0;return{protocol:t,topic:pE(s[0]),version:parseInt(s[1],10),symKey:o.symKey,relay:fE(o),methods:a,expiryTimestamp:o.expiryTimestamp?parseInt(o.expiryTimestamp,10):void 0}}function pE(i){return i.startsWith("//")?i.substring(2):i}function gE(i,e="-"){let r="relay",t={};return Object.keys(i).forEach(s=>{let n=r+e+s;i[s]&&(t[n]=i[s])}),t}function ru(i){return`${i.protocol}:${i.topic}@${i.version}?`+mc(Ip(dE(Ip({symKey:i.symKey},gE(i.relay)),{expiryTimestamp:i.expiryTimestamp}),i.methods?{methods:i.methods.join(",")}:{}))}function Vi(i,e,r){return`${i}?wc_ev=${r}&topic=${e}`}function Gr(i){let e=[];return i.forEach(r=>{let[t,s]=r.split(":");e.push(`${t}:${s}`)}),e}function mE(i){let e=[];return Object.values(i).forEach(r=>{e.push(...Gr(r.accounts))}),e}function yE(i,e){let r=[];return Object.values(i).forEach(t=>{Gr(t.accounts).includes(e)&&r.push(...t.methods)}),r}function wE(i,e){let r=[];return Object.values(i).forEach(t=>{Gr(t.accounts).includes(e)&&r.push(...t.events)}),r}function bE(i){let e={};return i?.forEach(r=>{let[t,s]=r.split(":");e[t]||(e[t]={accounts:[],chains:[],events:[]}),e[t].accounts.push(r),e[t].chains.push(`${t}:${s}`)}),e}function iu(i,e){e=e.map(t=>t.replace("did:pkh:",""));let r=bE(e);for(let[t,s]of Object.entries(r))s.methods?s.methods=A1(s.methods,i):s.methods=i,s.events=["chainChanged","accountsChanged"];return r}function B(i,e){let{message:r,code:t}=_E[i];return{message:e?`${r} ${e}`:r,code:t}}function ce(i,e){let{message:r,code:t}=EE[i];return{message:e?`${r} ${e}`:r,code:t}}function Vt(i,e){return Array.isArray(i)?typeof e<"u"&&i.length?i.every(e):!0:!1}function Ki(i){return Object.getPrototypeOf(i)===Object.prototype&&Object.keys(i).length}function De(i){return typeof i>"u"}function me(i,e){return e&&De(i)?!0:typeof i=="string"&&!!i.trim().length}function su(i,e){return e&&De(i)?!0:typeof i=="number"&&!isNaN(i)}function eg(i,e){let{requiredNamespaces:r}=e,t=Object.keys(i.namespaces),s=Object.keys(r),n=!0;return lr(s,t)?(t.forEach(o=>{let{accounts:a,methods:c,events:h}=i.namespaces[o],d=Gr(a),l=r[o];(!lr(Np(o,l),d)||!lr(l.methods,c)||!lr(l.events,h))&&(n=!1)}),n):!1}function xo(i){return me(i,!1)&&i.includes(":")?i.split(":").length===2:!1}function vE(i){if(me(i,!1)&&i.includes(":")){let e=i.split(":");if(e.length===3){let r=e[0]+":"+e[1];return!!e[2]&&xo(r)}}return!1}function tg(i){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(me(i,!1)){if(e(i))return!0;let r=kp(i);return e(r)}}catch{}return!1}function rg(i){var e;return(e=i?.proposer)==null?void 0:e.publicKey}function ig(i){return i?.topic}function sg(i,e){let r=null;return me(i?.publicKey,!1)||(r=B("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function Dp(i){let e=!0;return Vt(i)?i.length&&(e=i.every(r=>me(r,!1))):e=!1,e}function xE(i,e,r){let t=null;return Vt(e)&&e.length?e.forEach(s=>{t||xo(s)||(t=ce("UNSUPPORTED_CHAINS",`${r}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):xo(i)||(t=ce("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),t}function SE(i,e,r){let t=null;return Object.entries(i).forEach(([s,n])=>{if(t)return;let o=xE(s,Np(s,n),`${e} ${r}`);o&&(t=o)}),t}function IE(i,e){let r=null;return Vt(i)?i.forEach(t=>{r||vE(t)||(r=ce("UNSUPPORTED_ACCOUNTS",`${e}, account ${t} should be a string and conform to "namespace:chainId:address" format`))}):r=ce("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function DE(i,e){let r=null;return Object.values(i).forEach(t=>{if(r)return;let s=IE(t?.accounts,`${e} namespace`);s&&(r=s)}),r}function TE(i,e){let r=null;return Dp(i?.methods)?Dp(i?.events)||(r=ce("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=ce("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function ng(i,e){let r=null;return Object.values(i).forEach(t=>{if(r)return;let s=TE(t,`${e}, namespace`);s&&(r=s)}),r}function og(i,e,r){let t=null;if(i&&Ki(i)){let s=ng(i,e);s&&(t=s);let n=SE(i,e,r);n&&(t=n)}else t=B("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return t}function Co(i,e){let r=null;if(i&&Ki(i)){let t=ng(i,e);t&&(r=t);let s=DE(i,e);s&&(r=s)}else r=B("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function nu(i){return me(i.protocol,!0)}function ag(i,e){let r=!1;return e&&!i?r=!0:i&&Vt(i)&&i.length&&i.forEach(t=>{r=nu(t)}),r}function cg(i){return typeof i=="number"}function Oe(i){return typeof i<"u"&&typeof i!==null}function ug(i){return!(!i||typeof i!="object"||!i.code||!su(i.code,!1)||!i.message||!me(i.message,!1))}function hg(i){return!(De(i)||!me(i.method,!1))}function lg(i){return!(De(i)||De(i.result)&&De(i.error)||!su(i.id,!1)||!me(i.jsonrpc,!1))}function dg(i){return!(De(i)||!me(i.name,!1))}function ou(i,e){return!(!xo(e)||!mE(i).includes(e))}function fg(i,e,r){return me(r,!1)?yE(i,e).includes(r):!1}function pg(i,e,r){return me(r,!1)?wE(i,e).includes(r):!1}function au(i,e,r){let t=null,s=RE(i),n=CE(e),o=Object.keys(s),a=Object.keys(n),c=Tp(Object.keys(i)),h=Tp(Object.keys(e)),d=c.filter(l=>!h.includes(l));return d.length&&(t=B("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${d.toString()}
      Received: ${Object.keys(e).toString()}`)),lr(o,a)||(t=B("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(l=>{if(!l.includes(":")||t)return;let p=Gr(e[l].accounts);p.includes(l)||(t=B("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${l}
        Required: ${l}
        Approved: ${p.toString()}`))}),o.forEach(l=>{t||(lr(s[l].methods,n[l].methods)?lr(s[l].events,n[l].events)||(t=B("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${l}`)):t=B("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${l}`))}),t}function RE(i){let e={};return Object.keys(i).forEach(r=>{var t;r.includes(":")?e[r]=i[r]:(t=i[r].chains)==null||t.forEach(s=>{e[s]={methods:i[r].methods,events:i[r].events}})}),e}function Tp(i){return[...new Set(i.map(e=>e.includes(":")?e.split(":")[0]:e))]}function CE(i){let e={};return Object.keys(i).forEach(r=>{r.includes(":")?e[r]=i[r]:Gr(i[r].accounts)?.forEach(s=>{e[s]={accounts:i[r].accounts.filter(n=>n.includes(`${s}:`)),methods:i[r].methods,events:i[r].events}})}),e}function gg(i,e){return su(i,!1)&&i<=e.max&&i>=e.min}function cu(){let i=Fi();return new Promise(e=>{switch(i){case qe.browser:e(NE());break;case qe.reactNative:e(AE());break;case qe.node:e(OE());break;default:e(!0)}})}function NE(){return qr()&&navigator?.onLine}async function AE(){return fr()&&typeof window<"u"&&window!=null&&window.NetInfo?(await window?.NetInfo.fetch())?.isConnected:!0}function OE(){return!0}function mg(i){switch(Fi()){case qe.browser:PE(i);break;case qe.reactNative:LE(i);break;case qe.node:break}}function PE(i){!fr()&&qr()&&(window.addEventListener("online",()=>i(!0)),window.addEventListener("offline",()=>i(!1)))}function LE(i){fr()&&typeof window<"u"&&window!=null&&window.NetInfo&&window?.NetInfo.addEventListener(e=>i(e?.isConnected))}var Dt,Tt,Rp,qc,Cp,Li,Br,So,v1,x1,yp,S1,I1,wp,bp,D1,qe,T1,U1,q1,z1,V1,Ep,K1,j1,_p,$1,H1,G1,Hc,W1,Do,Bi,Wc,Vp,Ae,pt,Vr,zi,Kp,tt,Kr,rE,vp,Oi,Xc,oE,aE,cE,uE,xp,hE,lE,Sp,Ip,dE,EE,_E,Bc,zt,ji=P(()=>{Ud();Dt=pe(xr()),Tt=pe(Zn()),Rp=pe(Fd());kd();Ef();Kf();qc=pe(Xf()),Cp=pe(ip()),Li=pe(ni()),Br=pe(np()),So=pe(up());Fc();pp();Qn();mp();v1=":";x1=Object.defineProperty,yp=Object.getOwnPropertySymbols,S1=Object.prototype.hasOwnProperty,I1=Object.prototype.propertyIsEnumerable,wp=(i,e,r)=>e in i?x1(i,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[e]=r,bp=(i,e)=>{for(var r in e||(e={}))S1.call(e,r)&&wp(i,r,e[r]);if(yp)for(var r of yp(e))I1.call(e,r)&&wp(i,r,e[r]);return i},D1="ReactNative",qe={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},T1="js";U1="https://rpc.walletconnect.org/v1";q1=Object.defineProperty,z1=Object.defineProperties,V1=Object.getOwnPropertyDescriptors,Ep=Object.getOwnPropertySymbols,K1=Object.prototype.hasOwnProperty,j1=Object.prototype.propertyIsEnumerable,_p=(i,e,r)=>e in i?q1(i,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[e]=r,$1=(i,e)=>{for(var r in e||(e={}))K1.call(e,r)&&_p(i,r,e[r]);if(Ep)for(var r of Ep(e))j1.call(e,r)&&_p(i,r,e[r]);return i},H1=(i,e)=>z1(i,V1(e)),G1="did:pkh:",Hc=i=>i?.split(":"),W1=i=>{let e=i&&Hc(i);if(e)return i.includes(G1)?e[3]:e[1]},Do=i=>{let e=i&&Hc(i);if(e)return e[2]+":"+e[3]},Bi=i=>{let e=i&&Hc(i);if(e)return e.pop()};Wc=(i,e)=>{let r=`${i.domain} wants you to sign in with your Ethereum account:`,t=Bi(e);if(!i.aud&&!i.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=i.statement||void 0,n=`URI: ${i.aud||i.uri}`,o=`Version: ${i.version}`,a=`Chain ID: ${W1(e)}`,c=`Nonce: ${i.nonce}`,h=`Issued At: ${i.iat}`,d=i.exp?`Expiration Time: ${i.exp}`:void 0,l=i.nbf?`Not Before: ${i.nbf}`:void 0,p=i.requestId?`Request ID: ${i.requestId}`:void 0,f=i.resources?`Resources:${i.resources.map(w=>`
- ${w}`).join("")}`:void 0,g=qi(i.resources);if(g){let w=Pi(g);s=tE(s,w)}return[r,t,"",s,"",n,o,a,c,h,d,l,p,f].filter(w=>w!=null).join(`
`)};Vp="base10",Ae="base16",pt="base64pad",Vr="base64url",zi="utf8",Kp=0,tt=1,Kr=2,rE=0,vp=1,Oi=12,Xc=32;oE="irn";aE=Object.defineProperty,cE=Object.defineProperties,uE=Object.getOwnPropertyDescriptors,xp=Object.getOwnPropertySymbols,hE=Object.prototype.hasOwnProperty,lE=Object.prototype.propertyIsEnumerable,Sp=(i,e,r)=>e in i?aE(i,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[e]=r,Ip=(i,e)=>{for(var r in e||(e={}))hE.call(e,r)&&Sp(i,r,e[r]);if(xp)for(var r of xp(e))lE.call(e,r)&&Sp(i,r,e[r]);return i},dE=(i,e)=>cE(i,uE(e));EE={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},_E={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};Bc={},zt=class{static get(e){return Bc[e]}static set(e,r){Bc[e]=r}static delete(e){delete Bc[e]}}});var yg,wg,bg,Eg,No,$i,uu,Ao,Kt,Hi,Oo=P(()=>{yg="PARSE_ERROR",wg="INVALID_REQUEST",bg="METHOD_NOT_FOUND",Eg="INVALID_PARAMS",No="INTERNAL_ERROR",$i="SERVER_ERROR",uu=[-32700,-32600,-32601,-32602,-32603],Ao=[-32e3,-32099],Kt={[yg]:{code:-32700,message:"Parse error"},[wg]:{code:-32600,message:"Invalid Request"},[bg]:{code:-32601,message:"Method not found"},[Eg]:{code:-32602,message:"Invalid params"},[No]:{code:-32603,message:"Internal error"},[$i]:{code:-32e3,message:"Server error"}},Hi=$i});function UE(i){return i<=Ao[0]&&i>=Ao[1]}function Po(i){return uu.includes(i)}function _g(i){return typeof i=="number"}function Lo(i){return Object.keys(Kt).includes(i)?Kt[i]:Kt[Hi]}function Uo(i){let e=Object.values(Kt).find(r=>r.code===i);return e||Kt[Hi]}function ME(i){if(typeof i.error.code>"u")return{valid:!1,error:"Missing code for JSON-RPC error"};if(typeof i.error.message>"u")return{valid:!1,error:"Missing message for JSON-RPC error"};if(!_g(i.error.code))return{valid:!1,error:`Invalid error code type for JSON-RPC: ${i.error.code}`};if(Po(i.error.code)){let e=Uo(i.error.code);if(e.message!==Kt[Hi].message&&i.error.message===e.message)return{valid:!1,error:`Invalid error code message for JSON-RPC: ${i.error.code}`}}return{valid:!0}}function hu(i,e,r){return i.message.includes("getaddrinfo ENOTFOUND")||i.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):i}var lu=P(()=>{Oo()});var xg=oe(jt=>{"use strict";Object.defineProperty(jt,"__esModule",{value:!0});jt.isBrowserCryptoAvailable=jt.getSubtleCrypto=jt.getBrowerCrypto=void 0;function du(){return window?.crypto||window?.msCrypto||{}}jt.getBrowerCrypto=du;function vg(){let i=du();return i.subtle||i.webkitSubtle}jt.getSubtleCrypto=vg;function FE(){return!!du()&&!!vg()}jt.isBrowserCryptoAvailable=FE});var Dg=oe($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.isBrowser=$t.isNode=$t.isReactNative=void 0;function Sg(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}$t.isReactNative=Sg;function Ig(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}$t.isNode=Ig;function kE(){return!Sg()&&!Ig()}$t.isBrowser=kE});var fu=oe(Mo=>{"use strict";Object.defineProperty(Mo,"__esModule",{value:!0});var Tg=(br(),ei(wr));Tg.__exportStar(xg(),Mo);Tg.__exportStar(Dg(),Mo)});var Pe={};Se(Pe,{isNodeJs:()=>Cg});var Rg,Cg,Ng=P(()=>{Rg=pe(fu());Me(Pe,pe(fu()));Cg=Rg.isNode});function gt(i=3){let e=Date.now()*Math.pow(10,i),r=Math.floor(Math.random()*Math.pow(10,i));return e+r}function it(i=6){return BigInt(gt(i))}function st(i,e,r){return{id:r||gt(),jsonrpc:"2.0",method:i,params:e}}function Wr(i,e){return{id:i,jsonrpc:"2.0",result:e}}function gr(i,e,r){return{id:i,jsonrpc:"2.0",error:Ag(e,r)}}function Ag(i,e){return typeof i>"u"?Lo(No):(typeof i=="string"&&(i=Object.assign(Object.assign({},Lo($i)),{message:i})),typeof e<"u"&&(i.data=e),Po(i.code)&&(i=Uo(i.code)),i)}var Og=P(()=>{lu();Oo()});function BE(i){return i.includes("*")?ko(i):!/\W/g.test(i)}function Fo(i){return i==="*"}function ko(i){return Fo(i)?!0:!(!i.includes("*")||i.split("*").length!==2||i.split("*").filter(e=>e.trim()==="").length!==1)}function qE(i){return!Fo(i)&&ko(i)&&!i.split("*")[0].trim()}function zE(i){return!Fo(i)&&ko(i)&&!i.split("*")[1].trim()}var Pg=P(()=>{});var Gi,pu,Bo,Wi,Lg=P(()=>{Gi=class{},pu=class extends Gi{constructor(e){super()}},Bo=class extends Gi{constructor(){super()}},Wi=class extends Bo{constructor(e){super()}}});var Ug=P(()=>{Lg()});function jE(i){let e=i.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function Mg(i,e){let r=jE(i);return typeof r>"u"?!1:new RegExp(e).test(r)}function $E(i){return Mg(i,VE)}function qo(i){return Mg(i,KE)}function gu(i){return new RegExp("wss?://localhost(:d{2,5})?").test(i)}var VE,KE,Fg=P(()=>{VE="^https?:",KE="^wss?:"});function mu(i){return typeof i=="object"&&"id"in i&&"jsonrpc"in i&&i.jsonrpc==="2.0"}function Jr(i){return mu(i)&&"method"in i}function Ht(i){return mu(i)&&(Ve(i)||Le(i))}function Ve(i){return"result"in i}function Le(i){return"error"in i}function HE(i){return"error"in i&&i.valid===!1}var kg=P(()=>{});var Ke={};Se(Ke,{DEFAULT_ERROR:()=>Hi,IBaseJsonRpcProvider:()=>Bo,IEvents:()=>Gi,IJsonRpcConnection:()=>pu,IJsonRpcProvider:()=>Wi,INTERNAL_ERROR:()=>No,INVALID_PARAMS:()=>Eg,INVALID_REQUEST:()=>wg,METHOD_NOT_FOUND:()=>bg,PARSE_ERROR:()=>yg,RESERVED_ERROR_CODES:()=>uu,SERVER_ERROR:()=>$i,SERVER_ERROR_CODE_RANGE:()=>Ao,STANDARD_ERROR_MAP:()=>Kt,formatErrorMessage:()=>Ag,formatJsonRpcError:()=>gr,formatJsonRpcRequest:()=>st,formatJsonRpcResult:()=>Wr,getBigIntRpcId:()=>it,getError:()=>Lo,getErrorByCode:()=>Uo,isHttpUrl:()=>$E,isJsonRpcError:()=>Le,isJsonRpcPayload:()=>mu,isJsonRpcRequest:()=>Jr,isJsonRpcResponse:()=>Ht,isJsonRpcResult:()=>Ve,isJsonRpcValidationInvalid:()=>HE,isLocalhostUrl:()=>gu,isNodeJs:()=>Cg,isReservedErrorCode:()=>Po,isServerErrorCode:()=>UE,isValidDefaultRoute:()=>Fo,isValidErrorCode:()=>_g,isValidLeadingWildcardRoute:()=>qE,isValidRoute:()=>BE,isValidTrailingWildcardRoute:()=>zE,isValidWildcardRoute:()=>ko,isWsUrl:()=>qo,parseConnectionError:()=>hu,payloadId:()=>gt,validateJsonRpcError:()=>ME});var Ji=P(()=>{Oo();lu();Ng();Me(Ke,Pe);Og();Pg();Ug();Fg();kg()});var Bg,zo,qg=P(()=>{Bg=pe(Yt());Ji();zo=class extends Wi{constructor(e){super(e),this.events=new Bg.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(st(e.method,e.params||[],e.id||it().toString()),r)}async requestStrict(e,r){return new Promise(async(t,s)=>{if(!this.connection.connected)try{await this.open()}catch(n){s(n)}this.events.on(`${e.id}`,n=>{Le(n)?s(n.error):t(n.result)});try{await this.connection.send(e,r)}catch(n){s(n)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Ht(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}});var Vg=oe((w6,zg)=>{"use strict";zg.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}});var $g,GE,WE,Kg,jg,JE,Vo,Hg=P(()=>{$g=pe(Yt());Sr();Ji();GE=()=>typeof WebSocket<"u"?WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:Vg(),WE=()=>typeof WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Kg=i=>i.split("?")[0],jg=10,JE=GE(),Vo=class{constructor(e){if(this.url=e,this.events=new $g.EventEmitter,this.registering=!1,!qo(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=t=>{this.onClose(t),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send($e(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!qo(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){let r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((t,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));t(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,t)=>{let s=new URLSearchParams(e).get("origin"),n=(0,Ke.isReactNative)()?{headers:{origin:s}}:{rejectUnauthorized:!gu(e)},o=new JE(e,[],n);WE()?o.onerror=a=>{let c=a;t(this.emitError(c.error))}:o.on("error",a=>{t(this.emitError(a))}),o.onopen=()=>{this.onOpen(o),r(o)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;let r=typeof e.data=="string"?ut(e.data):e.data;this.events.emit("payload",r)}onError(e,r){let t=this.parseError(r),s=t.message||t.toString(),n=gr(e,s);this.events.emit("payload",n)}parseError(e,r=this.url){return hu(e,Kg(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>jg&&this.events.setMaxListeners(jg)}emitError(e){let r=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${Kg(this.url)}`));return this.events.emit("register_error",r),r}}});function Yi(i,e){if(i===e)return!0;if(i&&e&&typeof i=="object"&&typeof e=="object"){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(!Yi(i[t],e[t]))return!1;return!0}let r=Object.keys(i);if(r.length!==Object.keys(e).length)return!1;for(let t of r)if(!e.hasOwnProperty(t)||!Yi(i[t],e[t]))return!1;return!0}return!1}var Gg=P(()=>{});function A_(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),t=0;t<r.length;t++)r[t]=255;for(var s=0;s<i.length;s++){var n=i.charAt(s),o=n.charCodeAt(0);if(r[o]!==255)throw new TypeError(n+" is ambiguous");r[o]=s}var a=i.length,c=i.charAt(0),h=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function l(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var w=0,b=0,v=0,x=g.length;v!==x&&g[v]===0;)v++,w++;for(var I=(x-v)*d+1>>>0,S=new Uint8Array(I);v!==x;){for(var T=g[v],L=0,y=I-1;(T!==0||L<b)&&y!==-1;y--,L++)T+=256*S[y]>>>0,S[y]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");b=L,v++}for(var m=I-b;m!==I&&S[m]===0;)m++;for(var k=c.repeat(w);m<I;++m)k+=i.charAt(S[m]);return k}function p(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var w=0;if(g[w]!==" "){for(var b=0,v=0;g[w]===c;)b++,w++;for(var x=(g.length-w)*h+1>>>0,I=new Uint8Array(x);g[w];){var S=r[g.charCodeAt(w)];if(S===255)return;for(var T=0,L=x-1;(S!==0||T<v)&&L!==-1;L--,T++)S+=a*I[L]>>>0,I[L]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");v=T,w++}if(g[w]!==" "){for(var y=x-v;y!==x&&I[y]===0;)y++;for(var m=new Uint8Array(b+(x-y)),k=b;y!==x;)m[k++]=I[y++];return m}}}function f(g){var w=p(g);if(w)return w;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:p,decode:f}}function wv(i){return i.reduce((e,r)=>(e+=mv[r],e),"")}function bv(i){let e=[];for(let r of i){let t=yv[r.codePointAt(0)];if(t===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(t)}return new Uint8Array(e)}function x0(i,e,r){e=e||[],r=r||0;for(var t=r;i>=Iv;)e[r++]=i&255|Yg,i/=128;for(;i&Sv;)e[r++]=i&255|Yg,i>>>=7;return e[r]=i|0,x0.bytes=r-t+1,e}function Su(i,t){var r=0,t=t||0,s=0,n=t,o,a=i.length;do{if(n>=a)throw Su.bytes=0,new RangeError("Could not decode varint");o=i[n++],r+=s<28?(o&Xg)<<s:(o&Xg)*Math.pow(2,s),s+=7}while(o>=Tv);return Su.bytes=n-t,r}function Hv(i=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(i):new Uint8Array(i)}function C0(i,e,r,t){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:r},decoder:{decode:t}}}function Wv(i,e="utf8"){let r=Gv[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i,"utf8"):r.decoder.decode(`${r.prefix}${i}`)}var Ct,ie,g0,m0,y0,Vu,wt,YE,XE,QE,Wg,ZE,e_,t_,r_,i_,s_,n_,Ku,o_,w0,a_,Ue,c_,Je,u_,bu,de,h_,l_,Jg,mt,d_,f_,p_,g_,m_,Xi,Gt,nt,y_,w_,b_,je,E_,__,v_,b0,Yr,x_,S_,I_,D_,ot,yt,Ye,Wt,Jt,Xr,T_,R_,C_,N_,O_,P_,E0,L_,U_,Eu,_u,vu,_0,xu,Ko,es,M_,F_,Te,k_,B_,q_,z_,V_,K_,j_,$_,H_,G_,W_,J_,Y_,X_,Q_,Z_,ev,tv,rv,iv,sv,nv,ov,av,cv,uv,hv,lv,dv,fv,pv,gv,v0,mv,yv,Ev,_v,vv,Yg,xv,Sv,Iv,Dv,Tv,Xg,Rv,Cv,Nv,Av,Ov,Pv,Lv,Uv,Mv,Fv,kv,S0,Qg,Zg,Iu,Du,I0,Tu,D0,Bv,qv,zv,T0,Vv,R0,Kv,jv,$v,e0,t0,yu,Gv,Ru,Cu,Nu,Au,Ou,Jv,Yv,Xv,r0,Qv,Zv,i0,Qi,wu,Pu,ex,s0,tx,rx,n0,o0,Lu,ix,a0,sx,nx,c0,u0,bt,Uu,Mu,Fu,ku,Bu,ox,h0,ax,cx,l0,Zi,qu,ux,d0,hx,lx,f0,p0,zu,N0,A0=P(()=>{Ct=pe(Yt());qh();Jh();ya();wa();ie=pe(xr());Sr();Qn();Qn();ji();Fc();qg();Ji();Hg();Gg();g0=pe(Zn()),m0="wc",y0=2,Vu="core",wt=`${m0}@2:${Vu}:`,YE={name:Vu,logger:"error"},XE={database:":memory:"},QE="crypto",Wg="client_ed25519_seed",ZE=ie.ONE_DAY,e_="keychain",t_="0.3",r_="messages",i_="0.3",s_=ie.SIX_HOURS,n_="publisher",Ku="irn",o_="error",w0="wss://relay.walletconnect.org",a_="relayer",Ue={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},c_="_subscription",Je={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},u_=.1,bu="2.17.1",de={link_mode:"link_mode",relay:"relay"},h_="0.3",l_="WALLETCONNECT_CLIENT_ID",Jg="WALLETCONNECT_LINK_MODE_APPS",mt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},d_="subscription",f_="0.3",p_=ie.FIVE_SECONDS*1e3,g_="pairing",m_="0.3",Xi={wc_pairingDelete:{req:{ttl:ie.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ie.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ie.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ie.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ie.ONE_DAY,prompt:!1,tag:0},res:{ttl:ie.ONE_DAY,prompt:!1,tag:0}}},Gt={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},nt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},y_="history",w_="0.3",b_="expirer",je={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},E_="0.3",__="verify-api",v_="https://verify.walletconnect.com",b0="https://verify.walletconnect.org",Yr=b0,x_=`${Yr}/v3`,S_=[v_,b0],I_="echo",D_="https://echo.walletconnect.com",ot={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},yt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Ye={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Wt={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},Jt={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},Xr={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},T_=.1,R_="event-client",C_=86400,N_="https://pulse.walletconnect.org/batch";O_=A_,P_=O_,E0=i=>{if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")},L_=i=>new TextEncoder().encode(i),U_=i=>new TextDecoder().decode(i),Eu=class{constructor(e,r,t){this.name=e,this.prefix=r,this.baseEncode=t}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},_u=class{constructor(e,r,t){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=t}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return _0(this,e)}},vu=class{constructor(e){this.decoders=e}or(e){return _0(this,e)}decode(e){let r=e[0],t=this.decoders[r];if(t)return t.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},_0=(i,e)=>new vu({...i.decoders||{[i.prefix]:i},...e.decoders||{[e.prefix]:e}}),xu=class{constructor(e,r,t,s){this.name=e,this.prefix=r,this.baseEncode=t,this.baseDecode=s,this.encoder=new Eu(e,r,t),this.decoder=new _u(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Ko=({name:i,prefix:e,encode:r,decode:t})=>new xu(i,e,r,t),es=({prefix:i,name:e,alphabet:r})=>{let{encode:t,decode:s}=P_(r,e);return Ko({prefix:i,name:e,encode:t,decode:n=>E0(s(n))})},M_=(i,e,r,t)=>{let s={};for(let d=0;d<e.length;++d)s[e[d]]=d;let n=i.length;for(;i[n-1]==="=";)--n;let o=new Uint8Array(n*r/8|0),a=0,c=0,h=0;for(let d=0;d<n;++d){let l=s[i[d]];if(l===void 0)throw new SyntaxError(`Non-${t} character`);c=c<<r|l,a+=r,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},F_=(i,e,r)=>{let t=e[e.length-1]==="=",s=(1<<r)-1,n="",o=0,a=0;for(let c=0;c<i.length;++c)for(a=a<<8|i[c],o+=8;o>r;)o-=r,n+=e[s&a>>o];if(o&&(n+=e[s&a<<r-o]),t)for(;n.length*r&7;)n+="=";return n},Te=({name:i,prefix:e,bitsPerChar:r,alphabet:t})=>Ko({prefix:e,name:i,encode(s){return F_(s,t,r)},decode(s){return M_(s,t,r,i)}}),k_=Ko({prefix:"\0",name:"identity",encode:i=>U_(i),decode:i=>L_(i)}),B_=Object.freeze({__proto__:null,identity:k_}),q_=Te({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),z_=Object.freeze({__proto__:null,base2:q_}),V_=Te({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),K_=Object.freeze({__proto__:null,base8:V_}),j_=es({prefix:"9",name:"base10",alphabet:"0123456789"}),$_=Object.freeze({__proto__:null,base10:j_}),H_=Te({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),G_=Te({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),W_=Object.freeze({__proto__:null,base16:H_,base16upper:G_}),J_=Te({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Y_=Te({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),X_=Te({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Q_=Te({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Z_=Te({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ev=Te({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),tv=Te({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),rv=Te({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),iv=Te({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),sv=Object.freeze({__proto__:null,base32:J_,base32upper:Y_,base32pad:X_,base32padupper:Q_,base32hex:Z_,base32hexupper:ev,base32hexpad:tv,base32hexpadupper:rv,base32z:iv}),nv=es({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ov=es({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),av=Object.freeze({__proto__:null,base36:nv,base36upper:ov}),cv=es({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),uv=es({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),hv=Object.freeze({__proto__:null,base58btc:cv,base58flickr:uv}),lv=Te({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),dv=Te({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),fv=Te({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),pv=Te({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),gv=Object.freeze({__proto__:null,base64:lv,base64pad:dv,base64url:fv,base64urlpad:pv}),v0=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),mv=v0.reduce((i,e,r)=>(i[r]=e,i),[]),yv=v0.reduce((i,e,r)=>(i[e.codePointAt(0)]=r,i),[]);Ev=Ko({prefix:"\u{1F680}",name:"base256emoji",encode:wv,decode:bv}),_v=Object.freeze({__proto__:null,base256emoji:Ev}),vv=x0,Yg=128,xv=127,Sv=~xv,Iv=Math.pow(2,31);Dv=Su,Tv=128,Xg=127;Rv=Math.pow(2,7),Cv=Math.pow(2,14),Nv=Math.pow(2,21),Av=Math.pow(2,28),Ov=Math.pow(2,35),Pv=Math.pow(2,42),Lv=Math.pow(2,49),Uv=Math.pow(2,56),Mv=Math.pow(2,63),Fv=function(i){return i<Rv?1:i<Cv?2:i<Nv?3:i<Av?4:i<Ov?5:i<Pv?6:i<Lv?7:i<Uv?8:i<Mv?9:10},kv={encode:vv,decode:Dv,encodingLength:Fv},S0=kv,Qg=(i,e,r=0)=>(S0.encode(i,e,r),e),Zg=i=>S0.encodingLength(i),Iu=(i,e)=>{let r=e.byteLength,t=Zg(i),s=t+Zg(r),n=new Uint8Array(s+r);return Qg(i,n,0),Qg(r,n,t),n.set(e,s),new Du(i,r,e,n)},Du=class{constructor(e,r,t,s){this.code=e,this.size=r,this.digest=t,this.bytes=s}},I0=({name:i,code:e,encode:r})=>new Tu(i,e,r),Tu=class{constructor(e,r,t){this.name=e,this.code=r,this.encode=t}digest(e){if(e instanceof Uint8Array){let r=this.encode(e);return r instanceof Uint8Array?Iu(this.code,r):r.then(t=>Iu(this.code,t))}else throw Error("Unknown type, must be binary type")}},D0=i=>async e=>new Uint8Array(await crypto.subtle.digest(i,e)),Bv=I0({name:"sha2-256",code:18,encode:D0("SHA-256")}),qv=I0({name:"sha2-512",code:19,encode:D0("SHA-512")}),zv=Object.freeze({__proto__:null,sha256:Bv,sha512:qv}),T0=0,Vv="identity",R0=E0,Kv=i=>Iu(T0,R0(i)),jv={code:T0,name:Vv,encode:R0,digest:Kv},$v=Object.freeze({__proto__:null,identity:jv});new TextEncoder,new TextDecoder;e0={...B_,...z_,...K_,...$_,...W_,...sv,...av,...hv,...gv,..._v};({...zv,...$v});t0=C0("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),yu=C0("ascii","a",i=>{let e="a";for(let r=0;r<i.length;r++)e+=String.fromCharCode(i[r]);return e},i=>{i=i.substring(1);let e=Hv(i.length);for(let r=0;r<i.length;r++)e[r]=i.charCodeAt(r);return e}),Gv={utf8:t0,"utf-8":t0,hex:e0.base16,latin1:yu,ascii:yu,binary:yu,...e0};Ru=class{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=e_,this.version=t_,this.initialized=!1,this.storagePrefix=wt,this.init=async()=>{if(!this.initialized){let t=await this.getKeyChain();typeof t<"u"&&(this.keychain=t),this.initialized=!0}},this.has=t=>(this.isInitialized(),this.keychain.has(t)),this.set=async(t,s)=>{this.isInitialized(),this.keychain.set(t,s),await this.persist()},this.get=t=>{this.isInitialized();let s=this.keychain.get(t);if(typeof s>"u"){let{message:n}=B("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return s},this.del=async t=>{this.isInitialized(),this.keychain.delete(t),await this.persist()},this.core=e,this.logger=Ie(r,this.name)}get context(){return Re(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Vc(e))}async getKeyChain(){let e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Kc(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){let{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}},Cu=class{constructor(e,r,t){this.core=e,this.logger=r,this.name=QE,this.randomSessionIdentifier=To(),this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=s=>(this.isInitialized(),this.keychain.has(s)),this.getClientId=async()=>{this.isInitialized();let s=await this.getClientSeed(),n=pc(s);return Xn(n.publicKey)},this.generateKeyPair=()=>{this.isInitialized();let s=jp();return this.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=async s=>{this.isInitialized();let n=await this.getClientSeed(),o=pc(n),a=this.randomSessionIdentifier;return await Td(a,s,ZE,o)},this.generateSharedKey=(s,n,o)=>{this.isInitialized();let a=this.getPrivateKey(s),c=$p(a,n);return this.setSymKey(c,o)},this.setSymKey=async(s,n)=>{this.isInitialized();let o=n||jr(s);return await this.keychain.set(o,s),o},this.deleteKeyPair=async s=>{this.isInitialized(),await this.keychain.del(s)},this.deleteSymKey=async s=>{this.isInitialized(),await this.keychain.del(s)},this.encode=async(s,n,o)=>{this.isInitialized();let a=Qc(o),c=$e(n);if(eu(a))return Wp(c,o?.encoding);if(Zc(a)){let p=a.senderPublicKey,f=a.receiverPublicKey;s=await this.generateSharedKey(p,f)}let h=this.getSymKey(s),{type:d,senderPublicKey:l}=a;return Gp({type:d,symKey:h,message:c,senderPublicKey:l,encoding:o?.encoding})},this.decode=async(s,n,o)=>{this.isInitialized();let a=Qp(n,o);if(eu(a)){let c=Yp(n,o?.encoding);return ut(c)}if(Zc(a)){let c=a.receiverPublicKey,h=a.senderPublicKey;s=await this.generateSharedKey(c,h)}try{let c=this.getSymKey(s),h=Jp({symKey:c,encoded:n,encoding:o?.encoding});return ut(h)}catch(c){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}},this.getPayloadType=(s,n=pt)=>{let o=$r({encoded:s,encoding:n});return qt(o.type)},this.getPayloadSenderPublicKey=(s,n=pt)=>{let o=$r({encoded:s,encoding:n});return o.senderPublicKey?we(o.senderPublicKey,Ae):void 0},this.core=e,this.logger=Ie(r,this.name),this.keychain=t||new Ru(this.core,this.logger)}get context(){return Re(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Wg)}catch{e=To(),await this.keychain.set(Wg,e)}return Wv(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){let{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}},Nu=class extends Dn{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=r_,this.version=i_,this.initialized=!1,this.storagePrefix=wt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{let t=await this.getRelayerMessages();typeof t<"u"&&(this.messages=t),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}finally{this.initialized=!0}}},this.set=async(t,s)=>{this.isInitialized();let n=rt(s),o=this.messages.get(t);return typeof o>"u"&&(o={}),typeof o[n]<"u"||(o[n]=s,this.messages.set(t,o),await this.persist()),n},this.get=t=>{this.isInitialized();let s=this.messages.get(t);return typeof s>"u"&&(s={}),s},this.has=(t,s)=>{this.isInitialized();let n=this.get(t),o=rt(s);return typeof n[o]<"u"},this.del=async t=>{this.isInitialized(),this.messages.delete(t),await this.persist()},this.logger=Ie(e,this.name),this.core=r}get context(){return Re(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Vc(e))}async getRelayerMessages(){let e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Kc(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){let{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}},Au=class extends Tn{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new Ct.EventEmitter,this.name=n_,this.queue=new Map,this.publishTimeout=(0,ie.toMiliseconds)(ie.ONE_MINUTE),this.failedPublishTimeout=(0,ie.toMiliseconds)(ie.ONE_SECOND),this.needsTransportRestart=!1,this.publish=async(t,s,n)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:t,message:s,opts:n}});let a=n?.ttl||s_,c=Ro(n),h=n?.prompt||!1,d=n?.tag||0,l=n?.id||it().toString(),p={topic:t,message:s,opts:{ttl:a,relay:c,prompt:h,tag:d,id:l,attestation:n?.attestation}},f=`Failed to publish payload, please try again. id:${l} tag:${d}`,g=Date.now(),w,b=1;try{for(;w===void 0;){if(Date.now()-g>this.publishTimeout)throw new Error(f);this.logger.trace({id:l,attempts:b},`publisher.publish - attempt ${b}`),w=await await pr(this.rpcPublish(t,s,a,c,h,d,l,n?.attestation).catch(v=>this.logger.warn(v)),this.publishTimeout,f),b++,w||await new Promise(v=>setTimeout(v,this.failedPublishTimeout))}this.relayer.events.emit(Ue.publish,p),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{id:l,topic:t,message:s,opts:n}})}catch(v){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(v),(o=n?.internal)!=null&&o.throwOnFailedPublish)throw v;this.queue.set(l,p)}},this.on=(t,s)=>{this.events.on(t,s)},this.once=(t,s)=>{this.events.once(t,s)},this.off=(t,s)=>{this.events.off(t,s)},this.removeListener=(t,s)=>{this.events.removeListener(t,s)},this.relayer=e,this.logger=Ie(r,this.name),this.registerEventListeners()}get context(){return Re(this.logger)}rpcPublish(e,r,t,s,n,o,a,c){var h,d,l,p;let f={method:Hr(s.protocol).publish,params:{topic:e,message:r,ttl:t,prompt:n,tag:o,attestation:c},id:a};return De((h=f.params)==null?void 0:h.prompt)&&((d=f.params)==null||delete d.prompt),De((l=f.params)==null?void 0:l.tag)&&((p=f.params)==null||delete p.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:f}),this.relayer.request(f)}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{let{topic:r,message:t,opts:s}=e;await this.publish(r,t,s)})}registerEventListeners(){this.relayer.core.heartbeat.on(Xt.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Ue.connection_stalled);return}this.checkQueue()}),this.relayer.on(Ue.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}},Ou=class{constructor(){this.map=new Map,this.set=(e,r)=>{let t=this.get(e);this.exists(e,r)||this.map.set(e,[...t,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;let t=this.get(e);if(!this.exists(e,r))return;let s=t.filter(n=>n!==r);if(!s.length){this.map.delete(e);return}this.map.set(e,s)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}},Jv=Object.defineProperty,Yv=Object.defineProperties,Xv=Object.getOwnPropertyDescriptors,r0=Object.getOwnPropertySymbols,Qv=Object.prototype.hasOwnProperty,Zv=Object.prototype.propertyIsEnumerable,i0=(i,e,r)=>e in i?Jv(i,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[e]=r,Qi=(i,e)=>{for(var r in e||(e={}))Qv.call(e,r)&&i0(i,r,e[r]);if(r0)for(var r of r0(e))Zv.call(e,r)&&i0(i,r,e[r]);return i},wu=(i,e)=>Yv(i,Xv(e)),Pu=class extends Nn{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new Ou,this.events=new Ct.EventEmitter,this.name=d_,this.version=f_,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=wt,this.subscribeTimeout=(0,ie.toMiliseconds)(ie.ONE_MINUTE),this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.pendingBatchMessages=[],this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId(),await this.restore()),this.initialized=!0},this.subscribe=async(t,s)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:t,opts:s}});try{let n=Ro(s),o={topic:t,relay:n,transportType:s?.transportType};this.pending.set(t,o);let a=await this.rpcSubscribe(t,n,s);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:t,opts:s}})),a}catch(n){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(n),n}},this.unsubscribe=async(t,s)=>{await this.restartToComplete(),this.isInitialized(),typeof s?.id<"u"?await this.unsubscribeById(t,s.id,s):await this.unsubscribeByTopic(t,s)},this.isSubscribed=async t=>{if(this.topics.includes(t))return!0;let s=`${this.pendingSubscriptionWatchLabel}_${t}`;return await new Promise((n,o)=>{let a=new ie.Watch;a.start(s);let c=setInterval(()=>{!this.pending.has(t)&&this.topics.includes(t)&&(clearInterval(c),a.stop(s),n(!0)),a.elapsed(s)>=p_&&(clearInterval(c),a.stop(s),o(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)},this.on=(t,s)=>{this.events.on(t,s)},this.once=(t,s)=>{this.events.once(t,s)},this.off=(t,s)=>{this.events.off(t,s)},this.removeListener=(t,s)=>{this.events.removeListener(t,s)},this.start=async()=>{await this.onConnect()},this.stop=async()=>{await this.onDisconnect()},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=Ie(r,this.name),this.clientId=""}get context(){return Re(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let t=!1;try{t=this.getSubscription(e).topic===r}catch{}return t}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){let t=this.topicMap.get(e);await Promise.all(t.map(async s=>await this.unsubscribeById(e,s,r)))}async unsubscribeById(e,r,t){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:t}});try{let s=Ro(t);await this.rpcUnsubscribe(e,r,s);let n=ce("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:t}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,r,t){var s;t?.transportType===de.relay&&await this.restartToComplete();let n={method:Hr(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});let o=(s=t?.internal)==null?void 0:s.throwOnFailedPublish;try{let a=rt(e+this.clientId);if(t?.transportType===de.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(n).catch(h=>this.logger.warn(h))},(0,ie.toMiliseconds)(ie.ONE_SECOND)),a;let c=await pr(this.relayer.request(n).catch(h=>this.logger.warn(h)),this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!c&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return c?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Ue.connection_stalled),o)throw a}return null}async rpcBatchSubscribe(e){if(!e.length)return;let r=e[0].relay,t={method:Hr(r.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:t});try{return await await pr(this.relayer.request(t).catch(s=>this.logger.warn(s)),this.subscribeTimeout)}catch{this.relayer.events.emit(Ue.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;let r=e[0].relay,t={method:Hr(r.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:t});let s;try{s=await await pr(this.relayer.request(t).catch(n=>this.logger.warn(n)),this.subscribeTimeout)}catch{this.relayer.events.emit(Ue.connection_stalled)}return s}rpcUnsubscribe(e,r,t){let s={method:Hr(t.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,r){this.setSubscription(e,wu(Qi({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,Qi({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,t){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,t),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,Qi({},r)),this.topicMap.set(r.topic,e),this.events.emit(mt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});let r=this.subscriptions.get(e);if(!r){let{message:t}=B("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(t)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});let t=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(t.topic,e),this.events.emit(mt.deleted,wu(Qi({},t),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(mt.sync)}async reset(){if(this.cached.length){let e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<e;r++){let t=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchFetchMessages(t),await this.batchSubscribe(t)}}this.events.emit(mt.resubscribed)}async restore(){try{let e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){let{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;let r=await this.rpcBatchSubscribe(e);Vt(r)&&this.onBatchSubscribe(r.map((t,s)=>wu(Qi({},e[s]),{id:t})))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);let r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(this.pendingBatchMessages=this.pendingBatchMessages.concat(r.messages))}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||!this.relayer.connected)return;let e=[];this.pending.forEach(r=>{e.push(r)}),await this.batchSubscribe(e),this.pendingBatchMessages.length&&(await this.relayer.handleBatchMessageEvents(this.pendingBatchMessages),this.pendingBatchMessages=[])}registerEventListeners(){this.relayer.core.heartbeat.on(Xt.pulse,async()=>{await this.checkPending()}),this.events.on(mt.created,async e=>{let r=mt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on(mt.deleted,async e=>{let r=mt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){let{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){!this.relayer.connected&&!this.relayer.connecting&&await this.relayer.transportOpen(),this.restartInProgress&&await new Promise(e=>{let r=setInterval(()=>{this.restartInProgress||(clearInterval(r),e())},this.pollingInterval)})}},ex=Object.defineProperty,s0=Object.getOwnPropertySymbols,tx=Object.prototype.hasOwnProperty,rx=Object.prototype.propertyIsEnumerable,n0=(i,e,r)=>e in i?ex(i,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[e]=r,o0=(i,e)=>{for(var r in e||(e={}))tx.call(e,r)&&n0(i,r,e[r]);if(s0)for(var r of s0(e))rx.call(e,r)&&n0(i,r,e[r]);return i},Lu=class extends Rn{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new Ct.EventEmitter,this.name=a_,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","stalled","interrupted"],this.hasExperiencedNetworkDisruption=!1,this.requestsInFlight=new Map,this.heartBeatTimeout=(0,ie.toMiliseconds)(ie.THIRTY_SECONDS+ie.ONE_SECOND),this.request=async r=>{var t,s;this.logger.debug("Publishing Request Payload");let n=r.id||it().toString();await this.toEstablishConnection();try{let o=this.provider.request(r);this.requestsInFlight.set(n,{promise:o,request:r}),this.logger.trace({id:n,method:r.method,topic:(t=r.params)==null?void 0:t.topic},"relayer.request - attempt to publish...");let a=await new Promise(async(c,h)=>{let d=()=>{h(new Error(`relayer.request - publish interrupted, id: ${n}`))};this.provider.on(Je.disconnect,d);let l=await o;this.provider.off(Je.disconnect,d),c(l)});return this.logger.trace({id:n,method:r.method,topic:(s=r.params)==null?void 0:s.topic},"relayer.request - published"),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${n}`),o}finally{this.requestsInFlight.delete(n)}},this.resetPingTimeout=()=>{if(Mi())try{clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,t,s;(s=(t=(r=this.provider)==null?void 0:r.connection)==null?void 0:t.socket)==null||s.terminate()},this.heartBeatTimeout)}catch(r){this.logger.warn(r)}},this.onPayloadHandler=r=>{this.onProviderPayload(r),this.resetPingTimeout()},this.onConnectHandler=()=>{this.logger.trace("relayer connected"),this.startPingTimeout(),this.events.emit(Ue.connect)},this.onDisconnectHandler=()=>{this.logger.trace("relayer disconnected"),this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Ue.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(Je.payload,this.onPayloadHandler),this.provider.on(Je.connect,this.onConnectHandler),this.provider.on(Je.disconnect,this.onDisconnectHandler),this.provider.on(Je.error,this.onProviderErrorHandler)},this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Ie(e.logger,this.name):Pt(si({level:e.logger||o_})),this.messages=new Nu(this.logger,e.core),this.subscriber=new Pu(this,this.logger),this.publisher=new Au(this,this.logger),this.relayUrl=e?.relayUrl||w0,this.projectId=e.projectId,this.bundleId=Ap(),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.cached.length>0)try{await this.transportOpen()}catch(e){this.logger.warn(e)}}get context(){return Re(this.logger)}get connected(){var e,r,t;return((t=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:t.readyState)===1}get connecting(){var e,r,t;return((t=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:t.readyState)===0}async publish(e,r,t){this.isInitialized(),await this.publisher.publish(e,r,t),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:de.relay})}async subscribe(e,r){var t,s,n;this.isInitialized(),r?.transportType==="relay"&&await this.toEstablishConnection();let o=typeof((t=r?.internal)==null?void 0:t.throwOnFailedPublish)>"u"?!0:(s=r?.internal)==null?void 0:s.throwOnFailedPublish,a=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"",c,h=d=>{d.topic===e&&(this.subscriber.off(mt.created,h),c())};return await Promise.all([new Promise(d=>{c=d,this.subscriber.on(mt.created,h)}),new Promise(async(d,l)=>{a=await this.subscriber.subscribe(e,o0({internal:{throwOnFailedPublish:o}},r)).catch(p=>{o&&l(p)})||a,d()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){if(!this.hasExperiencedNetworkDisruption&&this.connected&&this.requestsInFlight.size>0)try{await Promise.all(Array.from(this.requestsInFlight.values()).map(e=>e.promise))}catch(e){this.logger.warn(e)}this.hasExperiencedNetworkDisruption||this.connected?await pr(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),await this.createProvider(),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;try{await new Promise(async(r,t)=>{let s=()=>{this.provider.off(Je.disconnect,s),t(new Error("Connection interrupted while trying to subscribe"))};this.provider.on(Je.disconnect,s),await pr(this.provider.connect(),(0,ie.toMiliseconds)(ie.ONE_MINUTE),`Socket stalled when trying to connect to ${this.relayUrl}`).catch(n=>{t(n)}).finally(()=>{clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0}),this.subscriber.start().catch(n=>{this.logger.error(n),this.onDisconnectHandler()}),this.hasExperiencedNetworkDisruption=!1,r()})}catch(r){this.logger.error(r);let t=r;if(this.hasExperiencedNetworkDisruption=!0,!this.isConnectionStalled(t.message))throw r}finally{this.connectionAttemptInProgress=!1}}async restartTransport(e){this.connectionAttemptInProgress||(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await cu())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}let r=e.sort((t,s)=>t.publishedAt-s.publishedAt);this.logger.trace(`Batch of ${r.length} message events sorted`);for(let t of r)try{await this.onMessageEvent(t)}catch(s){this.logger.warn(s)}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){let{topic:t}=e;if(!r.sessionExists){let s=ve(ie.FIVE_MINUTES),n={topic:t,expiry:s,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(t,n)}this.events.emit(Ue.message,e),await this.recordMessageEvent(e)}startPingTimeout(){var e,r,t,s,n;if(Mi())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((n=(s=(t=this.provider)==null?void 0:t.connection)==null?void 0:s.socket)==null||n.once("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o)}}isConnectionStalled(e){return this.staleConnectionErrors.some(r=>e.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();let e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new zo(new Vo(Op({sdkVersion:bu,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(e){let{topic:r,message:t}=e;await this.messages.set(r,t)}async shouldIgnoreMessageEvent(e){let{topic:r,message:t}=e;if(!t||t.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${t}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;let s=this.messages.has(r,t);return s&&this.logger.debug(`Ignoring duplicate message: ${t}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Jr(e)){if(!e.method.endsWith(c_))return;let r=e.params,{topic:t,message:s,publishedAt:n,attestation:o}=r.data,a={topic:t,message:s,publishedAt:n,transportType:de.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(o0({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Ht(e)&&this.events.emit(Ue.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(Ue.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){let r=Wr(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(Je.payload,this.onPayloadHandler),this.provider.off(Je.connect,this.onConnectHandler),this.provider.off(Je.disconnect,this.onDisconnectHandler),this.provider.off(Je.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await cu();mg(async r=>{e!==r&&(e=r,r?await this.restartTransport().catch(t=>this.logger.error(t)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){await this.subscriber.stop(),this.requestsInFlight.clear(),clearTimeout(this.pingTimeout),this.events.emit(Ue.disconnect),this.connectionAttemptInProgress=!1,!this.transportExplicitlyClosed&&(this.reconnectTimeout||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e))},(0,ie.toMiliseconds)(u_))))}isInitialized(){if(!this.initialized){let{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){await this.confirmOnlineStateOrThrow(),!this.connected&&(this.connectionAttemptInProgress&&await new Promise(e=>{let r=setInterval(()=>{this.connected&&(clearInterval(r),e())},this.connectionStatusPollingInterval)}),await this.transportOpen())}},ix=Object.defineProperty,a0=Object.getOwnPropertySymbols,sx=Object.prototype.hasOwnProperty,nx=Object.prototype.propertyIsEnumerable,c0=(i,e,r)=>e in i?ix(i,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[e]=r,u0=(i,e)=>{for(var r in e||(e={}))sx.call(e,r)&&c0(i,r,e[r]);if(a0)for(var r of a0(e))nx.call(e,r)&&c0(i,r,e[r]);return i},bt=class extends Cn{constructor(e,r,t,s=wt,n=void 0){super(e,r,t,s),this.core=e,this.logger=r,this.name=t,this.map=new Map,this.version=h_,this.cached=[],this.initialized=!1,this.storagePrefix=wt,this.recentlyDeleted=[],this.recentlyDeletedLimit=200,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!De(o)?this.map.set(this.getKey(o),o):rg(o)?this.map.set(o.id,o):ig(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)},this.set=async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())},this.get=o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o)),this.getAll=o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>Yi(a[c],o[c]))):this.values),this.update=async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});let c=u0(u0({},this.getData(o)),a);this.map.set(o,c),await this.persist()},this.delete=async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())},this.logger=Ie(r,this.name),this.storagePrefix=s,this.getKey=n}get context(){return Re(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){let r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){let{message:s}=B("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}let{message:t}=B("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(t),new Error(t)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{let e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){let{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){let{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}},Uu=class{constructor(e,r){this.core=e,this.logger=r,this.name=g_,this.version=m_,this.events=new Ct.default,this.initialized=!1,this.storagePrefix=wt,this.ignoredPayloadTypes=[tt],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:t})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...t])]},this.create=async t=>{this.isInitialized();let s=To(),n=await this.core.crypto.setSymKey(s),o=ve(ie.FIVE_MINUTES),a={protocol:Ku},c={topic:n,expiry:o,relay:a,active:!1,methods:t?.methods},h=ru({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:s,relay:a,expiryTimestamp:o,methods:t?.methods});return this.events.emit(Gt.create,c),this.core.expirer.set(n,o),await this.pairings.set(n,c),await this.core.relayer.subscribe(n,{transportType:t?.transportType}),{topic:n,uri:h}},this.pair=async t=>{this.isInitialized();let s=this.core.eventClient.createEvent({properties:{topic:t?.uri,trace:[ot.pairing_started]}});this.isValidPair(t,s);let{topic:n,symKey:o,relay:a,expiryTimestamp:c,methods:h}=tu(t.uri);s.props.properties.topic=n,s.addTrace(ot.pairing_uri_validation_success),s.addTrace(ot.pairing_uri_not_expired);let d;if(this.pairings.keys.includes(n)){if(d=this.pairings.get(n),s.addTrace(ot.existing_pairing),d.active)throw s.setError(yt.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);s.addTrace(ot.pairing_not_expired)}let l=c||ve(ie.FIVE_MINUTES),p={topic:n,relay:a,expiry:l,active:!1,methods:h};this.core.expirer.set(n,l),await this.pairings.set(n,p),s.addTrace(ot.store_new_pairing),t.activatePairing&&await this.activate({topic:n}),this.events.emit(Gt.create,p),s.addTrace(ot.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(o,n),s.addTrace(ot.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(yt.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:a})}catch(f){throw s.setError(yt.subscribe_pairing_topic_failure),f}return s.addTrace(ot.subscribe_pairing_topic_success),p},this.activate=async({topic:t})=>{this.isInitialized();let s=ve(ie.THIRTY_DAYS);this.core.expirer.set(t,s),await this.pairings.update(t,{active:!0,expiry:s})},this.ping=async t=>{this.isInitialized(),await this.isValidPing(t);let{topic:s}=t;if(this.pairings.keys.includes(s)){let n=await this.sendRequest(s,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Rt();this.events.once(se("pairing_ping",n),({error:h})=>{h?c(h):a()}),await o()}},this.updateExpiry=async({topic:t,expiry:s})=>{this.isInitialized(),await this.pairings.update(t,{expiry:s})},this.updateMetadata=async({topic:t,metadata:s})=>{this.isInitialized(),await this.pairings.update(t,{peerMetadata:s})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async t=>{this.isInitialized(),await this.isValidDisconnect(t);let{topic:s}=t;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",ce("USER_DISCONNECTED")),await this.deletePairing(s))},this.formatUriFromPairing=t=>{this.isInitialized();let{topic:s,relay:n,expiry:o,methods:a}=t,c=this.core.crypto.keychain.get(s);return ru({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:c,relay:n,expiryTimestamp:o,methods:a})},this.sendRequest=async(t,s,n)=>{let o=st(s,n),a=await this.core.crypto.encode(t,o),c=Xi[s].req;return this.core.history.set(t,o),this.core.relayer.publish(t,a,c),o.id},this.sendResult=async(t,s,n)=>{let o=Wr(t,n),a=await this.core.crypto.encode(s,o),c=await this.core.history.get(s,t),h=Xi[c.request.method].res;await this.core.relayer.publish(s,a,h),await this.core.history.resolve(o)},this.sendError=async(t,s,n)=>{let o=gr(t,n),a=await this.core.crypto.encode(s,o),c=await this.core.history.get(s,t),h=Xi[c.request.method]?Xi[c.request.method].res:Xi.unregistered_method.res;await this.core.relayer.publish(s,a,h),await this.core.history.resolve(o)},this.deletePairing=async(t,s)=>{await this.core.relayer.unsubscribe(t),await Promise.all([this.pairings.delete(t,ce("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(t),s?Promise.resolve():this.core.expirer.del(t)])},this.cleanup=async()=>{let t=this.pairings.getAll().filter(s=>ft(s.expiry));await Promise.all(t.map(s=>this.deletePairing(s.topic)))},this.onRelayEventRequest=t=>{let{topic:s,payload:n}=t;switch(n.method){case"wc_pairingPing":return this.onPairingPingRequest(s,n);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,n);default:return this.onUnknownRpcMethodRequest(s,n)}},this.onRelayEventResponse=async t=>{let{topic:s,payload:n}=t,o=(await this.core.history.get(s,n.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(s,n);default:return this.onUnknownRpcMethodResponse(o)}},this.onPairingPingRequest=async(t,s)=>{let{id:n}=s;try{this.isValidPing({topic:t}),await this.sendResult(n,t,!0),this.events.emit(Gt.ping,{id:n,topic:t})}catch(o){await this.sendError(n,t,o),this.logger.error(o)}},this.onPairingPingResponse=(t,s)=>{let{id:n}=s;setTimeout(()=>{Ve(s)?this.events.emit(se("pairing_ping",n),{}):Le(s)&&this.events.emit(se("pairing_ping",n),{error:s.error})},500)},this.onPairingDeleteRequest=async(t,s)=>{let{id:n}=s;try{this.isValidDisconnect({topic:t}),await this.deletePairing(t),this.events.emit(Gt.delete,{id:n,topic:t})}catch(o){await this.sendError(n,t,o),this.logger.error(o)}},this.onUnknownRpcMethodRequest=async(t,s)=>{let{id:n,method:o}=s;try{if(this.registeredMethods.includes(o))return;let a=ce("WC_METHOD_UNSUPPORTED",o);await this.sendError(n,t,a),this.logger.error(a)}catch(a){await this.sendError(n,t,a),this.logger.error(a)}},this.onUnknownRpcMethodResponse=t=>{this.registeredMethods.includes(t)||this.logger.error(ce("WC_METHOD_UNSUPPORTED",t))},this.isValidPair=(t,s)=>{var n;if(!Oe(t)){let{message:a}=B("MISSING_OR_INVALID",`pair() params: ${t}`);throw s.setError(yt.malformed_pairing_uri),new Error(a)}if(!tg(t.uri)){let{message:a}=B("MISSING_OR_INVALID",`pair() uri: ${t.uri}`);throw s.setError(yt.malformed_pairing_uri),new Error(a)}let o=tu(t?.uri);if(!((n=o?.relay)!=null&&n.protocol)){let{message:a}=B("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(yt.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){let{message:a}=B("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(yt.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&(0,ie.toMiliseconds)(o?.expiryTimestamp)<Date.now()){s.setError(yt.pairing_expired);let{message:a}=B("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}},this.isValidPing=async t=>{if(!Oe(t)){let{message:n}=B("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(n)}let{topic:s}=t;await this.isValidPairingTopic(s)},this.isValidDisconnect=async t=>{if(!Oe(t)){let{message:n}=B("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(n)}let{topic:s}=t;await this.isValidPairingTopic(s)},this.isValidPairingTopic=async t=>{if(!me(t,!1)){let{message:s}=B("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(s)}if(!this.pairings.keys.includes(t)){let{message:s}=B("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(s)}if(ft(this.pairings.get(t).expiry)){await this.deletePairing(t);let{message:s}=B("EXPIRED",`pairing topic: ${t}`);throw new Error(s)}},this.core=e,this.logger=Ie(r,this.name),this.pairings=new bt(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Re(this.logger)}isInitialized(){if(!this.initialized){let{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Ue.message,async e=>{let{topic:r,message:t,transportType:s}=e;if(!this.pairings.keys.includes(r)||s===de.link_mode||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(t)))return;let n=await this.core.crypto.decode(r,t);try{Jr(n)?(this.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):Ht(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:r,payload:n}),this.core.history.delete(r,n.id))}catch(o){this.logger.error(o)}})}registerExpirerEvents(){this.core.expirer.on(je.expired,async e=>{let{topic:r}=Io(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Gt.expire,{topic:r}))})}},Mu=class extends In{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new Ct.EventEmitter,this.name=y_,this.version=w_,this.cached=[],this.initialized=!1,this.storagePrefix=wt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(t=>this.records.set(t.id,t)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(t,s,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:t,request:s,chainId:n}),this.records.has(s.id))return;let o={id:s.id,topic:t,request:{method:s.method,params:s.params||null},chainId:n,expiry:ve(ie.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(nt.created,o)},this.resolve=async t=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:t}),!this.records.has(t.id))return;let s=await this.getRecord(t.id);typeof s.response>"u"&&(s.response=Le(t)?{error:t.error}:{result:t.result},this.records.set(s.id,s),this.persist(),this.events.emit(nt.updated,s))},this.get=async(t,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:t,id:s}),await this.getRecord(s)),this.delete=(t,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(n=>{if(n.topic===t){if(typeof s<"u"&&n.id!==s)return;this.records.delete(n.id),this.events.emit(nt.deleted,n)}}),this.persist()},this.exists=async(t,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===t:!1),this.on=(t,s)=>{this.events.on(t,s)},this.once=(t,s)=>{this.events.once(t,s)},this.off=(t,s)=>{this.events.off(t,s)},this.removeListener=(t,s)=>{this.events.removeListener(t,s)},this.logger=Ie(r,this.name)}get context(){return Re(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;let t={topic:r.topic,request:st(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(t)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();let r=this.records.get(e);if(!r){let{message:t}=B("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(t)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(nt.sync)}async restore(){try{let e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){let{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(nt.created,e=>{let r=nt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(nt.updated,e=>{let r=nt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(nt.deleted,e=>{let r=nt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(Xt.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{(0,ie.toMiliseconds)(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(nt.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){let{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}},Fu=class extends An{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new Ct.EventEmitter,this.name=b_,this.version=E_,this.cached=[],this.initialized=!1,this.storagePrefix=wt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(t=>this.expirations.set(t.target,t)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=t=>{try{let s=this.formatTarget(t);return typeof this.getExpiration(s)<"u"}catch{return!1}},this.set=(t,s)=>{this.isInitialized();let n=this.formatTarget(t),o={target:n,expiry:s};this.expirations.set(n,o),this.checkExpiry(n,o),this.events.emit(je.created,{target:n,expiration:o})},this.get=t=>{this.isInitialized();let s=this.formatTarget(t);return this.getExpiration(s)},this.del=t=>{if(this.isInitialized(),this.has(t)){let s=this.formatTarget(t),n=this.getExpiration(s);this.expirations.delete(s),this.events.emit(je.deleted,{target:s,expiration:n})}},this.on=(t,s)=>{this.events.on(t,s)},this.once=(t,s)=>{this.events.once(t,s)},this.off=(t,s)=>{this.events.off(t,s)},this.removeListener=(t,s)=>{this.events.removeListener(t,s)},this.logger=Ie(r,this.name)}get context(){return Re(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Lp(e);if(typeof e=="number")return Up(e);let{message:r}=B("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(je.sync)}async restore(){try{let e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){let{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){let r=this.expirations.get(e);if(!r){let{message:t}=B("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(t),new Error(t)}return r}checkExpiry(e,r){let{expiry:t}=r;(0,ie.toMiliseconds)(t)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(je.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Xt.pulse,()=>this.checkExpirations()),this.events.on(je.created,e=>{let r=je.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(je.expired,e=>{let r=je.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(je.deleted,e=>{let r=je.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){let{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}},ku=class extends On{constructor(e,r,t){super(e,r,t),this.core=e,this.logger=r,this.store=t,this.name=__,this.verifyUrlV3=x_,this.storagePrefix=wt,this.version=y0,this.init=async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,ie.toMiliseconds)((s=this.publicKey)==null?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))},this.register=async s=>{if(!qr()||this.isDevEnv)return;let n=window.location.origin,{id:o,decryptedId:a}=s,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${o}&decryptedId=${a}`;try{let h=(0,g0.getDocument)(),d=this.startAbortTimer(ie.ONE_SECOND*5),l=await new Promise((p,f)=>{let g=()=>{window.removeEventListener("message",b),h.body.removeChild(w),f("attestation aborted")};this.abortController.signal.addEventListener("abort",g);let w=h.createElement("iframe");w.src=c,w.style.display="none",w.addEventListener("error",g,{signal:this.abortController.signal});let b=v=>{if(v.data&&typeof v.data=="string")try{let x=JSON.parse(v.data);if(x.type==="verify_attestation"){if(Lr(x.attestation).payload.id!==o)return;clearInterval(d),h.body.removeChild(w),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",b),p(x.attestation===null?"":x.attestation)}}catch(x){this.logger.warn(x)}};h.body.appendChild(w),window.addEventListener("message",b,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",l),l}catch(h){this.logger.warn(h)}return""},this.resolve=async s=>{if(this.isDevEnv)return"";let{attestationId:n,hash:o,encryptedId:a}=s;if(n===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(n){if(Lr(n).payload.id!==a)return;let h=await this.isValidJwtAttestation(n);if(h){if(!h.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return h}}if(!o)return;let c=this.getVerifyUrl(s?.verifyUrl);return this.fetchAttestation(o,c)},this.fetchAttestation=async(s,n)=>{this.logger.debug(`resolving attestation: ${s} from url: ${n}`);let o=this.startAbortTimer(ie.ONE_SECOND*5),a=await fetch(`${n}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0},this.getVerifyUrl=s=>{let n=s||Yr;return S_.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${Yr}`),n=Yr),n},this.fetchPublicKey=async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let s=this.startAbortTimer(ie.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await n.json()}catch(s){this.logger.warn(s)}},this.persistPublicKey=async s=>{this.logger.debug("persisting public key to local storage",s),await this.store.setItem(this.storeKey,s),this.publicKey=s},this.removePublicKey=async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0},this.isValidJwtAttestation=async s=>{let n=await this.getPublicKey();try{if(n)return this.validateAttestation(s,n)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}let o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(s,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}},this.getPublicKey=async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey(),this.fetchAndPersistPublicKey=async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{let o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),n(o))});let s=await this.fetchPromise;return this.fetchPromise=void 0,s},this.validateAttestation=(s,n)=>{let o=Zp(s,n.publicKey),a={hasExpired:(0,ie.toMiliseconds)(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}},this.logger=Ie(r,this.name),this.abortController=new AbortController,this.isDevEnv=ki(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Re(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,ie.toMiliseconds)(e))}},Bu=class extends Pn{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,this.context=I_,this.registerDeviceToken=async t=>{let{clientId:s,token:n,notificationType:o,enableEncrypted:a=!1}=t,c=`${D_}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:o,token:n,always_raw:a})})},this.logger=Ie(r,this.context)}},ox=Object.defineProperty,h0=Object.getOwnPropertySymbols,ax=Object.prototype.hasOwnProperty,cx=Object.prototype.propertyIsEnumerable,l0=(i,e,r)=>e in i?ox(i,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[e]=r,Zi=(i,e)=>{for(var r in e||(e={}))ax.call(e,r)&&l0(i,r,e[r]);if(h0)for(var r of h0(e))cx.call(e,r)&&l0(i,r,e[r]);return i},qu=class extends Ln{constructor(e,r,t=!0){super(e,r,t),this.core=e,this.logger=r,this.context=R_,this.storagePrefix=wt,this.storageVersion=T_,this.events=new Map,this.shouldPersist=!1,this.init=async()=>{if(!ki())try{let s={eventId:$c(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:zc(this.core.relayer.protocol,this.core.relayer.version,bu)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}},this.createEvent=s=>{let{event:n="ERROR",type:o="",properties:{topic:a,trace:c}}=s,h=$c(),d=this.core.projectId||"",l=Date.now(),p=Zi({eventId:h,timestamp:l,props:{event:n,type:o,properties:{topic:a,trace:c}},bundleId:d,domain:this.getAppDomain()},this.setMethods(h));return this.telemetryEnabled&&(this.events.set(h,p),this.shouldPersist=!0),p},this.getEvent=s=>{let{eventId:n,topic:o}=s;if(n)return this.events.get(n);let a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Zi(Zi({},a),this.setMethods(a.eventId))},this.deleteEvent=s=>{let{eventId:n}=s;this.events.delete(n),this.shouldPersist=!0},this.setEventListeners=()=>{this.core.heartbeat.on(Xt.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{(0,ie.fromMiliseconds)(Date.now())-(0,ie.fromMiliseconds)(s.timestamp)>C_&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})},this.setMethods=s=>({addTrace:n=>this.addTrace(s,n),setError:n=>this.setError(s,n)}),this.addTrace=(s,n)=>{let o=this.events.get(s);o&&(o.props.properties.trace.push(n),this.events.set(s,o),this.shouldPersist=!0)},this.setError=(s,n)=>{let o=this.events.get(s);o&&(o.props.type=n,o.timestamp=Date.now(),this.events.set(s,o),this.shouldPersist=!0)},this.persist=async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1},this.restore=async()=>{try{let s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(n=>{this.events.set(n.eventId,Zi(Zi({},n),this.setMethods(n.eventId)))})}catch(s){this.logger.warn(s)}},this.submit=async()=>{if(!this.telemetryEnabled||this.events.size===0)return;let s=[];for(let[n,o]of this.events)o.props.type&&s.push(o);if(s.length!==0)try{if((await this.sendEvent(s)).ok)for(let n of s)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}},this.sendEvent=async s=>{let n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${N_}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${bu}${n}`,{method:"POST",body:JSON.stringify(s)})},this.getAppDomain=()=>zr().url,this.logger=Ie(r,this.context),this.telemetryEnabled=t,t?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}},ux=Object.defineProperty,d0=Object.getOwnPropertySymbols,hx=Object.prototype.hasOwnProperty,lx=Object.prototype.propertyIsEnumerable,f0=(i,e,r)=>e in i?ux(i,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[e]=r,p0=(i,e)=>{for(var r in e||(e={}))hx.call(e,r)&&f0(i,r,e[r]);if(d0)for(var r of d0(e))lx.call(e,r)&&f0(i,r,e[r]);return i},zu=class i extends Sn{constructor(e){var r;super(e),this.protocol=m0,this.version=y0,this.name=Vu,this.events=new Ct.EventEmitter,this.initialized=!1,this.on=(o,a)=>this.events.on(o,a),this.once=(o,a)=>this.events.once(o,a),this.off=(o,a)=>this.events.off(o,a),this.removeListener=(o,a)=>this.events.removeListener(o,a),this.dispatchEnvelope=({topic:o,message:a,sessionExists:c})=>{if(!o||!a)return;let h={topic:o,message:a,publishedAt:Date.now(),transportType:de.link_mode};this.relayer.onLinkMessageEvent(h,{sessionExists:c})},this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||w0,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";let t=si({level:typeof e?.logger=="string"&&e.logger?e.logger:YE.logger}),{logger:s,chunkLoggerController:n}=Zh({opts:t,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=n,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var o,a;(o=this.logChunkController)!=null&&o.downloadLogsBlobInBrowser&&((a=this.logChunkController)==null||a.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Ie(s,this.name),this.heartbeat=new gn,this.crypto=new Cu(this,this.logger,e?.keychain),this.history=new Mu(this,this.logger),this.expirer=new Fu(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new wn(p0(p0({},XE),e?.storageOptions)),this.relayer=new Lu({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Uu(this,this.logger),this.verify=new ku(this,this.logger,this.storage),this.echoClient=new Bu(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new qu(this,this.logger,e?.telemetryEnabled)}static async init(e){let r=new i(e);await r.initialize();let t=await r.crypto.getClientId();return await r.storage.setItem(l_,t),r}get context(){return Re(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(Jg,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.eventClient.init(),this.linkModeSupportedApps=await this.storage.getItem(Jg)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}},N0=zu});var Ho,ae,U0,M0,F0,eh,ju,O0,dx,fx,px,Qr,gx,xe,$u,Et,mx,yx,wx,bx,Ex,_x,vx,Go,jo,xx,Sx,Ix,P0,Dx,Tx,L0,Ee,at,Hu,Gu,Wu,Ju,Yu,Xu,Qu,Zu,$o,k0=P(()=>{A0();ya();wa();ji();Ho=pe(Yt()),ae=pe(xr());Ji();U0="wc",M0=2,F0="client",eh=`${U0}@${M0}:${F0}:`,ju={name:F0,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.org"},O0="WALLETCONNECT_DEEPLINK_CHOICE",dx="proposal",fx="Proposal expired",px="session",Qr=ae.SEVEN_DAYS,gx="engine",xe={wc_sessionPropose:{req:{ttl:ae.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ae.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:ae.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:ae.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:ae.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ae.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ae.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ae.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ae.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ae.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ae.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ae.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ae.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ae.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ae.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ae.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ae.ONE_DAY,prompt:!1,tag:1114},res:{ttl:ae.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:ae.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:ae.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:ae.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:ae.FIVE_MINUTES,prompt:!1,tag:1119}}},$u={min:ae.FIVE_MINUTES,max:ae.SEVEN_DAYS},Et={idle:"IDLE",active:"ACTIVE"},mx="request",yx=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],wx="wc",bx="auth",Ex="authKeys",_x="pairingTopics",vx="requests",Go=`${wx}@${1.5}:${bx}:`,jo=`${Go}:PUB_KEY`,xx=Object.defineProperty,Sx=Object.defineProperties,Ix=Object.getOwnPropertyDescriptors,P0=Object.getOwnPropertySymbols,Dx=Object.prototype.hasOwnProperty,Tx=Object.prototype.propertyIsEnumerable,L0=(i,e,r)=>e in i?xx(i,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[e]=r,Ee=(i,e)=>{for(var r in e||(e={}))Dx.call(e,r)&&L0(i,r,e[r]);if(P0)for(var r of P0(e))Tx.call(e,r)&&L0(i,r,e[r]);return i},at=(i,e)=>Sx(i,Ix(e)),Hu=class extends Mn{constructor(e){super(e),this.name=gx,this.events=new Ho.default,this.initialized=!1,this.requestQueue={state:Et.idle,queue:[]},this.sessionRequestQueue={state:Et.idle,queue:[]},this.requestQueueDelay=ae.ONE_SECOND,this.expectedPairingMethodMap=new Map,this.recentlyDeletedMap=new Map,this.recentlyDeletedLimit=200,this.relayMessageCache=[],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(xe)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,ae.toMiliseconds)(this.requestQueueDelay)))},this.connect=async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();let t=at(Ee({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(t);let{pairingTopic:s,requiredNamespaces:n,optionalNamespaces:o,sessionProperties:a,relays:c}=t,h=s,d,l=!1;try{h&&(l=this.client.core.pairing.pairings.get(h).active)}catch(S){throw this.client.logger.error(`connect() -> pairing.get(${h}) failed`),S}if(!h||!l){let{topic:S,uri:T}=await this.client.core.pairing.create();h=S,d=T}if(!h){let{message:S}=B("NO_MATCHING_KEY",`connect() pairing topic: ${h}`);throw new Error(S)}let p=await this.client.core.crypto.generateKeyPair(),f=xe.wc_sessionPropose.req.ttl||ae.FIVE_MINUTES,g=ve(f),w=Ee({requiredNamespaces:n,optionalNamespaces:o,relays:c??[{protocol:Ku}],proposer:{publicKey:p,metadata:this.client.metadata},expiryTimestamp:g,pairingTopic:h},a&&{sessionProperties:a}),{reject:b,resolve:v,done:x}=Rt(f,fx);this.events.once(se("session_connect"),async({error:S,session:T})=>{if(S)b(S);else if(T){T.self.publicKey=p;let L=at(Ee({},T),{pairingTopic:w.pairingTopic,requiredNamespaces:w.requiredNamespaces,optionalNamespaces:w.optionalNamespaces,transportType:de.relay});await this.client.session.set(T.topic,L),await this.setExpiry(T.topic,T.expiry),h&&await this.client.core.pairing.updateMetadata({topic:h,metadata:T.peer.metadata}),this.cleanupDuplicatePairings(L),v(L)}});let I=await this.sendRequest({topic:h,method:"wc_sessionPropose",params:w,throwOnFailedPublish:!0});return await this.setProposal(I,Ee({id:I},w)),{uri:d,approval:x}},this.pair=async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(t){throw this.client.logger.error("pair() failed"),t}},this.approve=async r=>{var t,s,n;let o=this.client.core.eventClient.createEvent({properties:{topic:(t=r?.id)==null?void 0:t.toString(),trace:[Ye.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(m){throw o.setError(Wt.no_internet_connection),m}try{await this.isValidProposalId(r?.id)}catch(m){throw this.client.logger.error(`approve() -> proposal.get(${r?.id}) failed`),o.setError(Wt.proposal_not_found),m}try{await this.isValidApprove(r)}catch(m){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Wt.session_approve_namespace_validation_failure),m}let{id:a,relayProtocol:c,namespaces:h,sessionProperties:d,sessionConfig:l}=r,p=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});let{pairingTopic:f,proposer:g,requiredNamespaces:w,optionalNamespaces:b}=p,v=(s=this.client.core.eventClient)==null?void 0:s.getEvent({topic:f});v||(v=(n=this.client.core.eventClient)==null?void 0:n.createEvent({type:Ye.session_approve_started,properties:{topic:f,trace:[Ye.session_approve_started,Ye.session_namespaces_validation_success]}}));let x=await this.client.core.crypto.generateKeyPair(),I=g.publicKey,S=await this.client.core.crypto.generateSharedKey(x,I),T=Ee(Ee({relay:{protocol:c??"irn"},namespaces:h,controller:{publicKey:x,metadata:this.client.metadata},expiry:ve(Qr)},d&&{sessionProperties:d}),l&&{sessionConfig:l}),L=de.relay;v.addTrace(Ye.subscribing_session_topic);try{await this.client.core.relayer.subscribe(S,{transportType:L})}catch(m){throw v.setError(Wt.subscribe_session_topic_failure),m}v.addTrace(Ye.subscribe_session_topic_success);let y=at(Ee({},T),{topic:S,requiredNamespaces:w,optionalNamespaces:b,pairingTopic:f,acknowledged:!1,self:T.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:x,transportType:de.relay});await this.client.session.set(S,y),v.addTrace(Ye.store_session);try{v.addTrace(Ye.publishing_session_settle),await this.sendRequest({topic:S,method:"wc_sessionSettle",params:T,throwOnFailedPublish:!0}).catch(m=>{throw v?.setError(Wt.session_settle_publish_failure),m}),v.addTrace(Ye.session_settle_publish_success),v.addTrace(Ye.publishing_session_approve),await this.sendResult({id:a,topic:f,result:{relay:{protocol:c??"irn"},responderPublicKey:x},throwOnFailedPublish:!0}).catch(m=>{throw v?.setError(Wt.session_approve_publish_failure),m}),v.addTrace(Ye.session_approve_publish_success)}catch(m){throw this.client.logger.error(m),this.client.session.delete(S,ce("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(S),m}return this.client.core.eventClient.deleteEvent({eventId:v.eventId}),await this.client.core.pairing.updateMetadata({topic:f,metadata:g.metadata}),await this.client.proposal.delete(a,ce("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:f}),await this.setExpiry(S,ve(Qr)),{topic:S,acknowledged:()=>Promise.resolve(this.client.session.get(S))}},this.reject=async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}let{id:t,reason:s}=r,n;try{n=this.client.proposal.get(t).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${t}) failed`),o}n&&(await this.sendError({id:t,topic:n,error:s,rpcOpts:xe.wc_sessionPropose.reject}),await this.client.proposal.delete(t,ce("USER_DISCONNECTED")))},this.update=async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(l){throw this.client.logger.error("update() -> isValidUpdate() failed"),l}let{topic:t,namespaces:s}=r,{done:n,resolve:o,reject:a}=Rt(),c=gt(),h=it().toString(),d=this.client.session.get(t).namespaces;return this.events.once(se("session_update",c),({error:l})=>{l?a(l):o()}),await this.client.session.update(t,{namespaces:s}),await this.sendRequest({topic:t,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:h}).catch(l=>{this.client.logger.error(l),this.client.session.update(t,{namespaces:d}),a(l)}),{acknowledged:n}},this.extend=async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}let{topic:t}=r,s=gt(),{done:n,resolve:o,reject:a}=Rt();return this.events.once(se("session_extend",s),({error:c})=>{c?a(c):o()}),await this.setExpiry(t,ve(Qr)),this.sendRequest({topic:t,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:n}},this.request=async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(g){throw this.client.logger.error("request() -> isValidRequest() failed"),g}let{chainId:t,request:s,topic:n,expiry:o=xe.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(n);a?.transportType===de.relay&&await this.confirmOnlineStateOrThrow();let c=gt(),h=it().toString(),{done:d,resolve:l,reject:p}=Rt(o,"Request expired. Please try again.");this.events.once(se("session_request",c),({error:g,result:w})=>{g?p(g):l(w)});let f=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);return f?(await this.sendRequest({clientRpcId:c,relayRpcId:h,topic:n,method:"wc_sessionRequest",params:{request:at(Ee({},s),{expiryTimestamp:ve(o)}),chainId:t},expiry:o,throwOnFailedPublish:!0,appLink:f}).catch(g=>p(g)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:t,id:c}),await d()):await Promise.all([new Promise(async g=>{await this.sendRequest({clientRpcId:c,relayRpcId:h,topic:n,method:"wc_sessionRequest",params:{request:at(Ee({},s),{expiryTimestamp:ve(o)}),chainId:t},expiry:o,throwOnFailedPublish:!0}).catch(w=>p(w)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:t,id:c}),g()}),new Promise(async g=>{var w;if(!((w=a.sessionConfig)!=null&&w.disableDeepLink)){let b=await Fp(this.client.core.storage,O0);await Mp({id:c,topic:n,wcDeepLink:b})}g()}),d()]).then(g=>g[2])},this.respond=async r=>{this.isInitialized(),await this.isValidRespond(r);let{topic:t,response:s}=r,{id:n}=s,o=this.client.session.get(t);o.transportType===de.relay&&await this.confirmOnlineStateOrThrow();let a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);Ve(s)?await this.sendResult({id:n,topic:t,result:s.result,throwOnFailedPublish:!0,appLink:a}):Le(s)&&await this.sendError({id:n,topic:t,error:s.error,appLink:a}),this.cleanupAfterResponse(r)},this.ping=async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}let{topic:t}=r;if(this.client.session.keys.includes(t)){let s=gt(),n=it().toString(),{done:o,resolve:a,reject:c}=Rt();this.events.once(se("session_ping",s),({error:h})=>{h?c(h):a()}),await Promise.all([this.sendRequest({topic:t,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:n}),o()])}else this.client.core.pairing.pairings.keys.includes(t)&&await this.client.core.pairing.ping({topic:t})},this.emit=async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);let{topic:t,event:s,chainId:n}=r,o=it().toString();await this.sendRequest({topic:t,method:"wc_sessionEvent",params:{event:s,chainId:n},throwOnFailedPublish:!0,relayRpcId:o})},this.disconnect=async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);let{topic:t}=r;if(this.client.session.keys.includes(t))await this.sendRequest({topic:t,method:"wc_sessionDelete",params:ce("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:t,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(t))await this.client.core.pairing.disconnect({topic:t});else{let{message:s}=B("MISMATCHED_TOPIC",`Session or pairing topic not found: ${t}`);throw new Error(s)}},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(t=>eg(t,r))),this.getPendingSessionRequests=()=>this.client.pendingRequest.getAll(),this.authenticate=async(r,t)=>{var s;this.isInitialized(),this.isValidAuthenticate(r);let n=t&&this.client.core.linkModeSupportedApps.includes(t)&&((s=this.client.metadata.redirect)==null?void 0:s.linkMode),o=n?de.link_mode:de.relay;o===de.relay&&await this.confirmOnlineStateOrThrow();let{chains:a,statement:c="",uri:h,domain:d,nonce:l,type:p,exp:f,nbf:g,methods:w=[],expiry:b}=r,v=[...r.resources||[]],{topic:x,uri:I}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:x,uri:I}});let S=await this.client.core.crypto.generateKeyPair(),T=jr(S);if(await Promise.all([this.client.auth.authKeys.set(jo,{responseTopic:T,publicKey:S}),this.client.auth.pairingTopics.set(T,{topic:T,pairingTopic:x})]),await this.client.core.relayer.subscribe(T,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${x}`),w.length>0){let{namespace:j}=Ui(a[0]),re=qp(j,"request",w);qi(v)&&(re=zp(re,v.pop())),v.push(re)}let L=b&&b>xe.wc_sessionAuthenticate.req.ttl?b:xe.wc_sessionAuthenticate.req.ttl,y={authPayload:{type:p??"caip122",chains:a,statement:c,aud:h,domain:d,version:"1",nonce:l,iat:new Date().toISOString(),exp:f,nbf:g,resources:v},requester:{publicKey:S,metadata:this.client.metadata},expiryTimestamp:ve(L)},m={eip155:{chains:a,methods:[...new Set(["personal_sign",...w])],events:["chainChanged","accountsChanged"]}},k={requiredNamespaces:{},optionalNamespaces:m,relays:[{protocol:"irn"}],pairingTopic:x,proposer:{publicKey:S,metadata:this.client.metadata},expiryTimestamp:ve(xe.wc_sessionPropose.req.ttl)},{done:$,resolve:O,reject:C}=Rt(L,"Request expired"),R=async({error:j,session:re})=>{if(this.events.off(se("session_request",G),N),j)C(j);else if(re){re.self.publicKey=S,await this.client.session.set(re.topic,re),await this.setExpiry(re.topic,re.expiry),x&&await this.client.core.pairing.updateMetadata({topic:x,metadata:re.peer.metadata});let Y=this.client.session.get(re.topic);await this.deleteProposal(H),O({session:Y})}},N=async j=>{var re,Y,Z;if(await this.deletePendingAuthRequest(G,{message:"fulfilled",code:0}),j.error){let D=ce("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return j.error.code===D.code?void 0:(this.events.off(se("session_connect"),R),C(j.error.message))}await this.deleteProposal(H),this.events.off(se("session_connect"),R);let{cacaos:V,responder:J}=j.result,X=[],u=[];for(let D of V){await Gc({cacao:D,projectId:this.client.core.projectId})||(this.client.logger.error(D,"Signature verification failed"),C(ce("SESSION_SETTLEMENT_FAILED","Signature verification failed")));let{p:A}=D,U=qi(A.resources),F=[Do(A.iss)],M=Bi(A.iss);if(U){let Q=Jc(U),z=Yc(U);X.push(...Q),F.push(...z)}for(let Q of F)u.push(`${Q}:${M}`)}let E=await this.client.core.crypto.generateSharedKey(S,J.publicKey),_;X.length>0&&(_={topic:E,acknowledged:!0,self:{publicKey:S,metadata:this.client.metadata},peer:J,controller:J.publicKey,expiry:ve(Qr),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:x,namespaces:iu([...new Set(X)],[...new Set(u)]),transportType:o},await this.client.core.relayer.subscribe(E,{transportType:o}),await this.client.session.set(E,_),x&&await this.client.core.pairing.updateMetadata({topic:x,metadata:J.metadata}),_=this.client.session.get(E)),(re=this.client.metadata.redirect)!=null&&re.linkMode&&(Y=J.metadata.redirect)!=null&&Y.linkMode&&(Z=J.metadata.redirect)!=null&&Z.universal&&t&&(this.client.core.addLinkModeSupportedApp(J.metadata.redirect.universal),this.client.session.update(E,{transportType:de.link_mode})),O({auths:V,session:_})},G=gt(),H=gt();this.events.once(se("session_connect"),R),this.events.once(se("session_request",G),N);let q;try{if(n){let j=st("wc_sessionAuthenticate",y,G);this.client.core.history.set(x,j);let re=await this.client.core.crypto.encode("",j,{type:Kr,encoding:Vr});q=Vi(t,x,re)}else await Promise.all([this.sendRequest({topic:x,method:"wc_sessionAuthenticate",params:y,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:G}),this.sendRequest({topic:x,method:"wc_sessionPropose",params:k,expiry:xe.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:H})])}catch(j){throw this.events.off(se("session_connect"),R),this.events.off(se("session_request",G),N),j}return await this.setProposal(H,Ee({id:H},k)),await this.setAuthRequest(G,{request:at(Ee({},y),{verifyContext:{}}),pairingTopic:x,transportType:o}),{uri:q??I,response:$}},this.approveSessionAuthenticate=async r=>{let{id:t,auths:s}=r,n=this.client.core.eventClient.createEvent({properties:{topic:t.toString(),trace:[Jt.authenticated_session_approve_started]}});try{this.isInitialized()}catch(b){throw n.setError(Xr.no_internet_connection),b}let o=this.getPendingAuthRequest(t);if(!o)throw n.setError(Xr.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${t}`);let a=o.transportType||de.relay;a===de.relay&&await this.confirmOnlineStateOrThrow();let c=o.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),d=jr(c),l={type:tt,receiverPublicKey:c,senderPublicKey:h},p=[],f=[];for(let b of s){if(!await Gc({cacao:b,projectId:this.client.core.projectId})){n.setError(Xr.invalid_cacao);let T=ce("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:t,topic:d,error:T,encodeOpts:l}),new Error(T.message)}n.addTrace(Jt.cacaos_verified);let{p:v}=b,x=qi(v.resources),I=[Do(v.iss)],S=Bi(v.iss);if(x){let T=Jc(x),L=Yc(x);p.push(...T),I.push(...L)}for(let T of I)f.push(`${T}:${S}`)}let g=await this.client.core.crypto.generateSharedKey(h,c);n.addTrace(Jt.create_authenticated_session_topic);let w;if(p?.length>0){w={topic:g,acknowledged:!0,self:{publicKey:h,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:ve(Qr),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:iu([...new Set(p)],[...new Set(f)]),transportType:a},n.addTrace(Jt.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(g,{transportType:a})}catch(b){throw n.setError(Xr.subscribe_authenticated_session_topic_failure),b}n.addTrace(Jt.subscribe_authenticated_session_topic_success),await this.client.session.set(g,w),n.addTrace(Jt.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}n.addTrace(Jt.publishing_authenticated_session_approve);try{await this.sendResult({topic:d,id:t,result:{cacaos:s,responder:{publicKey:h,metadata:this.client.metadata}},encodeOpts:l,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(b){throw n.setError(Xr.authenticated_session_approve_publish_failure),b}return await this.client.auth.requests.delete(t,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:w}},this.rejectSessionAuthenticate=async r=>{this.isInitialized();let{id:t,reason:s}=r,n=this.getPendingAuthRequest(t);if(!n)throw new Error(`Could not find pending auth request with id ${t}`);n.transportType===de.relay&&await this.confirmOnlineStateOrThrow();let o=n.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=jr(o),h={type:tt,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:t,topic:c,error:s,encodeOpts:h,rpcOpts:xe.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(n.requester.metadata,n.transportType)}),await this.client.auth.requests.delete(t,{message:"rejected",code:0}),await this.client.proposal.delete(t,ce("USER_DISCONNECTED"))},this.formatAuthMessage=r=>{this.isInitialized();let{request:t,iss:s}=r;return Wc(t,s)},this.processRelayMessageCache=()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{let r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)},this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{let t=this.client.core.pairing.pairings.get(r.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(n=>{var o,a;return((o=n.peerMetadata)==null?void 0:o.url)&&((a=n.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&n.topic&&n.topic!==t.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(t){this.client.logger.error(t)}},this.deleteSession=async r=>{var t;let{topic:s,expirerHasDeleted:n=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,ce("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),n||this.client.core.expirer.del(s),this.client.core.storage.removeItem(O0).catch(h=>this.client.logger.warn(h)),this.getPendingSessionRequests().forEach(h=>{h.topic===s&&this.deletePendingSessionRequest(h.id,ce("USER_DISCONNECTED"))}),s===((t=this.sessionRequestQueue.queue[0])==null?void 0:t.topic)&&(this.sessionRequestQueue.state=Et.idle),o&&this.client.events.emit("session_delete",{id:a,topic:s})},this.deleteProposal=async(r,t)=>{if(t)try{let s=this.client.proposal.get(r);this.client.core.eventClient.getEvent({topic:s.pairingTopic})?.setError(Wt.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,ce("USER_DISCONNECTED")),t?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")},this.deletePendingSessionRequest=async(r,t,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,t),s?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==r),s&&(this.sessionRequestQueue.state=Et.idle,this.client.events.emit("session_request_expire",{id:r}))},this.deletePendingAuthRequest=async(r,t,s=!1)=>{await Promise.all([this.client.auth.requests.delete(r,t),s?Promise.resolve():this.client.core.expirer.del(r)])},this.setExpiry=async(r,t)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,t),await this.client.session.update(r,{expiry:t}))},this.setProposal=async(r,t)=>{this.client.core.expirer.set(r,ve(xe.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,t)},this.setAuthRequest=async(r,t)=>{let{request:s,pairingTopic:n,transportType:o=de.relay}=t;this.client.core.expirer.set(r,s.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:r,pairingTopic:n,verifyContext:s.verifyContext,transportType:o})},this.setPendingSessionRequest=async r=>{let{id:t,topic:s,params:n,verifyContext:o}=r,a=n.request.expiryTimestamp||ve(xe.wc_sessionRequest.req.ttl);this.client.core.expirer.set(t,a),await this.client.pendingRequest.set(t,{id:t,topic:s,params:n,verifyContext:o})},this.sendRequest=async r=>{let{topic:t,method:s,params:n,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:h,appLink:d}=r,l=st(s,n,c),p,f=!!d;try{let b=f?Vr:pt;p=await this.client.core.crypto.encode(t,l,{encoding:b})}catch(b){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${t} failed`),b}let g;if(yx.includes(s)){let b=rt(JSON.stringify(l)),v=rt(p);g=await this.client.core.verify.register({id:v,decryptedId:b})}let w=xe[s].req;if(w.attestation=g,o&&(w.ttl=o),a&&(w.id=a),this.client.core.history.set(t,l),f){let b=Vi(d,t,p);await window.Linking.openURL(b,this.client.name)}else{let b=xe[s].req;o&&(b.ttl=o),a&&(b.id=a),h?(b.internal=at(Ee({},b.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(t,p,b)):this.client.core.relayer.publish(t,p,b).catch(v=>this.client.logger.error(v))}return l.id},this.sendResult=async r=>{let{id:t,topic:s,result:n,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,h=Wr(t,n),d,l=c&&typeof window?.Linking<"u";try{let f=l?Vr:pt;d=await this.client.core.crypto.encode(s,h,at(Ee({},a||{}),{encoding:f}))}catch(f){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),f}let p;try{p=await this.client.core.history.get(s,t)}catch(f){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${t}) failed`),f}if(l){let f=Vi(c,s,d);await window.Linking.openURL(f,this.client.name)}else{let f=xe[p.request.method].res;o?(f.internal=at(Ee({},f.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,d,f)):this.client.core.relayer.publish(s,d,f).catch(g=>this.client.logger.error(g))}await this.client.core.history.resolve(h)},this.sendError=async r=>{let{id:t,topic:s,error:n,encodeOpts:o,rpcOpts:a,appLink:c}=r,h=gr(t,n),d,l=c&&typeof window?.Linking<"u";try{let f=l?Vr:pt;d=await this.client.core.crypto.encode(s,h,at(Ee({},o||{}),{encoding:f}))}catch(f){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),f}let p;try{p=await this.client.core.history.get(s,t)}catch(f){throw this.client.logger.error(`sendError() -> history.get(${s}, ${t}) failed`),f}if(l){let f=Vi(c,s,d);await window.Linking.openURL(f,this.client.name)}else{let f=a||xe[p.request.method].res;this.client.core.relayer.publish(s,d,f)}await this.client.core.history.resolve(h)},this.cleanup=async()=>{let r=[],t=[];this.client.session.getAll().forEach(s=>{let n=!1;ft(s.expiry)&&(n=!0),this.client.core.crypto.keychain.has(s.topic)||(n=!0),n&&r.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{ft(s.expiryTimestamp)&&t.push(s.id)}),await Promise.all([...r.map(s=>this.deleteSession({topic:s})),...t.map(s=>this.deleteProposal(s))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===Et.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Et.active;let r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(t){this.client.logger.warn(t)}}this.requestQueue.state=Et.idle},this.processRequest=async r=>{let{topic:t,payload:s,attestation:n,transportType:o,encryptedId:a}=r,c=s.method;if(!this.shouldIgnorePairingRequest({topic:t,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:t,payload:s,attestation:n,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(t,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(t,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(t,s);case"wc_sessionPing":return await this.onSessionPingRequest(t,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(t,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:t,payload:s,attestation:n,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(t,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:t,payload:s,attestation:n,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}},this.onRelayEventResponse=async r=>{let{topic:t,payload:s,transportType:n}=r,o=(await this.client.core.history.get(t,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(t,s,n);case"wc_sessionSettle":return this.onSessionSettleResponse(t,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(t,s);case"wc_sessionExtend":return this.onSessionExtendResponse(t,s);case"wc_sessionPing":return this.onSessionPingResponse(t,s);case"wc_sessionRequest":return this.onSessionRequestResponse(t,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(t,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}},this.onRelayEventUnknownPayload=r=>{let{topic:t}=r,{message:s}=B("MISSING_OR_INVALID",`Decoded payload on topic ${t} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)},this.shouldIgnorePairingRequest=r=>{let{topic:t,requestMethod:s}=r,n=this.expectedPairingMethodMap.get(t);return!n||n.includes(s)?!1:!!(n.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)},this.onSessionProposeRequest=async r=>{let{topic:t,payload:s,attestation:n,encryptedId:o}=r,{params:a,id:c}=s;try{let h=this.client.core.eventClient.getEvent({topic:t});this.isValidConnect(Ee({},s.params));let d=a.expiryTimestamp||ve(xe.wc_sessionPropose.req.ttl),l=Ee({id:c,pairingTopic:t,expiryTimestamp:d},a);await this.setProposal(c,l);let p=await this.getVerifyContext({attestationId:n,hash:rt(JSON.stringify(s)),encryptedId:o,metadata:l.proposer.metadata});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),h?.setError(yt.proposal_listener_not_found)),h?.addTrace(ot.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:l,verifyContext:p})}catch(h){await this.sendError({id:c,topic:t,error:h,rpcOpts:xe.wc_sessionPropose.autoReject}),this.client.logger.error(h)}},this.onSessionProposeResponse=async(r,t,s)=>{let{id:n}=t;if(Ve(t)){let{result:o}=t;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});let a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});let c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});let h=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});let d=await this.client.core.crypto.generateSharedKey(c,h);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:d});let l=await this.client.core.relayer.subscribe(d,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:l}),await this.client.core.pairing.activate({topic:r})}else if(Le(t)){await this.client.proposal.delete(n,ce("USER_DISCONNECTED"));let o=se("session_connect");if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(se("session_connect"),{error:t.error})}},this.onSessionSettleRequest=async(r,t)=>{let{id:s,params:n}=t;try{this.isValidSessionSettleRequest(n);let{relay:o,controller:a,expiry:c,namespaces:h,sessionProperties:d,sessionConfig:l}=t.params,p=at(Ee(Ee({topic:r,relay:o,expiry:c,namespaces:h,acknowledged:!0,pairingTopic:"",requiredNamespaces:{},optionalNamespaces:{},controller:a.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},d&&{sessionProperties:d}),l&&{sessionConfig:l}),{transportType:de.relay}),f=se("session_connect");if(this.events.listenerCount(f)===0)throw new Error(`emitting ${f} without any listeners 997`);this.events.emit(se("session_connect"),{session:p}),await this.sendResult({id:t.id,topic:r,result:!0,throwOnFailedPublish:!0})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}},this.onSessionSettleResponse=async(r,t)=>{let{id:s}=t;Ve(t)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(se("session_approve",s),{})):Le(t)&&(await this.client.session.delete(r,ce("USER_DISCONNECTED")),this.events.emit(se("session_approve",s),{error:t.error}))},this.onSessionUpdateRequest=async(r,t)=>{let{params:s,id:n}=t;try{let o=`${r}_session_update`,a=zt.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.info(`Discarding out of sync request - ${n}`),this.sendError({id:n,topic:r,error:ce("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(Ee({topic:r},s));try{zt.set(o,n),await this.client.session.update(r,{namespaces:s.namespaces}),await this.sendResult({id:n,topic:r,result:!0,throwOnFailedPublish:!0})}catch(c){throw zt.delete(o),c}this.client.events.emit("session_update",{id:n,topic:r,params:s})}catch(o){await this.sendError({id:n,topic:r,error:o}),this.client.logger.error(o)}},this.isRequestOutOfSync=(r,t)=>parseInt(t.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,t)=>{let{id:s}=t,n=se("session_update",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);Ve(t)?this.events.emit(se("session_update",s),{}):Le(t)&&this.events.emit(se("session_update",s),{error:t.error})},this.onSessionExtendRequest=async(r,t)=>{let{id:s}=t;try{this.isValidExtend({topic:r}),await this.setExpiry(r,ve(Qr)),await this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:s,topic:r})}catch(n){await this.sendError({id:s,topic:r,error:n}),this.client.logger.error(n)}},this.onSessionExtendResponse=(r,t)=>{let{id:s}=t,n=se("session_extend",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);Ve(t)?this.events.emit(se("session_extend",s),{}):Le(t)&&this.events.emit(se("session_extend",s),{error:t.error})},this.onSessionPingRequest=async(r,t)=>{let{id:s}=t;try{this.isValidPing({topic:r}),await this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:r})}catch(n){await this.sendError({id:s,topic:r,error:n}),this.client.logger.error(n)}},this.onSessionPingResponse=(r,t)=>{let{id:s}=t,n=se("session_ping",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);setTimeout(()=>{Ve(t)?this.events.emit(se("session_ping",s),{}):Le(t)&&this.events.emit(se("session_ping",s),{error:t.error})},500)},this.onSessionDeleteRequest=async(r,t)=>{let{id:s}=t;try{this.isValidDisconnect({topic:r,reason:t.params}),Promise.all([new Promise(n=>{this.client.core.relayer.once(Ue.publish,async()=>{n(await this.deleteSession({topic:r,id:s}))})}),this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:ce("USER_DISCONNECTED")})]).catch(n=>this.client.logger.error(n))}catch(n){this.client.logger.error(n)}},this.onSessionRequest=async r=>{var t,s,n;let{topic:o,payload:a,attestation:c,encryptedId:h,transportType:d}=r,{id:l,params:p}=a;try{await this.isValidRequest(Ee({topic:o},p));let f=this.client.session.get(o),g=await this.getVerifyContext({attestationId:c,hash:rt(JSON.stringify(st("wc_sessionRequest",p,l))),encryptedId:h,metadata:f.peer.metadata,transportType:d}),w={id:l,topic:o,params:p,verifyContext:g};await this.setPendingSessionRequest(w),d===de.link_mode&&(t=f.peer.metadata.redirect)!=null&&t.universal&&this.client.core.addLinkModeSupportedApp((s=f.peer.metadata.redirect)==null?void 0:s.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(w):(this.addSessionRequestToSessionRequestQueue(w),this.processSessionRequestQueue())}catch(f){await this.sendError({id:l,topic:o,error:f}),this.client.logger.error(f)}},this.onSessionRequestResponse=(r,t)=>{let{id:s}=t,n=se("session_request",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);Ve(t)?this.events.emit(se("session_request",s),{result:t.result}):Le(t)&&this.events.emit(se("session_request",s),{error:t.error})},this.onSessionEventRequest=async(r,t)=>{let{id:s,params:n}=t;try{let o=`${r}_session_event_${n.event.name}`,a=zt.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(Ee({topic:r},n)),this.client.events.emit("session_event",{id:s,topic:r,params:n}),zt.set(o,s)}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}},this.onSessionAuthenticateResponse=(r,t)=>{let{id:s}=t;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:t}),Ve(t)?this.events.emit(se("session_request",s),{result:t.result}):Le(t)&&this.events.emit(se("session_request",s),{error:t.error})},this.onSessionAuthenticateRequest=async r=>{var t;let{topic:s,payload:n,attestation:o,encryptedId:a,transportType:c}=r;try{let{requester:h,authPayload:d,expiryTimestamp:l}=n.params,p=await this.getVerifyContext({attestationId:o,hash:rt(JSON.stringify(n)),encryptedId:a,metadata:h.metadata,transportType:c}),f={requester:h,pairingTopic:s,id:n.id,authPayload:d,verifyContext:p,expiryTimestamp:l};await this.setAuthRequest(n.id,{request:f,pairingTopic:s,transportType:c}),c===de.link_mode&&(t=h.metadata.redirect)!=null&&t.universal&&this.client.core.addLinkModeSupportedApp(h.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:n.params,id:n.id,verifyContext:p})}catch(h){this.client.logger.error(h);let d=n.params.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),p=this.getAppLinkIfEnabled(n.params.requester.metadata,c),f={type:tt,receiverPublicKey:d,senderPublicKey:l};await this.sendError({id:n.id,topic:s,error:h,encodeOpts:f,rpcOpts:xe.wc_sessionAuthenticate.autoReject,appLink:p})}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Et.idle,this.processSessionRequestQueue()},(0,ae.toMiliseconds)(this.requestQueueDelay))},this.cleanupPendingSentRequestsForTopic=({topic:r,error:t})=>{let s=this.client.core.history.pending;s.length>0&&s.filter(n=>n.topic===r&&n.request.method==="wc_sessionRequest").forEach(n=>{let o=n.request.id,a=se("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(se("session_request",n.request.id),{error:t})})},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===Et.active){this.client.logger.info("session request queue is already active.");return}let r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=Et.active,this.emitSessionRequest(r)}catch(t){this.client.logger.error(t)}},this.emitSessionRequest=r=>{this.client.events.emit("session_request",r)},this.onPairingCreated=r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;let t=this.client.proposal.getAll().find(s=>s.pairingTopic===r.topic);t&&this.onSessionProposeRequest({topic:r.topic,payload:st("wc_sessionPropose",{requiredNamespaces:t.requiredNamespaces,optionalNamespaces:t.optionalNamespaces,relays:t.relays,proposer:t.proposer,sessionProperties:t.sessionProperties},t.id)})},this.isValidConnect=async r=>{if(!Oe(r)){let{message:c}=B("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(c)}let{pairingTopic:t,requiredNamespaces:s,optionalNamespaces:n,sessionProperties:o,relays:a}=r;if(De(t)||await this.isValidPairingTopic(t),!ag(a,!0)){let{message:c}=B("MISSING_OR_INVALID",`connect() relays: ${a}`);throw new Error(c)}!De(s)&&Ki(s)!==0&&this.validateNamespaces(s,"requiredNamespaces"),!De(n)&&Ki(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),De(o)||this.validateSessionProps(o,"sessionProperties")},this.validateNamespaces=(r,t)=>{let s=og(r,"connect()",t);if(s)throw new Error(s.message)},this.isValidApprove=async r=>{if(!Oe(r))throw new Error(B("MISSING_OR_INVALID",`approve() params: ${r}`).message);let{id:t,namespaces:s,relayProtocol:n,sessionProperties:o}=r;this.checkRecentlyDeleted(t),await this.isValidProposalId(t);let a=this.client.proposal.get(t),c=Co(s,"approve()");if(c)throw new Error(c.message);let h=au(a.requiredNamespaces,s,"approve()");if(h)throw new Error(h.message);if(!me(n,!0)){let{message:d}=B("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(d)}De(o)||this.validateSessionProps(o,"sessionProperties")},this.isValidReject=async r=>{if(!Oe(r)){let{message:n}=B("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(n)}let{id:t,reason:s}=r;if(this.checkRecentlyDeleted(t),await this.isValidProposalId(t),!ug(s)){let{message:n}=B("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(n)}},this.isValidSessionSettleRequest=r=>{if(!Oe(r)){let{message:h}=B("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(h)}let{relay:t,controller:s,namespaces:n,expiry:o}=r;if(!nu(t)){let{message:h}=B("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(h)}let a=sg(s,"onSessionSettleRequest()");if(a)throw new Error(a.message);let c=Co(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(ft(o)){let{message:h}=B("EXPIRED","onSessionSettleRequest()");throw new Error(h)}},this.isValidUpdate=async r=>{if(!Oe(r)){let{message:c}=B("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}let{topic:t,namespaces:s}=r;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t);let n=this.client.session.get(t),o=Co(s,"update()");if(o)throw new Error(o.message);let a=au(n.requiredNamespaces,s,"update()");if(a)throw new Error(a.message)},this.isValidExtend=async r=>{if(!Oe(r)){let{message:s}=B("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(s)}let{topic:t}=r;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t)},this.isValidRequest=async r=>{if(!Oe(r)){let{message:c}=B("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}let{topic:t,request:s,chainId:n,expiry:o}=r;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t);let{namespaces:a}=this.client.session.get(t);if(!ou(a,n)){let{message:c}=B("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(c)}if(!hg(s)){let{message:c}=B("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(c)}if(!fg(a,n,s.method)){let{message:c}=B("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(c)}if(o&&!gg(o,$u)){let{message:c}=B("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${$u.min} and ${$u.max}`);throw new Error(c)}},this.isValidRespond=async r=>{var t;if(!Oe(r)){let{message:o}=B("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(o)}let{topic:s,response:n}=r;try{await this.isValidSessionTopic(s)}catch(o){throw(t=r?.response)!=null&&t.id&&this.cleanupAfterResponse(r),o}if(!lg(n)){let{message:o}=B("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(o)}},this.isValidPing=async r=>{if(!Oe(r)){let{message:s}=B("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}let{topic:t}=r;await this.isValidSessionOrPairingTopic(t)},this.isValidEmit=async r=>{if(!Oe(r)){let{message:a}=B("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}let{topic:t,event:s,chainId:n}=r;await this.isValidSessionTopic(t);let{namespaces:o}=this.client.session.get(t);if(!ou(o,n)){let{message:a}=B("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(a)}if(!dg(s)){let{message:a}=B("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}if(!pg(o,n,s.name)){let{message:a}=B("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}},this.isValidDisconnect=async r=>{if(!Oe(r)){let{message:s}=B("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}let{topic:t}=r;await this.isValidSessionOrPairingTopic(t)},this.isValidAuthenticate=r=>{let{chains:t,uri:s,domain:n,nonce:o}=r;if(!Array.isArray(t)||t.length===0)throw new Error("chains is required and must be a non-empty array");if(!me(s,!1))throw new Error("uri is required parameter");if(!me(n,!1))throw new Error("domain is required parameter");if(!me(o,!1))throw new Error("nonce is required parameter");if([...new Set(t.map(c=>Ui(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");let{namespace:a}=Ui(t[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")},this.getVerifyContext=async r=>{let{attestationId:t,hash:s,encryptedId:n,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||Yr,validation:"UNKNOWN",origin:o.url||""}};try{if(a===de.link_mode){let d=this.getAppLinkIfEnabled(o,a);return c.verified.validation=d&&new URL(d).origin===new URL(o.url).origin?"VALID":"INVALID",c}let h=await this.client.core.verify.resolve({attestationId:t,hash:s,encryptedId:n,verifyUrl:o.verifyUrl});h&&(c.verified.origin=h.origin,c.verified.isScam=h.isScam,c.verified.validation=h.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(h){this.client.logger.warn(h)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c},this.validateSessionProps=(r,t)=>{Object.values(r).forEach(s=>{if(!me(s,!1)){let{message:n}=B("MISSING_OR_INVALID",`${t} must be in Record<string, string> format. Received: ${JSON.stringify(s)}`);throw new Error(n)}})},this.getPendingAuthRequest=r=>{let t=this.client.auth.requests.get(r);return typeof t=="object"?t:void 0},this.addToRecentlyDeleted=(r,t)=>{if(this.recentlyDeletedMap.set(r,t),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0,n=this.recentlyDeletedLimit/2;for(let o of this.recentlyDeletedMap.keys()){if(s++>=n)break;this.recentlyDeletedMap.delete(o)}}},this.checkRecentlyDeleted=r=>{let t=this.recentlyDeletedMap.get(r);if(t){let{message:s}=B("MISSING_OR_INVALID",`Record was recently deleted - ${t}: ${r}`);throw new Error(s)}},this.isLinkModeEnabled=(r,t)=>{var s,n,o,a,c,h,d,l,p;return!r||t!==de.link_mode?!1:((n=(s=this.client.metadata)==null?void 0:s.redirect)==null?void 0:n.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((h=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:h.universal)!==""&&((d=r?.redirect)==null?void 0:d.universal)!==void 0&&((l=r?.redirect)==null?void 0:l.universal)!==""&&((p=r?.redirect)==null?void 0:p.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof window?.Linking<"u"},this.getAppLinkIfEnabled=(r,t)=>{var s;return this.isLinkModeEnabled(r,t)?(s=r?.redirect)==null?void 0:s.universal:void 0},this.handleLinkModeMessage=({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;let t=jc(r,"topic")||"",s=decodeURIComponent(jc(r,"wc_ev")||""),n=this.client.session.keys.includes(t);n&&this.client.session.update(t,{transportType:de.link_mode}),this.client.core.dispatchEnvelope({topic:t,message:s,sessionExists:n})},this.registerLinkModeListeners=async()=>{var r;if(ki()||fr()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){let t=window?.Linking;if(typeof t<"u"){t.addEventListener("url",this.handleLinkModeMessage,this.client.name);let s=await t.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}}isInitialized(){if(!this.initialized){let{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Ue.message,e=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(e):this.onRelayMessage(e)})}async onRelayMessage(e){let{topic:r,message:t,attestation:s,transportType:n}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(jo)?this.client.auth.authKeys.get(jo):{responseTopic:void 0,publicKey:void 0},a=await this.client.core.crypto.decode(r,t,{receiverPublicKey:o,encoding:n===de.link_mode?Vr:pt});try{Jr(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a,attestation:s,transportType:n,encryptedId:rt(t)})):Ht(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:n}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:n})}catch(c){this.client.logger.error(c)}}registerExpirerEvents(){this.client.core.expirer.on(je.expired,async e=>{let{topic:r,id:t}=Io(e.target);if(t&&this.client.pendingRequest.keys.includes(t))return await this.deletePendingSessionRequest(t,B("EXPIRED"),!0);if(t&&this.client.auth.requests.keys.includes(t))return await this.deletePendingAuthRequest(t,B("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):t&&(await this.deleteProposal(t,!0),this.client.events.emit("proposal_expire",{id:t}))})}registerPairingEvents(){this.client.core.pairing.events.on(Gt.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Gt.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!me(e,!1)){let{message:r}=B("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){let{message:r}=B("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(ft(this.client.core.pairing.pairings.get(e).expiry)){let{message:r}=B("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!me(e,!1)){let{message:r}=B("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){let{message:r}=B("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(ft(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});let{message:r}=B("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){let{message:r}=B("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(me(e,!1)){let{message:r}=B("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{let{message:r}=B("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!cg(e)){let{message:r}=B("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){let{message:r}=B("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(ft(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);let{message:r}=B("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}},Gu=class extends bt{constructor(e,r){super(e,r,dx,eh),this.core=e,this.logger=r}},Wu=class extends bt{constructor(e,r){super(e,r,px,eh),this.core=e,this.logger=r}},Ju=class extends bt{constructor(e,r){super(e,r,mx,eh,t=>t.id),this.core=e,this.logger=r}},Yu=class extends bt{constructor(e,r){super(e,r,Ex,Go,()=>jo),this.core=e,this.logger=r}},Xu=class extends bt{constructor(e,r){super(e,r,_x,Go),this.core=e,this.logger=r}},Qu=class extends bt{constructor(e,r){super(e,r,vx,Go,t=>t.id),this.core=e,this.logger=r}},Zu=class{constructor(e,r){this.core=e,this.logger=r,this.authKeys=new Yu(this.core,this.logger),this.pairingTopics=new Xu(this.core,this.logger),this.requests=new Qu(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}},$o=class i extends Un{constructor(e){super(e),this.protocol=U0,this.version=M0,this.name=ju.name,this.events=new Ho.EventEmitter,this.on=(t,s)=>this.events.on(t,s),this.once=(t,s)=>this.events.once(t,s),this.off=(t,s)=>this.events.off(t,s),this.removeListener=(t,s)=>this.events.removeListener(t,s),this.removeAllListeners=t=>this.events.removeAllListeners(t),this.connect=async t=>{try{return await this.engine.connect(t)}catch(s){throw this.logger.error(s.message),s}},this.pair=async t=>{try{return await this.engine.pair(t)}catch(s){throw this.logger.error(s.message),s}},this.approve=async t=>{try{return await this.engine.approve(t)}catch(s){throw this.logger.error(s.message),s}},this.reject=async t=>{try{return await this.engine.reject(t)}catch(s){throw this.logger.error(s.message),s}},this.update=async t=>{try{return await this.engine.update(t)}catch(s){throw this.logger.error(s.message),s}},this.extend=async t=>{try{return await this.engine.extend(t)}catch(s){throw this.logger.error(s.message),s}},this.request=async t=>{try{return await this.engine.request(t)}catch(s){throw this.logger.error(s.message),s}},this.respond=async t=>{try{return await this.engine.respond(t)}catch(s){throw this.logger.error(s.message),s}},this.ping=async t=>{try{return await this.engine.ping(t)}catch(s){throw this.logger.error(s.message),s}},this.emit=async t=>{try{return await this.engine.emit(t)}catch(s){throw this.logger.error(s.message),s}},this.disconnect=async t=>{try{return await this.engine.disconnect(t)}catch(s){throw this.logger.error(s.message),s}},this.find=t=>{try{return this.engine.find(t)}catch(s){throw this.logger.error(s.message),s}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(t){throw this.logger.error(t.message),t}},this.authenticate=async(t,s)=>{try{return await this.engine.authenticate(t,s)}catch(n){throw this.logger.error(n.message),n}},this.formatAuthMessage=t=>{try{return this.engine.formatAuthMessage(t)}catch(s){throw this.logger.error(s.message),s}},this.approveSessionAuthenticate=async t=>{try{return await this.engine.approveSessionAuthenticate(t)}catch(s){throw this.logger.error(s.message),s}},this.rejectSessionAuthenticate=async t=>{try{return await this.engine.rejectSessionAuthenticate(t)}catch(s){throw this.logger.error(s.message),s}},this.name=e?.name||ju.name,this.metadata=e?.metadata||zr(),this.signConfig=e?.signConfig;let r=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:Pt(si({level:e?.logger||ju.logger}));this.core=e?.core||new N0(e),this.logger=Ie(r,this.name),this.session=new Wu(this.core,this.logger),this.proposal=new Gu(this.core,this.logger),this.pendingRequest=new Ju(this.core,this.logger),this.engine=new Hu(this),this.auth=new Zu(this.core,this.logger)}static async init(e){let r=new i(e);return await r.initialize(),r}get context(){return Re(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),this.engine.processRelayMessageCache()}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}});var B0,ct,th=P(()=>{"use strict";B0=["mvx_signTransaction","mvx_signTransactions","mvx_signMessage"],ct="mvx"});var ts=P(()=>{"use strict"});function Wo(i){return i[Math.floor(Math.random()*i.length)]}var rs,q0,rh,Zr=P(()=>{"use strict";rs=i=>typeof i=="string"?i.toUpperCase():i instanceof Error?i.message:JSON.stringify(i);q0="https://maiar.page.link/?apn=com.elrond.maiar.wallet&isi=1519405832&ibi=com.elrond.maiar.wallet&link=https://xportal.com/",rh=i=>{if(!/^[0-9a-fA-F]+$/.test(i)||i.length%2!==0)throw new Error("Invalid hex string");let e=new Uint8Array(i.length/2);for(let r=0;r<e.length;r++)e[r]=parseInt(i.substr(r*2,2),16);return e}});function ih(i,e){let r=[...B0,...e?.methods??[]];e?.methods?.includes("mvx_signLoginToken")||r.push("mvx_signLoginToken");let t=[`${ct}:${i}`],s=e?.events??[];return{requiredNamespaces:{[ct]:{methods:r,chains:t,events:s}}}}function sh(i,e){if(!e)throw new Error("WalletConnect is not initialized");let r=e.find(ih(i)).filter(t=>t.acknowledged);if(r.length>0){let t=r.length-1;return r[t]}if(e.session.length>0){let t=e.session.keys.length-1;return e.session.get(e.session.keys[t])}throw console.log("WalletConnect Session is not connected"),new Error("WalletConnect Session is not connected")}function Nt(i,e){if(!e)throw new Error("WalletConnect is not initialized");let r=sh(i,e);if(!r?.topic)throw new Error("WalletConnect Session is not connected");return r.topic}function z0(i){return!!i}function nh(i){let e=i.namespaces[ct];if(e&&e.accounts){let r=e.accounts[0],[,,t]=r.split(":");return t}return""}function oh({transaction:i,response:e}){if(!e)throw console.log("WalletConnect could not sign the transactions. Invalid signatures"),new Error("WalletConnect could not sign the transactions. Invalid signatures");let{signature:r,guardianSignature:t,version:s,options:n,guardian:o}=e,a=i.guardian;if(a&&a!==o)throw console.log("WalletConnect: Invalid Guardian"),new Error("WalletConnect: Invalid Guardian");return o&&(i.guardian=o),s&&(i.version=s),n!=null&&(i.options=n),i.signature=rh(r),t&&(i.guardianSignature=rh(t)),i}function V0(i){if(i)return{...i,url:zr().url}}async function K0(i){return await new Promise(e=>setTimeout(()=>{e()},i))}var j0=P(()=>{"use strict";ji();th();ts();Zr()});var Xe,is=P(()=>{"use strict";k0();ji();j0();th();ts();Xe=class{constructor(e,r,t,s,n,o,a,c){this.chainId="";this.isInitializing=!1;this.processingTopic="";this.options={};this.account={address:""};this.onClientConnect=e,this.chainId=r,this.walletConnectV2Relay=t,this.walletConnectV2ProjectId=s,this.Message=n,this.Transaction=o,this.TransactionsConverter=a,this.options=c}disconnect(){this.account={address:"",signature:""},this.walletConnector=void 0,this.session=void 0,this.pairings=void 0}async init(){if(this.isInitialized())return this.isInitialized();try{if(!this.isInitializing){this.isInitializing=!0,this.disconnect();let e=this.options?.metadata?{metadata:V0(this.options?.metadata)}:{},r=await $o.init({...this.options,relayUrl:this.walletConnectV2Relay,projectId:this.walletConnectV2ProjectId,...e});this.walletConnector=r,this.isInitializing=!1,await this.subscribeToEvents(r),await this.checkPersistedState(r)}}catch{throw new Error("WalletConnect is unable to init")}finally{return this.isInitializing=!1,this.isInitialized()}}isInitialized(){return!!this.walletConnector&&!this.isInitializing}isConnected(){return!!(this.isInitialized()&&typeof this.session<"u")}getAccount(){return this.account}setAccount(e){this.account=e}async connect(e){if(typeof this.walletConnector>"u")throw new Error("WalletConnect is not initialized");let r=ih(this.chainId,e);try{return await this.walletConnector.connect({pairingTopic:e?.topic,...r})}catch{if(e?.topic)try{this.walletConnector.core?.expirer?.set(e.topic,0)}catch{console.error("WalletConnect: Unable to handle cleanup")}throw this.disconnect(),console.error(e?.topic?"WalletConnect is unable to connect to existing pairing":"WalletConnect is unable to connect"),new Error(e?.topic?"WalletConnect is unable to connect to existing pairing":"WalletConnect is unable to connect")}}async login(e){if(this.isInitializing=!0,typeof this.walletConnector>"u"&&await this.connect(),typeof this.walletConnector>"u")throw new Error("WalletConnect is not initialized");typeof this.session<"u"&&await this.logout({topic:this.session?.topic});try{if(e&&e.approval){let r=await e.approval();if(e.token){await K0(500);let t=nh(r),n=r.namespaces[ct].methods.includes("mvx_signNativeAuthToken")?"mvx_signNativeAuthToken":"mvx_signLoginToken",{signature:o}=await this.walletConnector.request({chainId:`${ct}:${this.chainId}`,topic:r.topic,request:{method:n,params:{token:e.token,address:t}}});if(!o)throw console.error("WalletConnect could not sign login token"),new Error("WalletConnect could not sign login token");return await this.onSessionConnected({session:r,signature:o})}return await this.onSessionConnected({session:r,signature:""})}}catch{throw this.disconnect(),console.error("WalletConnect is unable to login"),new Error("WalletConnect is unable to login")}finally{this.isInitializing=!1}return null}async logout(e){if(typeof this.walletConnector>"u")throw console.error("WalletConnect is not initialized"),new Error("WalletConnect is not initialized");try{if(this.processingTopic===(e?.topic||Nt(this.chainId,this.walletConnector)))return!0;if(e?.topic)this.processingTopic=e.topic,await this.walletConnector.disconnect({topic:e.topic,reason:ce("USER_DISCONNECTED")});else{let r=Nt(this.chainId,this.walletConnector);this.processingTopic=r,await this.walletConnector.disconnect({topic:r,reason:ce("USER_DISCONNECTED")}),this.disconnect(),await this.cleanupPendingPairings({deletePairings:!0})}}catch{console.error("WalletConnect: Already logged out")}finally{this.processingTopic=""}return!0}getAddress(){if(typeof this.walletConnector>"u")throw console.error("WalletConnect is not initialized"),new Error("WalletConnect is not initialized");return this.account.address}getSignature(){if(typeof this.walletConnector>"u")throw console.error("WalletConnect is not initialized"),new Error("WalletConnect is not initialized");return this.account.signature}async getPairings(){if(typeof this.walletConnector>"u")throw console.error("WalletConnect is not initialized"),new Error("WalletConnect is not initialized");return this.walletConnector?.core?.pairing?.pairings?.getAll({active:!0})??[]}async signMessage(e){let r=new this.Message({data:Buffer.from(e.data),address:e.address??this.account.address,signer:"wallet-connect-v2",version:e.version});if(typeof this.walletConnector>"u")throw console.error("WalletConnect is not initialized"),new Error("WalletConnect is not initialized");if(typeof this.session>"u")throw console.error("WalletConnect Session is not connected"),this.onClientConnect.onClientLogout(),new Error("WalletConnect Session is not connected");try{let t=this.getAddress(),{signature:s}=await this.walletConnector.request({chainId:`${ct}:${this.chainId}`,topic:Nt(this.chainId,this.walletConnector),request:{method:"mvx_signMessage",params:{address:t,message:r.data.toString()}}});if(!s)throw console.error("WalletConnect could not sign the message: invalid message response"),new Error("WalletConnect could not sign the message: invalid message response");try{r.signature=Buffer.from(s,"hex")}catch{throw console.error("WalletConnect: Invalid message signature"),new Error("WalletConnect: Invalid message signature")}}catch{throw new Error("WalletConnect could not sign the message")}return r}async signTransaction(e){if(typeof this.walletConnector>"u")throw console.error("WalletConnect is not initialized"),new Error("WalletConnect is not initialized");if(typeof this.session>"u")throw console.error("WalletConnect Session is not connected"),this.onClientConnect.onClientLogout(),new Error("WalletConnect Session is not connected");let r=this.TransactionsConverter.transactionToPlainObject(e);if(this.chainId!==e.chainID)throw console.error("WalletConnect: Request Chain Id different than Connection Chain Id"),new Error("WalletConnect: Request Chain Id different than Connection Chain Id");try{let t=await this.walletConnector.request({chainId:`${ct}:${this.chainId}`,topic:Nt(this.chainId,this.walletConnector),request:{method:"mvx_signTransaction",params:{transaction:r}}});return oh({transaction:e,response:t})}catch{throw new Error("Transaction canceled")}}async signTransactions(e){if(typeof this.walletConnector>"u")throw console.error("WalletConnect is not initialized"),new Error("WalletConnect is not initialized");if(typeof this.session>"u")throw console.error("WalletConnect Session is not connected"),this.onClientConnect.onClientLogout(),new Error("WalletConnect Session is not connected");let r=e.map(t=>{if(this.chainId!==t.chainID)throw console.error("WalletConnect: Request Chain Id different than Connection Chain Id"),new Error("WalletConnect: Request Chain Id different than Connection Chain Id");return this.TransactionsConverter.transactionToPlainObject(t)});try{let{signatures:t}=await this.walletConnector.request({chainId:`${ct}:${this.chainId}`,topic:Nt(this.chainId,this.walletConnector),request:{method:"mvx_signTransactions",params:{transactions:r}}});if(!t)throw console.error("WalletConnect could not sign the transactions. Invalid signatures"),new Error("WalletConnect could not sign the transactions. Invalid signatures");if(!Array.isArray(t)||e.length!==t.length)throw new Error("WalletConnect could not sign the transactions. Invalid signatures");for(let[s,n]of e.entries()){let o=t[s];oh({transaction:n,response:o})}return e}catch{throw new Error("Transaction canceled")}}async sendCustomRequest(e){if(typeof this.walletConnector>"u")throw console.error("WalletConnect is not initialized"),new Error("WalletConnect is not initialized");if(typeof this.session>"u")throw console.error("WalletConnect Session is not connected"),this.onClientConnect.onClientLogout(),new Error("WalletConnect Session is not connected");if(e?.request?.method){try{let r={...e.request},{method:t}=r,{response:s}=await this.walletConnector.request({chainId:`${ct}:${this.chainId}`,topic:Nt(this.chainId,this.walletConnector),request:{...r,method:t}});s||console.error("WalletConnect could not send the custom request")}catch{console.error("WalletConnect could not send the custom request")}return}}async ping(){if(typeof this.walletConnector>"u")throw console.error("WalletConnect is not initialized"),new Error("WalletConnect is not initialized");typeof this.session>"u"&&console.error("WalletConnect Session is not connected");try{let e=Nt(this.chainId,this.walletConnector);return await this.walletConnector.ping({topic:e}),!0}catch{return console.error("WalletConnect Ping Failed"),!1}}async loginAccount(e){return e?z0(e.address)?(this.account.address=e.address,e.signature&&(this.account.signature=e.signature),this.onClientConnect.onClientLogin(),this.account.address):(console.error(`WalletConnect: Invalid address ${e.address}`),this.walletConnector&&await this.logout(),""):""}async onSessionConnected(e){if(!e)return null;this.session=e.session,this.account.signature=e.signature||"";let r=nh(e.session);return r?(await this.loginAccount({address:r,signature:e.signature}),this.account.address=r,this.account):null}async handleTopicUpdateEvent({topic:e}){if(typeof this.walletConnector>"u"){console.error("WalletConnect is not initialized");return}try{let r=await this.getPairings();this.account.address&&!this.isInitializing&&r&&(r?.length===0?this.onClientConnect.onClientLogout():r[r.length-1]?.topic===e&&this.onClientConnect.onClientLogout())}catch{console.error("WalletConnect: Unable to handle topic update")}finally{this.pairings=await this.getPairings()}}async handleSessionEvents({topic:e,params:r}){if(typeof this.walletConnector>"u")throw new Error("WalletConnect is not initialized");if(this.session&&this.session?.topic!==e)return;let{event:t}=r;if(t?.name&&Nt(this.chainId,this.walletConnector)===e){let s=t.data;this.onClientConnect.onClientEvent(s)}}async subscribeToEvents(e){if(typeof e>"u")throw new Error("WalletConnect is not initialized");try{e.on("session_update",({topic:r,params:t})=>{if(!this.session||this.session?.topic!==r)return;let{namespaces:s}=t,o={...e.session.get(r),namespaces:s};this.onSessionConnected({session:o})}),e.on("session_event",this.handleSessionEvents.bind(this)),e.on("session_delete",async({topic:r})=>{this.isInitializing&&(this.onClientConnect.onClientLogout(),this.disconnect()),!(!this.session||this.session?.topic!==r)&&(console.error("WalletConnect Session Deleted"),this.onClientConnect.onClientLogout(),this.disconnect(),await this.cleanupPendingPairings({deletePairings:!0}))}),e.on("session_expire",async({topic:r})=>{!this.session||this.session?.topic!==r||(console.error("WalletConnect Session Expired"),this.onClientConnect.onClientLogout(),this.disconnect(),await this.cleanupPendingPairings({deletePairings:!0}))}),e.core?.pairing?.events.on("pairing_delete",this.handleTopicUpdateEvent.bind(this)),e.core?.pairing?.events.on("pairing_expire",this.handleTopicUpdateEvent.bind(this))}catch{console.error("WalletConnect: Unable to handle events")}}async checkPersistedState(e){if(typeof e>"u")throw new Error("WalletConnect is not initialized");if(this.pairings=await this.getPairings(),!(typeof this.session<"u")&&e.session.length&&!this.account.address&&!this.isInitializing){let r=sh(this.chainId,e);if(r)return await this.onSessionConnected({session:r}),r}}async cleanupPendingPairings(e={}){if(!(typeof this.walletConnector>"u"))try{let r=this.walletConnector.core?.pairing?.pairings?.getAll({active:!1});if(!Vt(r))return;for(let t of r)if(e.deletePairings)this.walletConnector.core?.expirer?.set(t.topic,0);else try{await this.walletConnector.core?.relayer?.subscriber?.unsubscribe(t.topic)}catch{console.error("WalletConnect: Unable to handle cleanup")}}catch{console.error("WalletConnect: Unable to handle cleanup")}}}});var $0={};Se($0,{initMobileProvider:()=>Nx});var Nx,H0=P(()=>{"use strict";is();Zr();Nx=async(i,e,r,t,s,n,o,a)=>{if(!o||!i.initOptions.chainType)return;let c={onClientLogin:()=>{},onClientLogout:()=>e(i),onClientEvent:l=>{console.log("wc2 session event: ",l)}},h=Wo(a),d=new Xe(c,r[i.initOptions.chainType].shortId,h,o,t,s,n);try{return await d.init(),d}catch{console.warn("Can't initialize the Dapp Provider!")}}});function Ot(i,e,r){if(e<0||e>31||i>>>e)throw new RangeError("Value out of range");for(let t=e-1;t>=0;t--)r.push(i>>>t&1)}function At(i,e){return(i>>>e&1)!==0}function Z0(i,e){return i[Math.floor((e+7)/17)+1]}function em(i){let e=[];for(let r of i)Ot(r,8,e);return new ss(zx,i.length,e)}function Vx(i){if(!tm(i))throw new RangeError("String contains non-numeric characters");let e=[];for(let r=0;r<i.length;){let t=Math.min(i.length-r,3);Ot(Number.parseInt(i.substring(r,r+t),10),t*3+1,e),r+=t}return new ss(Bx,i.length,e)}function Kx(i){if(!rm(i))throw new RangeError("String contains unencodable characters in alphanumeric mode");let e=[],r;for(r=0;r+2<=i.length;r+=2){let t=ah.indexOf(i.charAt(r))*45;t+=ah.indexOf(i.charAt(r+1)),Ot(t,11,e)}return r<i.length&&Ot(ah.indexOf(i.charAt(r)),6,e),new ss(qx,i.length,e)}function jx(i){return i===""?[]:tm(i)?[Vx(i)]:rm(i)?[Kx(i)]:[em(Hx(i))]}function tm(i){return Ux.test(i)}function rm(i){return Mx.test(i)}function $x(i,e){let r=0;for(let t of i){let s=Z0(t.mode,e);if(t.numChars>=1<<s)return Number.POSITIVE_INFINITY;r+=4+s+t.bitData.length}return r}function Hx(i){i=encodeURI(i);let e=[];for(let r=0;r<i.length;r++)i.charAt(r)!=="%"?e.push(i.charCodeAt(r)):(e.push(Number.parseInt(i.substring(r+1,r+3),16)),r+=2);return e}function uh(i){if(i<lh||i>dh)throw new RangeError("Version number out of range");let e=(16*i+128)*i+64;if(i>=2){let r=Math.floor(i/7)+2;e-=(25*r-10)*r-55,i>=7&&(e-=36)}return e}function Xo(i,e){return Math.floor(uh(i)/8)-X0[e[0]][i]*Q0[e[0]][i]}function Gx(i){if(i<1||i>255)throw new RangeError("Degree out of range");let e=[];for(let t=0;t<i-1;t++)e.push(0);e.push(1);let r=1;for(let t=0;t<i;t++){for(let s=0;s<e.length;s++)e[s]=hh(e[s],r),s+1<e.length&&(e[s]^=e[s+1]);r=hh(r,2)}return e}function Wx(i,e){let r=e.map(t=>0);for(let t of i){let s=t^r.shift();r.push(0),e.forEach((n,o)=>r[o]^=hh(n,s))}return r}function hh(i,e){if(i>>>8||e>>>8)throw new RangeError("Byte out of range");let r=0;for(let t=7;t>=0;t--)r=r<<1^(r>>>7)*285,r^=(e>>>t&1)*i;return r}function Jx(i,e,r=1,t=40,s=-1,n=!0){if(!(lh<=r&&r<=t&&t<=dh)||s<-1||s>7)throw new RangeError("Invalid value");let o,a;for(o=r;;o++){let l=Xo(o,e)*8,p=$x(i,o);if(p<=l){a=p;break}if(o>=t)throw new RangeError("Data too long")}for(let l of[W0,J0,Y0])n&&a<=Xo(o,l)*8&&(e=l);let c=[];for(let l of i){Ot(l.mode[0],4,c),Ot(l.numChars,Z0(l.mode,o),c);for(let p of l.getData())c.push(p)}let h=Xo(o,e)*8;Ot(0,Math.min(4,h-c.length),c),Ot(0,(8-c.length%8)%8,c);for(let l=236;c.length<h;l^=253)Ot(l,8,c);let d=Array.from({length:Math.ceil(c.length/8)},()=>0);return c.forEach((l,p)=>d[p>>>3]|=l<<7-(p&7)),new ch(o,e,d,s)}function Yx(i,e){let{ecc:r="L",boostEcc:t=!1,minVersion:s=1,maxVersion:n=40,maskPattern:o=-1,border:a=1}=e||{},c=typeof i=="string"?jx(i):Array.isArray(i)?[em(i)]:void 0;if(!c)throw new Error(`uqr only supports encoding string and binary data, but got: ${typeof i}`);let h=Jx(c,Lx[r],s,n,o,t),d=Xx({version:h.version,maskPattern:h.mask,size:h.size,data:h.modules,types:h.types},a);return e?.invert&&(d.data=d.data.map(l=>l.map(p=>!p))),e?.onEncoded?.(d),d}function Xx(i,e=1){if(!e)return i;let{size:r}=i,t=r+e*2;i.size=t,i.data.forEach(n=>{for(let o=0;o<e;o++)n.unshift(!1),n.push(!1)});for(let n=0;n<e;n++)i.data.unshift(Array.from({length:t},o=>!1)),i.data.push(Array.from({length:t},o=>!1));let s=mr.Border;i.types.forEach(n=>{for(let o=0;o<e;o++)n.unshift(s),n.push(s)});for(let n=0;n<e;n++)i.types.unshift(Array.from({length:t},o=>s)),i.types.push(Array.from({length:t},o=>s));return i}function im(i,e={}){let r=Yx(i,e),{pixelSize:t=10,whiteColor:s="white",blackColor:n="black"}=e,o=r.size*t,a=r.size*t,c=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${a} ${o}">`,h=[];for(let d=0;d<r.size;d++)for(let l=0;l<r.size;l++){let p=l*t,f=d*t;r.data[d][l]&&h.push(`M${p},${f}h${t}v${t}h-${t}z`)}return c+=`<rect fill="${s}" width="${a}" height="${o}"/>`,c+=`<path fill="${n}" d="${h.join("")}"/>`,c+="</svg>",c}var mr,Ax,Ox,Jo,Px,W0,J0,Y0,Lx,Ux,Mx,ah,lh,dh,G0,Fx,Yo,kx,X0,Q0,ch,ss,Bx,qx,zx,sm=P(()=>{mr=(i=>(i[i.Border=-1]="Border",i[i.Data=0]="Data",i[i.Function=1]="Function",i[i.Position=2]="Position",i[i.Timing=3]="Timing",i[i.Alignment=4]="Alignment",i))(mr||{}),Ax=Object.defineProperty,Ox=(i,e,r)=>e in i?Ax(i,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[e]=r,Jo=(i,e,r)=>(Ox(i,typeof e!="symbol"?e+"":e,r),r),Px=[0,1],W0=[1,0],J0=[2,3],Y0=[3,2],Lx={L:Px,M:W0,Q:J0,H:Y0},Ux=/^[0-9]*$/,Mx=/^[A-Z0-9 $%*+.\/:-]*$/,ah="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",lh=1,dh=40,G0=3,Fx=3,Yo=40,kx=10,X0=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],Q0=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],ch=class{constructor(e,r,t,s){if(this.version=e,this.ecc=r,Jo(this,"size"),Jo(this,"mask"),Jo(this,"modules",[]),Jo(this,"types",[]),e<lh||e>dh)throw new RangeError("Version value out of range");if(s<-1||s>7)throw new RangeError("Mask value out of range");this.size=e*4+17;let n=Array.from({length:this.size},()=>!1);for(let a=0;a<this.size;a++)this.modules.push(n.slice()),this.types.push(n.map(()=>0));this.drawFunctionPatterns();let o=this.addEccAndInterleave(t);if(this.drawCodewords(o),s===-1){let a=1e9;for(let c=0;c<8;c++){this.applyMask(c),this.drawFormatBits(c);let h=this.getPenaltyScore();h<a&&(s=c,a=h),this.applyMask(c)}}this.mask=s,this.applyMask(s),this.drawFormatBits(s)}getModule(e,r){return e>=0&&e<this.size&&r>=0&&r<this.size&&this.modules[r][e]}drawFunctionPatterns(){for(let t=0;t<this.size;t++)this.setFunctionModule(6,t,t%2===0,mr.Timing),this.setFunctionModule(t,6,t%2===0,mr.Timing);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);let e=this.getAlignmentPatternPositions(),r=e.length;for(let t=0;t<r;t++)for(let s=0;s<r;s++)t===0&&s===0||t===0&&s===r-1||t===r-1&&s===0||this.drawAlignmentPattern(e[t],e[s]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){let r=this.ecc[1]<<3|e,t=r;for(let n=0;n<10;n++)t=t<<1^(t>>>9)*1335;let s=(r<<10|t)^21522;for(let n=0;n<=5;n++)this.setFunctionModule(8,n,At(s,n));this.setFunctionModule(8,7,At(s,6)),this.setFunctionModule(8,8,At(s,7)),this.setFunctionModule(7,8,At(s,8));for(let n=9;n<15;n++)this.setFunctionModule(14-n,8,At(s,n));for(let n=0;n<8;n++)this.setFunctionModule(this.size-1-n,8,At(s,n));for(let n=8;n<15;n++)this.setFunctionModule(8,this.size-15+n,At(s,n));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let t=0;t<12;t++)e=e<<1^(e>>>11)*7973;let r=this.version<<12|e;for(let t=0;t<18;t++){let s=At(r,t),n=this.size-11+t%3,o=Math.floor(t/3);this.setFunctionModule(n,o,s),this.setFunctionModule(o,n,s)}}drawFinderPattern(e,r){for(let t=-4;t<=4;t++)for(let s=-4;s<=4;s++){let n=Math.max(Math.abs(s),Math.abs(t)),o=e+s,a=r+t;o>=0&&o<this.size&&a>=0&&a<this.size&&this.setFunctionModule(o,a,n!==2&&n!==4,mr.Position)}}drawAlignmentPattern(e,r){for(let t=-2;t<=2;t++)for(let s=-2;s<=2;s++)this.setFunctionModule(e+s,r+t,Math.max(Math.abs(s),Math.abs(t))!==1,mr.Alignment)}setFunctionModule(e,r,t,s=mr.Function){this.modules[r][e]=t,this.types[r][e]=s}addEccAndInterleave(e){let r=this.version,t=this.ecc;if(e.length!==Xo(r,t))throw new RangeError("Invalid argument");let s=Q0[t[0]][r],n=X0[t[0]][r],o=Math.floor(uh(r)/8),a=s-o%s,c=Math.floor(o/s),h=[],d=Gx(n);for(let p=0,f=0;p<s;p++){let g=e.slice(f,f+c-n+(p<a?0:1));f+=g.length;let w=Wx(g,d);p<a&&g.push(0),h.push(g.concat(w))}let l=[];for(let p=0;p<h[0].length;p++)h.forEach((f,g)=>{(p!==c-n||g>=a)&&l.push(f[p])});return l}drawCodewords(e){if(e.length!==Math.floor(uh(this.version)/8))throw new RangeError("Invalid argument");let r=0;for(let t=this.size-1;t>=1;t-=2){t===6&&(t=5);for(let s=0;s<this.size;s++)for(let n=0;n<2;n++){let o=t-n,c=(t+1&2)===0?this.size-1-s:s;!this.types[c][o]&&r<e.length*8&&(this.modules[c][o]=At(e[r>>>3],7-(r&7)),r++)}}}applyMask(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(let r=0;r<this.size;r++)for(let t=0;t<this.size;t++){let s;switch(e){case 0:s=(t+r)%2===0;break;case 1:s=r%2===0;break;case 2:s=t%3===0;break;case 3:s=(t+r)%3===0;break;case 4:s=(Math.floor(t/3)+Math.floor(r/2))%2===0;break;case 5:s=t*r%2+t*r%3===0;break;case 6:s=(t*r%2+t*r%3)%2===0;break;case 7:s=((t+r)%2+t*r%3)%2===0;break;default:throw new Error("Unreachable")}!this.types[r][t]&&s&&(this.modules[r][t]=!this.modules[r][t])}}getPenaltyScore(){let e=0;for(let n=0;n<this.size;n++){let o=!1,a=0,c=[0,0,0,0,0,0,0];for(let h=0;h<this.size;h++)this.modules[n][h]===o?(a++,a===5?e+=G0:a>5&&e++):(this.finderPenaltyAddHistory(a,c),o||(e+=this.finderPenaltyCountPatterns(c)*Yo),o=this.modules[n][h],a=1);e+=this.finderPenaltyTerminateAndCount(o,a,c)*Yo}for(let n=0;n<this.size;n++){let o=!1,a=0,c=[0,0,0,0,0,0,0];for(let h=0;h<this.size;h++)this.modules[h][n]===o?(a++,a===5?e+=G0:a>5&&e++):(this.finderPenaltyAddHistory(a,c),o||(e+=this.finderPenaltyCountPatterns(c)*Yo),o=this.modules[h][n],a=1);e+=this.finderPenaltyTerminateAndCount(o,a,c)*Yo}for(let n=0;n<this.size-1;n++)for(let o=0;o<this.size-1;o++){let a=this.modules[n][o];a===this.modules[n][o+1]&&a===this.modules[n+1][o]&&a===this.modules[n+1][o+1]&&(e+=Fx)}let r=0;for(let n of this.modules)r=n.reduce((o,a)=>o+(a?1:0),r);let t=this.size*this.size,s=Math.ceil(Math.abs(r*20-t*10)/t)-1;return e+=s*kx,e}getAlignmentPatternPositions(){if(this.version===1)return[];{let e=Math.floor(this.version/7)+2,r=this.version===32?26:Math.ceil((this.version*4+4)/(e*2-2))*2,t=[6];for(let s=this.size-7;t.length<e;s-=r)t.splice(1,0,s);return t}}finderPenaltyCountPatterns(e){let r=e[1],t=r>0&&e[2]===r&&e[3]===r*3&&e[4]===r&&e[5]===r;return(t&&e[0]>=r*4&&e[6]>=r?1:0)+(t&&e[6]>=r*4&&e[0]>=r?1:0)}finderPenaltyTerminateAndCount(e,r,t){return e&&(this.finderPenaltyAddHistory(r,t),r=0),r+=this.size,this.finderPenaltyAddHistory(r,t),this.finderPenaltyCountPatterns(t)}finderPenaltyAddHistory(e,r){r[0]===0&&(e+=this.size),r.pop(),r.unshift(e)}};ss=class{constructor(e,r,t){if(this.mode=e,this.numChars=r,this.bitData=t,r<0)throw new RangeError("Invalid argument");this.bitData=t.slice()}getData(){return this.bitData.slice()}},Bx=[1,10,12,14],qx=[2,9,11,13],zx=[4,8,16,16]});var Zx,e2,t2,r2,fh,i2,Qo,s2,n2,o2,a2,c2,nm,om=P(()=>{"use strict";sm();is();Zr();Zr();ts();Zx=i=>{let e=document.createElement("template");return e.innerHTML=i.trim(),e.content.firstChild?.cloneNode(!0)},e2=i=>{let e=`${q0}?wallet-connect=${encodeURIComponent(i)}`,r=document.createElement("a");return r.setAttribute("href",e),r.setAttribute("rel","noopener noreferrer nofollow"),r.setAttribute("target","_blank"),r.textContent="xPortal login",r.classList.add("elven-qr-code-deep-link"),r},t2=()=>{let i=document.createElement("div");return i.classList.add("elven-wc-pairings"),i},r2=()=>{let i=document.createElement("div");return i.textContent="Existing WalletConnect pairings:",i.classList.add("elven-wc-pairings-header"),i},fh={},i2=(i,e)=>{let r=document.createElement("button");return r.classList.add("elven-wc-pairings-remove-btn"),r.textContent="\u2716",fh[i.topic]=new AbortController,r.addEventListener("click",t=>{t.stopImmediatePropagation(),e(i.topic)},{signal:fh[i.topic].signal}),r},Qo={},s2=(i,e,r)=>{let t=document.createElement("div"),s=document.createElement("div");t.classList.add("elven-wc-pairing-item"),t.setAttribute("id",i.topic),s.classList.add("elven-wc-pairing-item-description"),s.textContent=`${i.peerMetadata?.description} (${i.peerMetadata?.url})`,t.appendChild(s);let n=i2(i,e);return t.appendChild(n),Qo[i.topic]=new AbortController,t.addEventListener("click",()=>r(i.topic),{signal:Qo[i.topic].signal}),t},n2=()=>{let i=document.createElement("div");return i.classList.add("elven-wc-pairing-item-confirm-msessage"),i.setAttribute("id","elven-wc-pairing-item-confirm-msessage"),i.innerText="Confirm on xPortal app!",i},o2=i=>{if(!i)return;document.getElementById(i)?.remove()},a2=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),c2=i=>i?im(i):void 0,nm=async(i,e,r,t)=>{if(!i)throw new Error("Please provide the QR Code and WalletConnect Pairings container id!");let s=null;typeof i=="string"?s=document.getElementById(i):i instanceof HTMLElement&&(s=i);let n=c2(e),o;if(n&&(o=Zx(n)),s&&o&&(s.replaceChildren(),s.appendChild(o),a2()&&s.appendChild(e2(e))),s&&r instanceof Xe){let a=r.pairings,c=async d=>{try{d&&(await r.logout({topic:d}),o2(d))}catch(l){let p=rs(l);console.warn(`Something went wrong trying to remove the existing pairing: ${p}`)}finally{Qo[d].abort()}},h=async d=>{try{let{approval:l}=await r.connect({topic:d,methods:["mvx_cancelAction","mvx_signNativeAuthToken"]});document.getElementById("elven-wc-pairing-item-confirm-msessage")||document.getElementById(d)?.after(n2()),await r.login({approval:l,token:t})}catch(l){let p=rs(l);console.warn(`Something went wrong trying to login the user: ${p}`)}finally{for(let l of Object.values(Qo))l?.abort();for(let l of Object.values(fh))l?.abort()}};if(a&&a.length>0){let d=t2();s.appendChild(d);let l=r2();d.appendChild(l);for(let p of a){let f=s2(p,c,h);d.appendChild(f)}}}return s}});var am={};Se(am,{loginWithMobile:()=>u2});var u2,cm=P(()=>{"use strict";Zr();om();is();ts();u2=async(i,e,r,t,s,n,o,a,c,h,d,l,p,f,g)=>{if(!g)throw new Error("You haven't provided the QR code container DOM element id");let w=Wo(f);if(!w||!i.networkProvider)throw new Error("Something wen't wrong with the initialization (ApiNetworkProvider or Wallet Connect Bridge address), plese try to refresh the page!");if(!p)throw new Error("Please provide your WalletConnect project id. You can get it here: https://cloud.walletconnect.com)");if(!i.initOptions.chainType)throw new Error("Please provide the chain type in ElvenJS.init function!");let b,v={onClientLogin:async()=>{if(i.dappProvider instanceof Xe){let I=await i.dappProvider.getAddress(),S=await i.dappProvider.getSignature();t.set("address",I),t.set("loginMethod","mobile"),t.set("expires",n()),await o(i),S&&t.set("signature",S),t.set("loginToken",e);let T=r.getToken(I,e,S);t.set("accessToken",T),a.run("onLoginSuccess"),b?.replaceChildren()}},onClientLogout:async()=>{i.dappProvider instanceof Xe&&await s(i)},onClientEvent:I=>{console.log("wc2 session event: ",I)}},x=new Xe(v,c[i.initOptions.chainType].shortId,w,p,h,d,l);try{if(x){i.dappProvider=x,a.run("onQrPending"),await x.init();let{uri:I,approval:S}=await x.connect({methods:["mvx_cancelAction","mvx_signNativeAuthToken"]}),T=e?`${I}&token=${e}`:I;return g&&T&&(b=await nm(g,T,x,e),a.run("onQrLoaded")),await x.login({approval:S,token:e}),x}}catch(I){let S=rs(I);console.warn(`Something went wrong trying to login the user: ${S}`),a.run("onLoginFailure",S)}}});is();var um=class{constructor({walletConnectV2ProjectId:e,walletConnectV2RelayAddresses:r,qrCodeContainer:t}){this.WalletConnectV2Provider=Xe;this.initMobileProvider=async(e,r,t,s,n,o)=>{let{initMobileProvider:a}=await Promise.resolve().then(()=>(H0(),$0));return a(e,r,t,s,n,o,this.walletConnectV2ProjectId,this.walletConnectV2RelayAddresses)};this.loginWithMobile=async(e,r,t,s,n,o,a,c,h,d,l,p)=>{let{loginWithMobile:f}=await Promise.resolve().then(()=>(cm(),am));return f(e,r,t,s,n,o,a,c,h,d,l,p,this.walletConnectV2ProjectId,this.walletConnectV2RelayAddresses,this.qrCodeContainer)};this.walletConnectV2ProjectId=e,this.walletConnectV2RelayAddresses=r,this.qrCodeContainer=t}};export{um as MobileSigningProvider};
/*! Bundled license information:

js-sha3/src/sha3.js:
  (**
   * [js-sha3]{@link https://github.com/emn178/js-sha3}
   *
   * @version 0.8.0
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2015-2018
   * @license MIT
   *)

@noble/secp256k1/index.js:
  (*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) *)
*/
